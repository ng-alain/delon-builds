{"version":3,"file":"fullContent.js.map","sources":["ng://@delon/abc/full-content/full-content.service.ts","ng://@delon/abc/full-content/full-content.component.ts","ng://@delon/abc/full-content/full-content-toggle.directive.ts","ng://@delon/abc/full-content/full-content.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { share } from 'rxjs/operators';\n\n@Injectable()\nexport class FullContentService {\n  private _change: BehaviorSubject<any> = new BehaviorSubject<any>(null);\n\n  /** åæ¢å¨å±å·¥ä½åºç¶æ */\n  toggle() {\n    this._change.next(true);\n  }\n\n  get change(): Observable<boolean> {\n    return this._change.pipe(share());\n  }\n}\n","import {\n  Component,\n  ElementRef,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Input,\n  Output,\n  EventEmitter,\n  OnChanges,\n  OnInit,\n  Inject,\n  HostBinding,\n  OnDestroy,\n  AfterViewInit,\n} from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { Router, ActivationStart, ActivationEnd } from '@angular/router';\nimport { Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, filter } from 'rxjs/operators';\nimport { InputBoolean, InputNumber } from '@delon/util';\n\nimport { FullContentService } from './full-content.service';\n\nconst wrapCls = `full-content__body`;\nconst openedCls = `full-content__opened`;\nconst hideTitleCls = `full-content__hidden-title`;\n\n@Component({\n  selector: 'full-content',\n  template: `<ng-content></ng-content>`,\n  host: { '[class.full-content]': 'true' },\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class FullContentComponent\n  implements AfterViewInit, OnInit, OnChanges, OnDestroy {\n  private bodyEl: HTMLElement;\n  private inited = false;\n  private srv$: Subscription;\n  private route$: Subscription;\n  private id = `_full-content-${Math.random()\n    .toString(36)\n    .substring(2)}`;\n  private scroll$: Subscription = null;\n\n  @HostBinding('style.height.px')\n  _height = 0;\n\n  // #region fields\n\n  @Input()\n  @InputBoolean()\n  fullscreen: boolean;\n\n  @Input()\n  @InputBoolean()\n  hideTitle = true;\n\n  @Input()\n  @InputNumber()\n  padding = 24;\n\n  @Output()\n  readonly fullscreenChange = new EventEmitter<boolean>();\n\n  // #endregion\n\n  constructor(\n    private el: ElementRef,\n    private cd: ChangeDetectorRef,\n    private srv: FullContentService,\n    private router: Router,\n    @Inject(DOCUMENT) private doc: any,\n  ) {}\n\n  private updateCls() {\n    const clss = this.bodyEl.classList;\n    if (this.fullscreen) {\n      clss.add(openedCls);\n      if (this.hideTitle) {\n        clss.add(hideTitleCls);\n      }\n    } else {\n      clss.remove(openedCls);\n      if (this.hideTitle) {\n        clss.remove(hideTitleCls);\n      }\n    }\n  }\n\n  private update() {\n    this.updateCls();\n    this.updateHeight();\n    this.fullscreenChange.emit(this.fullscreen);\n  }\n\n  private updateHeight() {\n    this._height =\n      this.bodyEl.getBoundingClientRect().height -\n      (this.el.nativeElement as HTMLElement).getBoundingClientRect().top -\n      this.padding;\n    this.cd.detectChanges();\n  }\n\n  private removeInBody() {\n    this.bodyEl.classList.remove(wrapCls, openedCls, hideTitleCls);\n  }\n\n  ngOnInit(): void {\n    this.inited = true;\n    this.bodyEl = this.doc.querySelector('body');\n    this.bodyEl.classList.add(wrapCls);\n    (this.el.nativeElement as HTMLElement).id = this.id;\n\n    this.updateCls();\n\n    // when window resize\n    this.scroll$ = fromEvent(window, 'resize')\n      .pipe(debounceTime(200))\n      .subscribe(() => this.updateHeight());\n\n    // when servier changed\n    this.srv$ = this.srv.change\n      .pipe(filter(res => res !== null))\n      .subscribe(() => this.toggle());\n\n    // when router changed\n    this.route$ = this.router.events\n      .pipe(\n        filter(\n          (e: any) =>\n            e instanceof ActivationStart || e instanceof ActivationEnd,\n        ),\n        debounceTime(200),\n      )\n      .subscribe(e => {\n        if (!!this.doc.querySelector('#' + this.id)) {\n          this.bodyEl.classList.add(wrapCls);\n          this.updateCls();\n        } else {\n          this.removeInBody();\n        }\n      });\n  }\n\n  toggle() {\n    this.fullscreen = !this.fullscreen;\n    this.update();\n    this.updateHeight();\n  }\n\n  ngAfterViewInit() {\n    setTimeout(() => this.updateHeight());\n  }\n\n  ngOnChanges(): void {\n    if (this.inited) this.update();\n  }\n\n  ngOnDestroy(): void {\n    this.removeInBody();\n    this.scroll$.unsubscribe();\n    this.srv$.unsubscribe();\n    this.route$.unsubscribe();\n  }\n}\n","import { Directive, HostListener } from '@angular/core';\nimport { FullContentComponent } from './full-content.component';\n\n@Directive({\n  selector: '[full-toggle]',\n})\nexport class FullContentToggleDirective {\n  constructor(private parent: FullContentComponent) {}\n\n  @HostListener('click')\n  _click() {\n    this.parent.toggle();\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DelonUtilModule } from '@delon/util';\n\nimport { FullContentComponent } from './full-content.component';\nimport { FullContentToggleDirective } from './full-content-toggle.directive';\nimport { FullContentService } from './full-content.service';\n\nconst COMPONENTS = [FullContentComponent, FullContentToggleDirective];\n\n@NgModule({\n  imports: [CommonModule, DelonUtilModule],\n  declarations: [...COMPONENTS],\n  exports: [...COMPONENTS],\n})\nexport class FullContentModule {\n  static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: FullContentModule,\n      providers: [FullContentService],\n    };\n  }\n}\n"],"names":[],"mappings":"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"}
