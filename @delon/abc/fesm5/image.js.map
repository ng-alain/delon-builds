{"version":3,"file":"image.js.map","sources":["ng://@delon/abc/image/image.config.ts","ng://@delon/abc/image/image.directive.ts","ng://@delon/abc/image/image.module.ts"],"sourcesContent":["export class ImageConfig {\n  /**\n   * é»è®¤å¤§å°ï¼é»è®¤å¼ï¼`64`ï¼åä½ï¼px\n   */\n  size?: number = 64;\n\n  /**\n   * éè¯¯å¾ç\n   */\n  error?: string = './assets/img/logo.svg';\n}\n","import {\n  Directive,\n  Input,\n  OnChanges,\n  ElementRef,\n  Renderer2,\n  SimpleChanges,\n  OnInit,\n  SimpleChange,\n} from '@angular/core';\nimport { deepCopy, InputNumber } from '@delon/util';\n\nimport { ImageConfig } from './image.config';\n\n/**\n * imgæ ç­¾\n * + æ¯æå¾®ä¿¡ãqqå¤´åè§åç¼©ç¥å¾è§å\n * + æ¯æç§»é¤http&httpsåè®®http\n * + æ¯æå¢å onerroräºä»¶\n */\n@Directive({ selector: '[_src]' })\nexport class ImageDirective implements OnChanges, OnInit {\n  @Input('_src') src: string;\n\n  @Input() @InputNumber() size = 64;\n\n  @Input() error = './assets/img/logo.svg';\n\n  private inited = false;\n\n  constructor(\n    private el: ElementRef,\n    private render: Renderer2,\n    DEF: ImageConfig,\n  ) {\n    Object.assign(this, deepCopy(DEF));\n  }\n\n  ngOnInit(): void {\n    this.update();\n    this.updateError();\n    this.inited = true;\n  }\n\n  ngOnChanges(\n    changes: { [P in keyof this]?: SimpleChange } & SimpleChanges,\n  ): void {\n    if (this.inited) {\n      if (changes.error) {\n        this.updateError();\n      } else {\n        this.update();\n      }\n    }\n  }\n\n  private update() {\n    let newSrc = this.src;\n\n    if (newSrc.includes('qlogo.cn')) {\n      const arr = newSrc.split('/'),\n        size = arr[arr.length - 1];\n      arr[arr.length - 1] =\n        size === '0' || +size !== this.size ? this.size.toString() : size;\n      newSrc = arr.join('/');\n    }\n\n    const isHttp = newSrc.startsWith('http:'),\n      isHttps = newSrc.startsWith('https:');\n    if (isHttp || isHttps) newSrc = newSrc.substr(isHttp ? 5 : 6);\n\n    this.render.setAttribute(this.el.nativeElement, 'src', newSrc);\n  }\n\n  private updateError() {\n    this.render.setAttribute(\n      this.el.nativeElement,\n      'onerror',\n      `this.src='${this.error}';`,\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DelonUtilModule } from '@delon/util';\n\nimport { ImageDirective } from './image.directive';\nimport { ImageConfig } from './image.config';\n\nconst DIRECTIVES = [ImageDirective];\n\n@NgModule({\n  imports: [CommonModule, DelonUtilModule],\n  declarations: [...DIRECTIVES],\n  exports: [...DIRECTIVES],\n})\nexport class ImageModule {\n  static forRoot(): ModuleWithProviders {\n    return { ngModule: ImageModule, providers: [ImageConfig] };\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;AAAA,IAAA;;;;;oBAIkB,EAAE;;;;qBAKD,uBAAuB;;sBAT1C;IAUC;;;;;;;;;;;;;ICoBC,wBACU,IACA,QACR,GAAgB;QAFR,OAAE,GAAF,EAAE;QACF,WAAM,GAAN,MAAM;oBARe,EAAE;qBAEhB,uBAAuB;sBAEvB,KAAK;QAOpB,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;KACpC;;;;IAED,iCAAQ;;;IAAR;QACE,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;KACpB;;;;;IAED,oCAAW;;;;IAAX,UACE,OAA6D;QAE7D,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,IAAI,OAAO,CAAC,KAAK,EAAE;gBACjB,IAAI,CAAC,WAAW,EAAE,CAAC;aACpB;iBAAM;gBACL,IAAI,CAAC,MAAM,EAAE,CAAC;aACf;SACF;KACF;;;;IAEO,+BAAM;;;;;QACZ,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC;QAEtB,IAAI,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;;YAC/B,IAAM,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CACA;;YAD7B,IACE,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAC7B,GAAG,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC;gBACjB,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC;YACpE,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACxB;;QAED,IAAM,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CACD;;QADxC,IACE,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACxC,IAAI,MAAM,IAAI,OAAO;YAAE,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAE9D,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;;;;;IAGzD,oCAAW;;;;QACjB,IAAI,CAAC,MAAM,CAAC,YAAY,CACtB,IAAI,CAAC,EAAE,CAAC,aAAa,EACrB,SAAS,EACT,eAAa,IAAI,CAAC,KAAK,OAAI,CAC5B,CAAC;;;gBA3DL,SAAS,SAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE;;;;gBAhB/B,UAAU;gBACV,SAAS;gBAOF,WAAW;;;sBAUjB,KAAK,SAAC,MAAM;uBAEZ,KAAK;wBAEL,KAAK;;;QAFI,WAAW,EAAE;;;yBAxBzB;;;;;;;;ACOA,IAAM,UAAU,GAAG,CAAC,cAAc,CAAC,CAAC;;;;;;;IAQ3B,mBAAO;;;IAAd;QACE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,SAAS,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC;KAC5D;;gBARF,QAAQ,SAAC;oBACR,OAAO,EAAE,CAAC,YAAY,EAAE,eAAe,CAAC;oBACxC,YAAY,WAAM,UAAU,CAAC;oBAC7B,OAAO,WAAM,UAAU,CAAC;iBACzB;;sBAbD;;;;;;;;;;;;;;;"}
