{"version":3,"file":"sidebarNav.js.map","sources":["ng://@delon/abc/sidebar-nav/sidebar-nav.component.ts","ng://@delon/abc/sidebar-nav/sidebar-nav.module.ts"],"sourcesContent":["import {\n  Component,\n  Renderer2,\n  Inject,\n  OnInit,\n  OnDestroy,\n  HostListener,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Input,\n  Output,\n  EventEmitter,\n} from '@angular/core';\nimport { Router, NavigationEnd } from '@angular/router';\nimport { DOCUMENT, LocationStrategy } from '@angular/common';\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { MenuService, SettingsService, Menu } from '@delon/theme';\nimport { InputBoolean } from '@delon/util';\n\nimport { Nav } from './sidebar-nav.types';\n\nconst SHOWCLS = 'sidebar-nav__floating-show';\nconst FLOATINGCLS = 'sidebar-nav__floating';\n\n@Component({\n  selector: 'sidebar-nav',\n  templateUrl: './sidebar-nav.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class SidebarNavComponent implements OnInit, OnDestroy {\n  private bodyEl: HTMLBodyElement;\n  private change$: Subscription;\n  /** @inner */\n  floatingEl: HTMLDivElement;\n  list: Nav[] = [];\n\n  @Input()\n  @InputBoolean()\n  autoCloseUnderPad = true;\n\n  @Output()\n  readonly select = new EventEmitter<Menu>();\n\n  constructor(\n    private menuSrv: MenuService,\n    private settings: SettingsService,\n    private router: Router,\n    private locationStrategy: LocationStrategy,\n    private render: Renderer2,\n    private cd: ChangeDetectorRef,\n    @Inject(DOCUMENT) private doc: any,\n  ) {}\n\n  get collapsed() {\n    return this.settings.layout.collapsed;\n  }\n\n  ngOnInit() {\n    this.bodyEl = this.doc.querySelector('body');\n    this.menuSrv.openedByUrl(this.router.url);\n    this.genFloatingContainer();\n    this.change$ = <any>this.menuSrv.change.subscribe(res => {\n      this.list = res;\n      this.cd.detectChanges();\n    });\n    this.installUnderPad();\n  }\n\n  private floatingAreaClickHandle(e: MouseEvent) {\n    e.stopPropagation();\n    const linkNode = e.target as HTMLElement;\n    if (linkNode.nodeName !== 'A') {\n      return false;\n    }\n    let url: string = linkNode.getAttribute('href');\n    if (url && url.startsWith('#')) {\n      url = url.slice(1);\n    }\n    if (linkNode.dataset!.type === 'external') {\n      return true;\n    }\n\n    // å¦æéç½®äºbashHref åå»æbaseHref\n    const baseHerf = this.locationStrategy.getBaseHref();\n    if (baseHerf) {\n      url = url.slice(baseHerf.length);\n    }\n    this.router.navigateByUrl(url);\n    this.onSelect(this.menuSrv.getPathByUrl(url).pop());\n    this.hideAll();\n    e.preventDefault();\n    return false;\n  }\n\n  private clearFloatingContainer() {\n    if (!this.floatingEl) return;\n    this.floatingEl.removeEventListener(\n      'click',\n      this.floatingAreaClickHandle.bind(this),\n    );\n    // fix ie: https://github.com/ng-alain/delon/issues/52\n    if (this.floatingEl.hasOwnProperty('remove')) {\n      this.floatingEl.remove();\n    } else if (this.floatingEl.parentNode) {\n      this.floatingEl.parentNode.removeChild(this.floatingEl);\n    }\n  }\n\n  private genFloatingContainer() {\n    this.clearFloatingContainer();\n    this.floatingEl = this.render.createElement('div');\n    this.floatingEl.classList.add(FLOATINGCLS + '-container');\n    this.floatingEl.addEventListener(\n      'click',\n      this.floatingAreaClickHandle.bind(this),\n      false,\n    );\n    this.bodyEl.appendChild(this.floatingEl);\n  }\n\n  private genSubNode(linkNode: HTMLLinkElement, item: Nav): HTMLUListElement {\n    const id = `_sidebar-nav-${item.__id}`;\n    const node = linkNode.nextElementSibling.cloneNode(\n      true,\n    ) as HTMLUListElement;\n    node.id = id;\n    node.classList.add(FLOATINGCLS);\n    node.addEventListener(\n      'mouseleave',\n      () => {\n        node.classList.remove(SHOWCLS);\n      },\n      false,\n    );\n    this.floatingEl.appendChild(node);\n    return node;\n  }\n\n  private hideAll() {\n    const allNode = this.floatingEl.querySelectorAll('.' + FLOATINGCLS);\n    for (let i = 0; i < allNode.length; i++) {\n      allNode[i].classList.remove(SHOWCLS);\n    }\n  }\n\n  // calculate the node position values.\n  private calPos(linkNode: HTMLLinkElement, node: HTMLUListElement) {\n    const rect = linkNode.getBoundingClientRect();\n    // bug: https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/14721015/\n    const scrollTop = Math.max(\n      this.doc.documentElement.scrollTop,\n      this.bodyEl.scrollTop,\n    );\n    const docHeight = Math.max(\n      this.doc.documentElement.clientHeight,\n      this.bodyEl.clientHeight,\n    );\n    let offsetHeight = 0;\n    if (docHeight < rect.top + node.clientHeight) {\n      offsetHeight = rect.top + node.clientHeight - docHeight;\n    }\n    node.style.top = `${rect.top + scrollTop - offsetHeight}px`;\n    node.style.left = `${rect.right + 5}px`;\n  }\n\n  showSubMenu(e: MouseEvent, item: Nav) {\n    if (this.collapsed !== true) {\n      return;\n    }\n    e.preventDefault();\n    const linkNode = e.target as Element;\n    this.genFloatingContainer();\n    const subNode = this.genSubNode(linkNode as HTMLLinkElement, item);\n    this.hideAll();\n    subNode.classList.add(SHOWCLS);\n    this.calPos(linkNode as HTMLLinkElement, subNode);\n  }\n\n  onSelect(item: Menu) {\n    this.select.emit(item);\n  }\n\n  toggleOpen(item: Nav) {\n    this.menuSrv.visit((i, p) => {\n      if (i !== item) i._open = false;\n    });\n    let pItem = item.__parent;\n    while (pItem) {\n      pItem._open = true;\n      pItem = pItem.__parent;\n    }\n    item._open = !item._open;\n    this.cd.markForCheck();\n  }\n\n  @HostListener('click')\n  _click() {\n    if (this.isPad && this.collapsed) {\n      this.openAside(false);\n      this.hideAll();\n    }\n  }\n\n  @HostListener('document:click')\n  _docClick() {\n    this.hideAll();\n  }\n\n  ngOnDestroy(): void {\n    this.change$.unsubscribe();\n    if (this.route$) this.route$.unsubscribe();\n    this.clearFloatingContainer();\n  }\n\n  // #region Under pad\n\n  private get isPad(): boolean {\n    return window.innerWidth < 768;\n  }\n\n  private route$: Subscription;\n  private installUnderPad() {\n    if (!this.autoCloseUnderPad) return;\n    this.route$ = <any>(\n      this.router.events\n        .pipe(filter(e => e instanceof NavigationEnd))\n        .subscribe(s => this.underPad())\n    );\n    this.underPad();\n  }\n\n  private underPad() {\n    if (this.isPad && !this.collapsed) {\n      setTimeout(() => this.openAside(true));\n    }\n  }\n\n  private openAside(status: boolean) {\n    this.settings.setLayout('collapsed', status);\n  }\n\n  // #endregion\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { NgZorroAntdModule } from 'ng-zorro-antd';\nimport { DelonUtilModule } from '@delon/util';\n\nimport { SidebarNavComponent } from './sidebar-nav.component';\n\n@NgModule({\n  imports: [CommonModule, RouterModule, NgZorroAntdModule, DelonUtilModule],\n  declarations: [SidebarNavComponent],\n  exports: [SidebarNavComponent],\n})\nexport class SidebarNavModule {\n  static forRoot(): ModuleWithProviders {\n    return { ngModule: SidebarNavModule, providers: [] };\n  }\n}\n"],"names":["tslib_1.__decorate"],"mappings":"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"}
