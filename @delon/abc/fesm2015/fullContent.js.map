{"version":3,"file":"fullContent.js","sources":["../../../../packages/abc/full-content/full-content.service.ts","../../../../packages/abc/full-content/full-content.component.ts","../../../../packages/abc/full-content/full-content-toggle.directive.ts","../../../../packages/abc/full-content/full-content.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { share } from 'rxjs/operators';\n\n@Injectable({ providedIn: 'root' })\nexport class FullContentService {\n  private _change = new BehaviorSubject<boolean | null>(null);\n\n  /** 切换全屏工作区状态 */\n  toggle(): void {\n    this._change.next(true);\n  }\n\n  get change(): Observable<boolean | null> {\n    return this._change.pipe(share());\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Inject,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { ActivationEnd, ActivationStart, Event, Router } from '@angular/router';\nimport { BooleanInput, InputBoolean, InputNumber, NumberInput } from '@delon/util/other';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { debounceTime, filter } from 'rxjs/operators';\nimport { FullContentService } from './full-content.service';\n\nconst wrapCls = `full-content__body`;\nconst openedCls = `full-content__opened`;\nconst hideTitleCls = `full-content__hidden-title`;\n\n@Component({\n  selector: 'full-content',\n  exportAs: 'fullContent',\n  template: ` <ng-content></ng-content> `,\n  host: {\n    '[class.full-content]': 'true',\n    '[style.height.px]': '_height',\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class FullContentComponent implements AfterViewInit, OnInit, OnChanges, OnDestroy {\n  static ngAcceptInputType_fullscreen: BooleanInput;\n  static ngAcceptInputType_hideTitle: BooleanInput;\n  static ngAcceptInputType_padding: NumberInput;\n\n  private bodyEl: HTMLElement;\n  private inited = false;\n  private srv$: Subscription;\n  private route$: Subscription;\n  private id = `_full-content-${Math.random().toString(36).substring(2)}`;\n  private scroll$: Subscription | null = null;\n\n  _height = 0;\n\n  @Input() @InputBoolean() fullscreen: boolean;\n  @Input() @InputBoolean() hideTitle = true;\n  @Input() @InputNumber() padding = 24;\n  @Output() readonly fullscreenChange = new EventEmitter<boolean>();\n\n  constructor(\n    private el: ElementRef<HTMLElement>,\n    private cdr: ChangeDetectorRef,\n    private srv: FullContentService,\n    private router: Router,\n    @Inject(DOCUMENT) private doc: any,\n  ) {}\n\n  private updateCls(): void {\n    const clss = this.bodyEl.classList;\n    if (this.fullscreen) {\n      clss.add(openedCls);\n      if (this.hideTitle) {\n        clss.add(hideTitleCls);\n      }\n    } else {\n      clss.remove(openedCls);\n      if (this.hideTitle) {\n        clss.remove(hideTitleCls);\n      }\n    }\n  }\n\n  private update(): void {\n    this.updateCls();\n    this.updateHeight();\n    this.fullscreenChange.emit(this.fullscreen);\n  }\n\n  private updateHeight(): void {\n    this._height = this.bodyEl.getBoundingClientRect().height - this.el.nativeElement.getBoundingClientRect().top - this.padding;\n    this.cdr.detectChanges();\n  }\n\n  private removeInBody(): void {\n    this.bodyEl.classList.remove(wrapCls, openedCls, hideTitleCls);\n  }\n\n  ngOnInit(): void {\n    this.inited = true;\n    this.bodyEl = this.doc.querySelector('body');\n    this.bodyEl.classList.add(wrapCls);\n    this.el.nativeElement.id = this.id;\n\n    this.updateCls();\n\n    // when window resize\n    this.scroll$ = fromEvent(window, 'resize')\n      .pipe(debounceTime(200))\n      .subscribe(() => this.updateHeight());\n\n    // when servier changed\n    this.srv$ = this.srv.change.pipe(filter(res => res !== null)).subscribe(() => this.toggle());\n\n    // when router changed\n    this.route$ = this.router.events\n      .pipe(\n        filter((e: Event) => e instanceof ActivationStart || e instanceof ActivationEnd),\n        debounceTime(200),\n      )\n      .subscribe(() => {\n        if (!!this.doc.querySelector('#' + this.id)) {\n          this.bodyEl.classList.add(wrapCls);\n          this.updateCls();\n        } else {\n          this.removeInBody();\n        }\n      });\n  }\n\n  toggle(): void {\n    this.fullscreen = !this.fullscreen;\n    this.update();\n    this.updateHeight();\n  }\n\n  ngAfterViewInit(): void {\n    setTimeout(() => this.updateHeight());\n  }\n\n  ngOnChanges(): void {\n    if (this.inited) this.update();\n  }\n\n  ngOnDestroy(): void {\n    this.removeInBody();\n    this.scroll$!.unsubscribe();\n    this.srv$.unsubscribe();\n    this.route$.unsubscribe();\n  }\n}\n","import { Directive } from '@angular/core';\nimport { FullContentComponent } from './full-content.component';\n\n@Directive({\n  selector: '[full-toggle]',\n  exportAs: 'fullToggle',\n  host: {\n    '(click)': '_click()',\n  },\n})\nexport class FullContentToggleDirective {\n  constructor(private parent: FullContentComponent) {}\n\n  _click(): void {\n    this.parent.toggle();\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FullContentToggleDirective } from './full-content-toggle.directive';\nimport { FullContentComponent } from './full-content.component';\n\nconst COMPONENTS = [FullContentComponent, FullContentToggleDirective];\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: COMPONENTS,\n  exports: COMPONENTS,\n})\nexport class FullContentModule {}\n"],"names":[],"mappings":"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"}