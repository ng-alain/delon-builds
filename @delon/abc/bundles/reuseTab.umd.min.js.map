{"version":3,"sources":["../../../../packages/abc/reuse-tab/reuse-tab-context-menu.component.ts","../../../../packages/abc/reuse-tab/reuse-tab-context.service.ts","../../../../packages/abc/reuse-tab/reuse-tab-context.component.ts","../../../../packages/abc/reuse-tab/reuse-tab-context.directive.ts","../../../../node_modules/tslib/tslib.es6.js","../../../../packages/abc/reuse-tab/reuse-tab.interfaces.ts","../../../../packages/abc/reuse-tab/reuse-tab.service.ts","../../../../packages/abc/reuse-tab/reuse-tab.component.ts","../../../../packages/abc/reuse-tab/reuse-tab.strategy.ts","../../../../packages/abc/reuse-tab/reuse-tab.module.ts"],"names":["ReuseTabContextMenuComponent","i18nSrv","this","close","EventEmitter","Object","defineProperty","prototype","_i18n","value","assign","getData","event","ctrlKey","notify","type","next","item","includeNonCloseable","ngOnInit","closable","click","e","custom","preventDefault","stopPropagation","last","isDisabled","fn","disabled","closeMenu","button","Component","args","selector","template","host","(document:click)","(document:contextmenu)","preserveWhitespaces","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","DelonLocaleService","Input","Output","ReuseTabContextService","overlay","show","Subject","remove","ref","detach","dispose","open","context","_this","customContextMenu","fakeElement","ElementRef","getBoundingClientRect","bottom","clientY","height","left","clientX","right","top","width","positions","ConnectionPositionPair","originX","originY","overlayX","overlayY","positionStrategy","position","flexibleConnectedTo","withPositions","create","panelClass","scrollStrategy","scrollStrategies","comp","attach","ComponentPortal","instance","i18n","sub$","Subscription","add","subscribe","res","onDestroy","unsubscribe","Injectable","Overlay","ReuseTabContextComponent","srv","change","emit","ngOnDestroy","ReuseTabContextDirective","_onContextMenu","Directive","exportAs","(contextmenu)","__decorate","decorators","target","key","desc","d","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","__metadata","metadataKey","metadataValue","metadata","__read","o","n","m","Symbol","iterator","call","ar","done","push","error","__spread","concat","ReuseTabMatchMode","ReuseTabService","injector","menuService","_inited","_max","_keepingScroll","_cachedChange","BehaviorSubject","_cached","_titleCached","_closableCached","positionBuffer","debug","routeParamMatchMode","mode","Menu","excludes","get","ActivatedRoute","snapshot","getUrl","Math","min","max","pop","initScroll","asObservable","url","curUrl","text","di","active","title","list","index","findIndex","w","exists","find","idx","destroy","_handle","splice","removeUrlBuffer","closeRight","start","count","clear","forEach","filter","move","data","slice","replace","newUrl","Router","navigateByUrl","getTitle","route","titleI18n","menu","getMenu","clearTitleCached","getClosable","reuseClosable","URL","clearClosableCached","getTruthRoute","firstChild","segments","join","parent","reverse","can","reuse","isExclude","test","refresh","componentRef","_i","console","warn","apply","init","menus","getPathByUrl","runHook","method","compThis","hasInValidRoute","routeConfig","loadChildren","children","shouldDetach","store","_snapshot","isAdd","getKeepingScroll","closeIdx","shouldAttach","ret","compRef","retrieve","shouldReuseRoute","future","curr","path","indexOf","keepingScroll","ROUTER_CONFIGURATION","scrollPositionRestoration","ScrollService","_router$","events","NavigationStart","ss","getScrollPosition","keepingScrollContainer","NavigationEnd","item_1","isDisabledInRouter","scrollToPosition","setTimeout","complete","providedIn","Injector","MenuService","ReuseTabComponent","cdr","router","doc","updatePos$","pos","allowClose","tabType","_keepingScrollContainer","querySelector","genTit","fanyi","genCurItem","snapshotTrue","genList","ls","items","map","addCurrent","toPos","curItem","detectChanges","updateTitle","contextMenuChange","_close","_to","cb","then","activate","pipe","untilDestroyed","debounceTime","tabset","nzSelectedIndex","_a","inited","ngOnChanges","changes","[class.reuse-tab]","[class.reuse-tab__line]","[class.reuse-tab__card]","[class.reuse-tab__disabled]","providers","ChangeDetectorRef","Optional","Inject","ALAIN_I18N_TOKEN","DOCUMENT","ViewChild","InputBoolean","InputNumber","UntilDestroy","ReuseTabStrategy","handle","COMPONENTS","NOEXPORTS","NgModule","imports","CommonModule","RouterModule","DelonLocaleModule","NzMenuModule","NzTabsModule","NzIconModule","OverlayModule","declarations","exports"],"mappings":"kuCAoCE,SAAAA,EAAoBC,GAAAC,KAAAD,QAAAA,EANDC,KAAAC,MAAQ,IAAIC,EAAAA,oBAb/BC,OAAAC,eACIN,EAAAO,UAAA,OAAI,KAMR,WACE,OAAOL,KAAKM,WARd,SACSC,GACPP,KAAKM,MAAKH,OAAAK,OAAAL,OAAAK,OAAA,GACLR,KAAKD,QAAQU,QAAQ,aACrBF,oCAWPJ,OAAAC,eAAIN,EAAAO,UAAA,sBAAmB,KAAvB,WACE,OAAOL,KAAKU,MAAMC,yCAKZb,EAAAO,UAAAO,OAAA,SAAOC,GACbb,KAAKC,MAAMa,KAAK,CACdD,KAAIA,EACJE,KAAMf,KAAKe,KACXC,oBAAqBhB,KAAKgB,uBAI9BlB,EAAAO,UAAAY,SAAA,WACMjB,KAAKgB,sBAAqBhB,KAAKe,KAAKG,UAAW,IAGrDpB,EAAAO,UAAAc,MAAA,SAAMC,EAAeP,EAAiBQ,GAGpC,GAFAD,EAAEE,iBACFF,EAAEG,mBACW,UAATV,GAAqBb,KAAKe,KAAKG,YACtB,eAATL,IAAyBb,KAAKe,KAAKS,MAAvC,CAEA,GAAIH,EAAQ,CACV,GAAIrB,KAAKyB,WAAWJ,GAAS,OAC7BA,EAAOK,GAAG1B,KAAKe,KAAMM,GAEvBrB,KAAKY,OAAOC,KAGdf,EAAAO,UAAAoB,WAAA,SAAWJ,GACT,QAAOA,EAAOM,UAAWN,EAAOM,SAAS3B,KAAKe,OAGhDjB,EAAAO,UAAAuB,UAAA,SAAUlB,GACW,UAAfA,EAAMG,MAAqC,IAAjBH,EAAMmB,QACpC7B,KAAKY,OAAO,gCAjEfkB,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,yBACVC,SAAA,+1BACAC,KAAM,CACJC,mBAAoB,oBACpBC,yBAA0B,qBAE5BC,qBAAqB,EACrBC,gBAAiBC,EAAAA,wBAAwBC,OACzCC,cAAeC,EAAAA,kBAAkBC,kDAZ1BC,EAAAA,oDAgBNC,EAAAA,oBAUAA,EAAAA,qBACAA,EAAAA,iCACAA,EAAAA,qBACAC,EAAAA,2BCfD,SAAAC,EAAoBC,GAAAhD,KAAAgD,QAAAA,EAHpBhD,KAAAiD,KAAmC,IAAIC,EAAAA,QACvClD,KAAAC,MAAyC,IAAIiD,EAAAA,eAI7CH,EAAA1C,UAAA8C,OAAA,WACOnD,KAAKoD,MACVpD,KAAKoD,IAAIC,SACTrD,KAAKoD,IAAIE,UACTtD,KAAKoD,IAAM,OAGbL,EAAA1C,UAAAkD,KAAA,SAAKC,GAAL,IAAAC,EAAAzD,KACEA,KAAKmD,SACG,IAAAzC,EAAmC8C,EAAO9C,MAAnCK,EAA4ByC,EAAOzC,KAA7B2C,EAAsBF,EAAOE,kBAC5CC,EAAc,IAAIC,EAAAA,WAAW,CACjCC,sBAAuB,WAAkB,MAAA,CACvCC,OAAQpD,EAAMqD,QACdC,OAAQ,EACRC,KAAMvD,EAAMwD,QACZC,MAAOzD,EAAMwD,QACbE,IAAK1D,EAAMqD,QACXM,MAAO,MAGLC,EAAY,CAChB,IAAIC,EAAAA,uBAAuB,CAAEC,QAAS,QAASC,QAAS,UAAY,CAAEC,SAAU,QAASC,SAAU,QACnG,IAAIJ,EAAAA,uBAAuB,CAAEC,QAAS,QAASC,QAAS,OAAS,CAAEC,SAAU,QAASC,SAAU,YAE5FC,EAAmB5E,KAAKgD,QAAQ6B,WAAWC,oBAAoBnB,GAAaoB,cAAcT,GAChGtE,KAAKoD,IAAMpD,KAAKgD,QAAQgC,OAAO,CAC7BJ,iBAAgBA,EAChBK,WAAY,gBACZC,eAAgBlF,KAAKgD,QAAQmC,iBAAiBlF,UAEhD,IAAMmF,EAAOpF,KAAKoD,IAAIiC,OAAO,IAAIC,EAAAA,gBAAgBxF,IAC3CyF,EAAWH,EAAKG,SACtBA,EAASC,KAAOxF,KAAKwF,KACrBD,EAASxE,KAAIZ,OAAAK,OAAA,GAAQO,GACrBwE,EAAS7B,kBAAoBA,EAC7B6B,EAAS7E,MAAQA,EAEjB,IAAM+E,EAAO,IAAIC,EAAAA,aACjBD,EAAKE,IACHJ,EAAStF,MAAM2F,WAAU,SAACC,GACxBpC,EAAKxD,MAAMa,KAAK+E,GAChBpC,EAAKN,aAGTiC,EAAKU,WAAU,WAAM,OAAAL,EAAKM,2CAtD7BC,EAAAA,sDAPgCC,EAAAA,4BCmB/B,SAAAC,EAAoBC,GAApB,IAAA1C,EAAAzD,KAAoBA,KAAAmG,IAAAA,EATZnG,KAAAyF,KAAqB,IAAIC,EAAAA,aAOd1F,KAAAoG,OAAS,IAAIlG,EAAAA,aAG9BF,KAAKyF,KAAKE,IAAIQ,EAAIlD,KAAK2C,WAAU,SAAApC,GAAW,OAAAC,EAAK0C,IAAI5C,KAAKC,OAC1DxD,KAAKyF,KAAKE,IAAIQ,EAAIlG,MAAM2F,WAAU,SAAAC,GAAO,OAAApC,EAAK2C,OAAOC,KAAKR,cAT5D1F,OAAAC,eACI8F,EAAA7F,UAAA,OAAI,KADR,SACSE,GACPP,KAAKmG,IAAIX,KAAOjF,mCAUlB2F,EAAA7F,UAAAiG,YAAA,WACEtG,KAAKyF,KAAKM,wCApBbjE,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,oBACVC,SAAU,gDALHc,mCAUNF,EAAAA,sBAKAC,EAAAA,2BCFD,SAAAyD,EAAoBJ,GAAAnG,KAAAmG,IAAAA,SAEpBI,EAAAlG,UAAAmG,eAAA,SAAe9F,GACbV,KAAKmG,IAAIlD,KAAKnC,KAAK,CACjBJ,MAAKA,EACLK,KAAMf,KAAKe,KACX2C,kBAAmB1D,KAAK0D,oBAE1BhD,EAAMY,iBACNZ,EAAMa,4CApBTkF,EAAAA,UAAS1E,KAAA,CAAC,CACTC,SAAU,2BACV0E,SAAU,sBACVxE,KAAM,CACJyE,gBAAiB,uEAPZ5D,mCAWNF,EAAAA,MAAKd,KAAA,CAAC,qDACNc,EAAAA,kBCyCa+D,EAAWC,EAAYC,EAAQC,EAAKC,GAChD,IAA2HC,EAAvHC,EAAIC,UAAUC,OAAQC,EAAIH,EAAI,EAAIJ,EAAkB,OAATE,EAAgBA,EAAO7G,OAAOmH,yBAAyBR,EAAQC,GAAOC,EACrH,GAAuB,iBAAZO,SAAoD,mBAArBA,QAAQC,SAAyBH,EAAIE,QAAQC,SAASX,EAAYC,EAAQC,EAAKC,QACpH,IAAK,IAAIS,EAAIZ,EAAWO,OAAS,EAAGK,GAAK,EAAGA,KAASR,EAAIJ,EAAWY,MAAIJ,GAAKH,EAAI,EAAID,EAAEI,GAAKH,EAAI,EAAID,EAAEH,EAAQC,EAAKM,GAAKJ,EAAEH,EAAQC,KAASM,GAChJ,OAAOH,EAAI,GAAKG,GAAKlH,OAAOC,eAAe0G,EAAQC,EAAKM,GAAIA,WAOhDK,EAAWC,EAAaC,GACpC,GAAuB,iBAAZL,SAAoD,mBAArBA,QAAQM,SAAyB,OAAON,QAAQM,SAASF,EAAaC,GAyCvFzH,OAAO6E,gBAwBpB8C,EAAOC,EAAGC,GACtB,IAAIC,EAAsB,mBAAXC,QAAyBH,EAAEG,OAAOC,UACjD,IAAKF,EAAG,OAAOF,EACf,IAAmBV,EAAYjG,EAA3BqG,EAAIQ,EAAEG,KAAKL,GAAOM,EAAK,GAC3B,IACI,WAAc,IAANL,GAAgBA,KAAM,MAAQX,EAAII,EAAE3G,QAAQwH,MAAMD,EAAGE,KAAKlB,EAAE9G,OAExE,MAAOiI,GAASpH,EAAI,CAAEoH,MAAOA,WAEzB,IACQnB,IAAMA,EAAEiB,OAASL,EAAIR,EAAU,SAAIQ,EAAEG,KAAKX,WAExC,GAAIrG,EAAG,MAAMA,EAAEoH,OAE7B,OAAOH,WAIKI,IACZ,IAAK,IAAIJ,EAAK,GAAIZ,EAAI,EAAGA,EAAIN,UAAUC,OAAQK,IAC3CY,EAAKA,EAAGK,OAAOZ,EAAOX,UAAUM,KACpC,OAAOY,EAqDX,ICvMYM,EDuMaxI,OAAO6E,QCvMpB2D,EAAAA,EAAAA,oBAAAA,EAAAA,kBAAiB,KAW3BA,EAAA,KAAA,GAAA,OAWAA,EAAAA,EAAA,UAAA,GAAA,YAIAA,EAAAA,EAAA,IAAA,GAAA,uBC6UA,SAAAC,EAAoBC,EAA4BC,GAA5B9I,KAAA6I,SAAAA,EAA4B7I,KAAA8I,YAAAA,EAlVxC9I,KAAA+I,SAAU,EACV/I,KAAAgJ,KAAO,GACPhJ,KAAAiJ,gBAAiB,EACjBjJ,KAAAkJ,cAAgB,IAAIC,EAAAA,gBAAuC,MAC3DnJ,KAAAoJ,QAA4B,GAC5BpJ,KAAAqJ,aAA8C,GAC9CrJ,KAAAsJ,gBAA8C,GAG9CtJ,KAAAuJ,eAAsD,GAE9DvJ,KAAAwJ,OAAQ,EACRxJ,KAAAyJ,oBAAmD,SACnDzJ,KAAA0J,KAAOf,EAAAA,kBAAkBgB,KAEzB3J,KAAA4J,SAAqB,UAErBzJ,OAAAC,eAAYwI,EAAAvI,UAAA,WAAQ,KAApB,WACE,OAAOL,KAAK6I,SAASgB,IAAIC,EAAAA,gBAAgBC,0CAU3C5J,OAAAC,eAAIwI,EAAAvI,UAAA,SAAM,KAAV,WACE,OAAOL,KAAK+I,yCAQd5I,OAAAC,eAAIwI,EAAAvI,UAAA,SAAM,KAAV,WACE,OAAOL,KAAKgK,OAAOhK,KAAK+J,2CAM1B5J,OAAAC,eAAIwI,EAAAvI,UAAA,MAAG,KAAP,SAAQE,GACNP,KAAKgJ,KAAOiB,KAAKC,IAAID,KAAKE,IAAI5J,EAAO,GAAI,KACzC,IAAK,IAAIkH,EAAIzH,KAAKoJ,QAAQhC,OAAQK,EAAIzH,KAAKgJ,KAAMvB,IAC/CzH,KAAKoJ,QAAQgB,uCAGjBjK,OAAAC,eAAIwI,EAAAvI,UAAA,gBAAa,KAIjB,WACE,OAAOL,KAAKiJ,oBALd,SAAkB1I,GAChBP,KAAKiJ,eAAiB1I,EACtBP,KAAKqK,8CAOPlK,OAAAC,eAAIwI,EAAAvI,UAAA,QAAK,KAAT,WACE,OAAOL,KAAKoJ,yCAGdjJ,OAAAC,eAAIwI,EAAAvI,UAAA,QAAK,KAAT,WACE,OAAOL,KAAKoJ,QAAQhC,wCAGtBjH,OAAAC,eAAIwI,EAAAvI,UAAA,SAAM,KAAV,WACE,OAAOL,KAAKkJ,cAAcoB,gDAG5BnK,OAAAC,eAAIwI,EAAAvI,UAAA,QAAK,KAAT,SAAUE,GACR,IAAMgK,EAAMvK,KAAKwK,OACI,iBAAVjK,IAAoBA,EAAQ,CAAEkK,KAAMlK,IAC/CP,KAAKqJ,aAAakB,GAAOhK,EACzBP,KAAK0K,GAAG,6BAA8BnK,GACtCP,KAAKkJ,cAAcpI,KAAK,CACtB6J,OAAQ,QACRJ,IAAGA,EACHK,MAAOrK,EACPsK,KAAM7K,KAAKoJ,2CAIfR,EAAAvI,UAAAyK,MAAA,SAAMP,GACJ,OAAOvK,KAAKoJ,QAAQ2B,WAAU,SAAAC,GAAK,OAAAA,EAAET,MAAQA,MAG/C3B,EAAAvI,UAAA4K,OAAA,SAAOV,GACL,OAA4B,IAArBvK,KAAK8K,MAAMP,IAGpB3B,EAAAvI,UAAAwJ,IAAA,SAAIU,GACF,OAAOA,GAAMvK,KAAKoJ,QAAQ8B,MAAK,SAAAF,GAAK,OAAAA,EAAET,MAAQA,MAAe,MAEvD3B,EAAAvI,UAAA8C,OAAA,SAAOoH,EAAsBvJ,GACnC,IAAMmK,EAAqB,iBAARZ,EAAmBvK,KAAK8K,MAAMP,GAAOA,EAClDxJ,GAAgB,IAAToK,EAAanL,KAAKoJ,QAAQ+B,GAAO,KAC9C,SAAKpK,IAAUC,IAAwBD,EAAKG,YAE5ClB,KAAKoL,QAAQrK,EAAKsK,SAElBrL,KAAKoJ,QAAQkC,OAAOH,EAAK,UAClBnL,KAAKqJ,aAAakB,IAClB,IAOT3B,EAAAvI,UAAAJ,MAAA,SAAMsK,EAAavJ,GAQjB,YARiB,IAAAA,IAAAA,GAAA,GACjBhB,KAAKuL,gBAAkBhB,EAEvBvK,KAAKmD,OAAOoH,EAAKvJ,GAEjBhB,KAAKkJ,cAAcpI,KAAK,CAAE6J,OAAQ,QAASJ,IAAGA,EAAEM,KAAM7K,KAAKoJ,UAE3DpJ,KAAK0K,GAAG,YAAaH,IACd,GAOT3B,EAAAvI,UAAAmL,WAAA,SAAWjB,EAAavJ,QAAA,IAAAA,IAAAA,GAAA,GAEtB,IADA,IAAMyK,EAAQzL,KAAK8K,MAAMP,GAChB9C,EAAIzH,KAAK0L,MAAQ,EAAGjE,EAAIgE,EAAOhE,IACtCzH,KAAKmD,OAAOsE,EAAGzG,GAQjB,OALAhB,KAAKuL,gBAAkB,KAEvBvL,KAAKkJ,cAAcpI,KAAK,CAAE6J,OAAQ,aAAcJ,IAAGA,EAAEM,KAAM7K,KAAKoJ,UAEhEpJ,KAAK0K,GAAG,oBAAqBH,IACtB,GAOT3B,EAAAvI,UAAAsL,MAAA,SAAM3K,GAAN,IAAAyC,EAAAzD,UAAM,IAAAgB,IAAAA,GAAA,GACJhB,KAAKoJ,QAAQwC,SAAQ,SAAAZ,IACdhK,GAAuBgK,EAAE9J,UAAUuC,EAAK2H,QAAQJ,EAAEK,YAEzDrL,KAAKoJ,QAAUpJ,KAAKoJ,QAAQyC,QAAO,SAAAb,GAAK,OAAChK,IAAwBgK,EAAE9J,YAEnElB,KAAKuL,gBAAkB,KAEvBvL,KAAKkJ,cAAcpI,KAAK,CAAE6J,OAAQ,QAASE,KAAM7K,KAAKoJ,UAEtDpJ,KAAK0K,GAAG,oBAmBV9B,EAAAvI,UAAAyL,KAAA,SAAKvB,EAAa1F,GAChB,IAAM4G,EAAQzL,KAAKoJ,QAAQ2B,WAAU,SAAAC,GAAK,OAAAA,EAAET,MAAQA,KACpD,IAAe,IAAXkB,EAAJ,CACA,IAAMM,EAAO/L,KAAKoJ,QAAQ4C,QAC1BD,EAAKT,OAAOzG,EAAW,EAAIkH,EAAK3E,OAASvC,EAAWA,EAAU,EAAGkH,EAAKT,OAAOG,EAAO,GAAG,IACvFzL,KAAKoJ,QAAU2C,EACf/L,KAAKkJ,cAAcpI,KAAK,CACtB6J,OAAQ,OACRJ,IAAGA,EACH1F,SAAQA,EACRgG,KAAM7K,KAAKoJ,YAMfR,EAAAvI,UAAA4L,QAAA,SAAQC,GACN,IAAM3B,EAAMvK,KAAKwK,OACbxK,KAAKiL,OAAOV,GACdvK,KAAKC,MAAMsK,GAAK,GAEhBvK,KAAKuL,gBAAkBhB,EAEzBvK,KAAK6I,SAASgB,IAAYsC,EAAAA,QAAQC,cAAcF,IAYlDtD,EAAAvI,UAAAgM,SAAA,SAAS9B,EAAa+B,GACpB,GAAItM,KAAKqJ,aAAakB,GACpB,OAAOvK,KAAKqJ,aAAakB,GAG3B,GAAI+B,GAASA,EAAMP,OAASO,EAAMP,KAAKQ,WAAaD,EAAMP,KAAKnB,OAC7D,MAAO,CACLH,KAAM6B,EAAMP,KAAKnB,MACjBpF,KAAM8G,EAAMP,KAAKQ,WAIrB,IAAMC,EAAOxM,KAAKyM,QAAQlC,GAC1B,OAAOiC,EAAO,CAAE/B,KAAM+B,EAAK/B,KAAMjF,KAAMgH,EAAKhH,MAAS,CAAEiF,KAAMF,IAM/D3B,EAAAvI,UAAAqM,iBAAA,WACE1M,KAAKqJ,aAAe,IAGtBlJ,OAAAC,eAAIwI,EAAAvI,UAAA,WAAQ,KAAZ,SAAaE,GACX,IAAMgK,EAAMvK,KAAKwK,OACjBxK,KAAKsJ,gBAAgBiB,GAAOhK,EAC5BP,KAAK0K,GAAG,gCAAiCnK,GACzCP,KAAKkJ,cAAcpI,KAAK,CACtB6J,OAAQ,WACRzJ,SAAUX,EACVsK,KAAM7K,KAAKoJ,2CAafR,EAAAvI,UAAAsM,YAAA,SAAYpC,EAAa+B,GACvB,QAAyC,IAA9BtM,KAAKsJ,gBAAgBiB,GAAsB,OAAOvK,KAAKsJ,gBAAgBiB,GAElF,GAAI+B,GAASA,EAAMP,MAA4C,kBAA7BO,EAAMP,KAAKa,cAA6B,OAAON,EAAMP,KAAKa,cAE5F,IAAMJ,EAAOxM,KAAK0J,OAASf,EAAAA,kBAAkBkE,IAAM7M,KAAKyM,QAAQlC,GAAO,KACvE,OAAIiC,GAAsC,kBAAvBA,EAAKI,eAAoCJ,EAAKI,eAOnEhE,EAAAvI,UAAAyM,oBAAA,WACE9M,KAAKsJ,gBAAkB,IAEzBV,EAAAvI,UAAA0M,cAAA,SAAcT,GAEZ,IADA,IAAIxL,EAAOwL,EACJxL,EAAKkM,YAAYlM,EAAOA,EAAKkM,WACpC,OAAOlM,GAKT8H,EAAAvI,UAAA2J,OAAA,SAAOsC,GAGL,IAFA,IAAIxL,EAAOd,KAAK+M,cAAcT,GACxBW,EAAqB,GACpBnM,GACLmM,EAAS1E,KAAKzH,EAAKyJ,IAAI2C,KAAK,MAC5BpM,EAAOA,EAAKqM,OAQd,MALE,IACAF,EACGpB,QAAO,SAAApE,GAAK,OAAAA,KACZ2F,UACAF,KAAK,MAMZtE,EAAAvI,UAAAgN,IAAA,SAAIf,GACF,IAAM/B,EAAMvK,KAAKgK,OAAOsC,GACxB,GAAI/B,IAAQvK,KAAKuL,gBAAiB,OAAO,EAEzC,GAAIe,EAAMP,MAAoC,kBAArBO,EAAMP,KAAKuB,MAAqB,OAAOhB,EAAMP,KAAKuB,MAE3E,GAAItN,KAAK0J,OAASf,EAAAA,kBAAkBkE,IAAK,CACvC,IAAML,EAAOxM,KAAKyM,QAAQlC,GAC1B,IAAKiC,EAAM,OAAO,EAClB,GAAIxM,KAAK0J,OAASf,EAAAA,kBAAkBgB,MAClC,IAAmB,IAAf6C,EAAKc,MAAiB,OAAO,OAEjC,IAAKd,EAAKc,QAAwB,IAAfd,EAAKc,MAAgB,OAAO,EAEjD,OAAO,EAET,OAAQtN,KAAKuN,UAAUhD,IAGzB3B,EAAAvI,UAAAkN,UAAA,SAAUhD,GACR,OAAsD,IAA/CvK,KAAK4J,SAASmB,WAAU,SAAA1D,GAAK,OAAAA,EAAEmG,KAAKjD,OAM7C3B,EAAAvI,UAAAoN,QAAA,SAAQ1B,GACN/L,KAAKkJ,cAAcpI,KAAK,CAAE6J,OAAQ,UAAWoB,KAAIA,KAM3CnD,EAAAvI,UAAA+K,QAAA,SAAQC,GACVA,GAAWA,EAAQqC,cAAgBrC,EAAQqC,aAAatC,SAASC,EAAQqC,aAAatC,WAGpFxC,EAAAvI,UAAAqK,GAAA,eAAG,IAAA3I,EAAA,GAAA4L,EAAA,EAAAA,EAAAxG,UAAAC,OAAAuG,IAAA5L,EAAA4L,GAAAxG,UAAAwG,GACJ3N,KAAKwJ,OAEVoE,QAAQC,KAAIC,MAAZF,QAAOnF,EAAS1G,KAOlB6G,EAAAvI,UAAA0N,KAAA,WACE/N,KAAKqK,aACLrK,KAAK+I,SAAU,GAGTH,EAAAvI,UAAAoM,QAAA,SAAQlC,GACd,IAAMyD,EAAQhO,KAAK8I,YAAYmF,aAAa1D,GAC5C,OAAKyD,GAA0B,IAAjBA,EAAM5G,OACb4G,EAAM5D,MAD4B,MAI3CxB,EAAAvI,UAAA6N,QAAA,SAAQC,EAAwB/I,EAAkCvE,SAAA,IAAAA,IAAAA,EAAA,QAC5C,iBAATuE,KAETA,EADapF,KAAKoJ,QAAQhE,GACdiG,QAAQqC,cAEtB,IAAMU,EAAWhJ,EAAKG,SACtB,GAAY,MAARH,GAAiBgJ,EAArB,CAGA,IAAM1M,EAAK0M,EAASD,GACF,mBAAPzM,IAGI,iBAAXyM,EACFzM,EAAG0G,KAAKgG,EAAUvN,GAEjBa,EAAkB0G,KAAKgG,MAIpBxF,EAAAvI,UAAAgO,gBAAA,SAAgB/B,GACtB,OAAQA,EAAMgC,eAAiBhC,EAAMgC,YAAYC,gBAAkBjC,EAAMgC,YAAYE,UAMvF5F,EAAAvI,UAAAoO,aAAA,SAAanC,GACX,OAAItM,KAAKqO,gBAAgB/B,KACzBtM,KAAK0K,GAAG,gBAAiB1K,KAAKqN,IAAIf,GAAQtM,KAAKgK,OAAOsC,IAC/CtM,KAAKqN,IAAIf,KAMlB1D,EAAAvI,UAAAqO,MAAA,SAAMC,EAAmCtD,GACvC,IAAMd,EAAMvK,KAAKgK,OAAO2E,GAClBxD,EAAMnL,KAAK8K,MAAMP,GACjBqE,GAAiB,IAATzD,EAERpK,EAAuB,CAC3B6J,MAAO5K,KAAKqM,SAAS9B,EAAKoE,GAC1BzN,SAAUlB,KAAK2M,YAAYpC,EAAKoE,GAChC9J,SAAU7E,KAAK6O,iBAAiBtE,EAAKoE,GAAa3O,KAAKuJ,eAAegB,GAAO,KAC7EA,IAAGA,EACHoE,UAASA,EACTtD,QAAOA,GAET,GAAIuD,EAAO,CACT,GAAI5O,KAAK0L,OAAS1L,KAAKgJ,KAAM,CAE3B,IAAM8F,EAAW9O,KAAKoJ,QAAQ2B,WAAU,SAAAC,GAAK,OAAAA,EAAE9J,aAC7B,IAAd4N,GAAiB9O,KAAKmD,OAAO2L,GAAU,GAE7C9O,KAAKoJ,QAAQb,KAAKxH,QAElBf,KAAKoJ,QAAQ+B,GAAOpK,EAEtBf,KAAKuL,gBAAkB,KAEvBvL,KAAK0K,GAAG,SAAUkE,EAAQ,QAAU,aAAcrE,GAE9Cc,GAAWA,EAAQqC,cACrB1N,KAAKkO,QAAQ,kBAAmB7C,EAAQqC,cAGrCkB,GACH5O,KAAKkJ,cAAcpI,KAAK,CAAE6J,OAAQ,WAAY5J,KAAIA,EAAE8J,KAAM7K,KAAKoJ,WAOnER,EAAAvI,UAAA0O,aAAA,SAAazC,GACX,GAAItM,KAAKqO,gBAAgB/B,GAAQ,OAAO,EACxC,IAAM/B,EAAMvK,KAAKgK,OAAOsC,GAClBP,EAAO/L,KAAK6J,IAAIU,GAChByE,KAASjD,IAAQA,EAAKV,SAE5B,GADArL,KAAK0K,GAAG,gBAAiBsE,EAAKzE,GAC1ByE,EAAK,CACP,IAAMC,EAAUlD,EAAMV,QAAQqC,aAC1BuB,IACFjP,KAAK0N,aAAeuB,EACpBjP,KAAKkO,QAAQ,eAAgBe,SAG/BjP,KAAKkJ,cAAcpI,KAAK,CAAE6J,OAAQ,MAAOJ,IAAGA,EAAEM,KAAM7K,KAAKoJ,UAE3D,OAAO4F,GAMTpG,EAAAvI,UAAA6O,SAAA,SAAS5C,GACP,GAAItM,KAAKqO,gBAAgB/B,GAAQ,OAAO,KACxC,IAAM/B,EAAMvK,KAAKgK,OAAOsC,GAClBP,EAAO/L,KAAK6J,IAAIU,GAChByE,EAAOjD,GAAQA,EAAKV,SAAY,KAEtC,OADArL,KAAK0K,GAAG,YAAaH,EAAKyE,GACnBA,GAMTpG,EAAAvI,UAAA8O,iBAAA,SAAiBC,EAAgCC,GAC/C,IAAIL,EAAMI,EAAOd,cAAgBe,EAAKf,YACtC,IAAKU,EAAK,OAAO,EAEjB,IAAMM,EAASF,EAAOd,aAAec,EAAOd,YAAYgB,MAAS,GAUjE,OATIA,EAAKlI,OAAS,IAAMkI,EAAKC,QAAQ,OAEjCP,EAD+B,WAA7BhP,KAAKyJ,oBACDzJ,KAAKgK,OAAOoF,KAAYpP,KAAKgK,OAAOqF,GAEpCC,KAAWD,EAAKf,aAAee,EAAKf,YAAYgB,MAAS,KAGnEtP,KAAK0K,GAAG,yBACR1K,KAAK0K,GAAG,oBAAqBsE,EAAQhP,KAAKgK,OAAOqF,GAAK,KAAKrP,KAAKgK,OAAOoF,GAAWA,EAAQC,GACnFL,GAYTpG,EAAAvI,UAAAwO,iBAAA,SAAiBtE,EAAa+B,GAC5B,GAAIA,GAASA,EAAMP,MAA4C,kBAA7BO,EAAMP,KAAKyD,cAA6B,OAAOlD,EAAMP,KAAKyD,cAE5F,IAAMhD,EAAOxM,KAAK0J,OAASf,EAAAA,kBAAkBkE,IAAM7M,KAAKyM,QAAQlC,GAAO,KACvE,OAAIiC,GAAsC,kBAAvBA,EAAKgD,cAAoChD,EAAKgD,cAE1DxP,KAAKwP,eAGdrP,OAAAC,eAAYwI,EAAAvI,UAAA,qBAAkB,KAA9B,WAEE,MAAkD,aAD7BL,KAAK6I,SAASgB,IAAkB4F,EAAAA,qBAAsB,IACvDC,2DAGtBvP,OAAAC,eAAYwI,EAAAvI,UAAA,KAAE,KAAd,WACE,OAAOL,KAAK6I,SAASgB,IAAI8F,EAAAA,gDAGnB/G,EAAAvI,UAAAgK,WAAA,WAAA,IAAA5G,EAAAzD,KACFA,KAAK4P,UACP5P,KAAK4P,SAAS7J,cAGhB/F,KAAK4P,SAAW5P,KAAK6I,SAASgB,IAAYsC,EAAAA,QAAQ0D,OAAOjK,WAAU,SAAAxE,GACjE,GAAIA,aAAa0O,EAAAA,gBAAiB,CAChC,IAAMvF,EAAM9G,EAAK+G,OACb/G,EAAKoL,iBAAiBtE,EAAK9G,EAAKsJ,cAActJ,EAAKsG,WACrDtG,EAAK8F,eAAegB,GAAO9G,EAAKsM,GAAGC,kBAAkBvM,EAAKwM,+BAEnDxM,EAAK8F,eAAegB,QAExB,GAAInJ,aAAa8O,EAAAA,cAAe,CAC/B3F,EAAM9G,EAAK+G,OAAjB,IACM2F,EAAO1M,EAAKoG,IAAIU,GAClB4F,GAAQA,EAAKtL,UAAYpB,EAAKoL,iBAAiBtE,EAAK9G,EAAKsJ,cAActJ,EAAKsG,aAC1EtG,EAAK2M,mBACP3M,EAAKsM,GAAGM,iBAAiB5M,EAAKwM,uBAAwBE,EAAKtL,UAE3DyL,YAAW,WAAM,OAAA7M,EAAKsM,GAAGM,iBAAiB5M,EAAKwM,uBAAwBE,EAAKtL,YAAY,SASlG+D,EAAAvI,UAAAiG,YAAA,WACQ,IAAE4C,EAA4BlJ,KAAfkJ,cAAE0G,EAAa5P,KAAL4P,SAC/B5P,KAAK2L,QACL3L,KAAKoJ,QAAU,GACfF,EAAcqH,WAEVX,GACFA,EAAS7J,qLA7hBdC,EAAAA,WAAUjE,KAAA,CAAC,CAAEyO,WAAY,oDAzBLC,EAAAA,gBAUNC,EAAAA,eC6CFC,EAAAA,kBAAiB,WA0C5B,SAAAA,EACUxK,EACAyK,EACAC,EACAvE,EACsCvM,EACpB+Q,GALlB9Q,KAAAmG,IAAAA,EACAnG,KAAA4Q,IAAAA,EACA5Q,KAAA6Q,OAAAA,EACA7Q,KAAAsM,MAAAA,EACsCtM,KAAAD,QAAAA,EACpBC,KAAA8Q,IAAAA,EAvCpB9Q,KAAA+Q,WAAa,IAAI7N,EAAAA,QAEzBlD,KAAA6K,KAAoB,GAEpB7K,KAAAgR,IAAM,EAIGhR,KAAA0J,KAA0Bf,EAAAA,kBAAkBgB,KAE5B3J,KAAAwJ,OAAQ,EAIRxJ,KAAAiR,YAAa,EACbjR,KAAAwP,eAAgB,EAKhCxP,KAAA0D,kBAA8C,GAI9C1D,KAAAkR,QAA2B,OAC3BlR,KAAAyJ,oBAAmD,SACnCzJ,KAAA2B,UAAW,EAEjB3B,KAAAoG,OAAS,IAAIlG,EAAAA,aACbF,KAAAC,MAAQ,IAAIC,EAAAA,oBAb/BC,OAAAC,eACIuQ,EAAAtQ,UAAA,yBAAsB,KAD1B,SAC2BE,GACzBP,KAAKmR,wBAA2C,iBAAV5Q,EAAqBP,KAAK8Q,IAAIM,cAAc7Q,GAASA,mCAwBrFoQ,EAAAtQ,UAAAgR,OAAA,SAAOzG,GACb,OAAOA,EAAMpF,MAAQxF,KAAKD,QAAUC,KAAKD,QAAQuR,MAAM1G,EAAMpF,MAAQoF,EAAMH,MAG7EtK,OAAAC,eAAYuQ,EAAAtQ,UAAA,SAAM,KAAlB,WACE,OAAOL,KAAKmG,IAAI6D,OAAOhK,KAAKsM,MAAMvC,2CAG5B4G,EAAAtQ,UAAAkR,WAAA,WACN,IAAMhH,EAAMvK,KAAKwK,OACXgH,EAAexR,KAAKmG,IAAI4G,cAAc/M,KAAKsM,MAAMvC,UACvD,MAAO,CACLQ,IAAGA,EACHK,MAAO5K,KAAKqR,OAAOrR,KAAKmG,IAAIkG,SAAS9B,EAAKiH,IAC1CtQ,SAAUlB,KAAKiR,YAAcjR,KAAKmG,IAAIuF,MAAQ,GAAK1L,KAAKmG,IAAIwG,YAAYpC,EAAKiH,GAC7E7G,QAAQ,EACRnJ,MAAM,EACNsJ,MAAO,IAIH6F,EAAAtQ,UAAAoR,QAAA,SAAQ7Q,GAAR,IAAA6C,EAAAzD,KACA0R,EAAK1R,KAAKmG,IAAIwL,MAAMC,KACxB,SAAC7Q,EAAsB+J,GACrB,MAAA,CACEP,IAAKxJ,EAAKwJ,IACVK,MAAOnH,EAAK4N,OAAOtQ,EAAK6J,OACxB1J,SAAUuC,EAAKwN,YAAclQ,EAAKG,UAAYuC,EAAK0C,IAAIuF,MAAQ,EAC/DZ,MAAKA,EACLH,QAAQ,EACRnJ,MAAM,MAIN+I,EAAMvK,KAAKwK,OACbqH,GAAmD,IAAtCH,EAAG3G,WAAU,SAAAC,GAAK,OAAAA,EAAET,MAAQA,KAC7C,GAAI3J,GAA4B,UAAlBA,EAAO+J,QAAsB/J,EAAO2J,MAAQA,EAAK,CAC7DsH,GAAa,EACb,IAAIC,EAAQ,EACNC,EAAU/R,KAAK6K,KAAKK,MAAK,SAAAF,GAAK,OAAAA,EAAET,MAAQA,KAC1CwH,EAAQjH,QAAU4G,EAAGtK,OAEvB0K,EAAQJ,EAAGtK,OAAS,EACX2K,EAAQjH,MAAQ4G,EAAGtK,SAE5B0K,EAAQ7H,KAAKE,IAAI,EAAG4H,EAAQjH,QAE9B9K,KAAK6Q,OAAOzE,cAAcsF,EAAGI,GAAOvH,KAGlCsH,GACFH,EAAGnJ,KAAKvI,KAAKuR,cAGfG,EAAG9F,SAAQ,SAAC7K,EAAM+J,GAAU,OAAC/J,EAAK+J,MAAQA,KACxB,IAAd4G,EAAGtK,SACLsK,EAAG,GAAGxQ,UAAW,GAEnBlB,KAAK6K,KAAO6G,EACZ1R,KAAK4Q,IAAIoB,gBACThS,KAAK+Q,WAAWjQ,QAGV6P,EAAAtQ,UAAA4R,YAAA,SAAYpM,GAClB,IAAM9E,EAAOf,KAAK6K,KAAKK,MAAK,SAAAF,GAAK,OAAAA,EAAET,MAAQ1E,EAAK0E,OAC3CxJ,IACLA,EAAK6J,MAAQ5K,KAAKqR,OAAOxL,EAAK+E,OAC9B5K,KAAK4Q,IAAIoB,kBAGHrB,EAAAtQ,UAAAoN,QAAA,SAAQ1M,GACdf,KAAKmG,IAAI+H,QAAQ,eAAgBlO,KAAKgR,MAAQjQ,EAAK+J,MAAQ9K,KAAKmG,IAAIuH,aAAe3M,EAAK+J,MAAO,YAKjG6F,EAAAtQ,UAAA6R,kBAAA,SAAkBrM,GAAlB,IAAApC,EAAAzD,KACM0B,EAA0B,KAC9B,OAAQmE,EAAIhF,MACV,IAAK,UACHb,KAAKyN,QAAQ5H,EAAI9E,MACjB,MACF,IAAK,QACHf,KAAKmS,OAAO,KAAMtM,EAAI9E,KAAK+J,MAAOjF,EAAI7E,qBACtC,MACF,IAAK,aACHU,EAAK,WACH+B,EAAK0C,IAAIqF,WAAW3F,EAAI9E,KAAKwJ,IAAK1E,EAAI7E,qBACtCyC,EAAKxD,MAAMoG,KAAK,OAElB,MACF,IAAK,aACH3E,EAAK,WACH+B,EAAK0C,IAAIwF,MAAM9F,EAAI7E,qBACnByC,EAAKxD,MAAMoG,KAAK,OAIjB3E,KAGAmE,EAAI9E,KAAK4J,QAAU9E,EAAI9E,KAAK+J,OAAS9K,KAAK6K,KAAKK,MAAK,SAAAF,GAAK,OAAAA,EAAEL,UAASG,MACvE9K,KAAKoS,IAAIvM,EAAI9E,KAAK+J,MAAOpJ,GAEzBA,MAIJiP,EAAAtQ,UAAA+R,IAAA,SAAItH,EAAeuH,GAAnB,IAAA5O,EAAAzD,KACE8K,EAAQb,KAAKE,IAAI,EAAGF,KAAKC,IAAIY,EAAO9K,KAAK6K,KAAKzD,OAAS,IACvD,IAAMrG,EAAOf,KAAK6K,KAAKC,GACvB9K,KAAK6Q,OAAOzE,cAAcrL,EAAKwJ,KAAK+H,MAAK,SAAAzM,GAClCA,IACLpC,EAAK1C,KAAOA,EACZ0C,EAAK2C,OAAOC,KAAKtF,GACbsR,GACFA,SAKN1B,EAAAtQ,UAAA8R,OAAA,SAAO/Q,EAAiB+J,EAAanK,GAC1B,MAALI,IACFA,EAAEE,iBACFF,EAAEG,mBAEJ,IAAMR,EAAOf,KAAK6K,KAAKM,GAIvB,OAHAnL,KAAKmG,IAAIlG,MAAMc,EAAKwJ,IAAKvJ,GACzBhB,KAAKC,MAAMoG,KAAKtF,GAChBf,KAAK4Q,IAAIoB,iBACF,GAGTrB,EAAAtQ,UAAAkS,SAAA,SAAShN,GACPvF,KAAKmG,IAAIuH,aAAe,CAAEnI,SAAQA,IAKpCoL,EAAAtQ,UAAAY,SAAA,WAAA,IAAAwC,EAAAzD,KACEA,KAAK+Q,WAAWyB,KAAKC,EAAAA,eAAezS,MAAO0S,EAAAA,aAAa,KAAK9M,WAAU,WACrE,IAAM2E,EAAM9G,EAAK0C,IAAI6D,OAAOvG,EAAK6I,MAAMvC,UACjC2H,EAAKjO,EAAKoH,KAAKgB,QAAO,SAAAb,GAAK,OAAAA,EAAET,MAAQA,IAAQ9G,EAAK0C,IAAIoH,UAAUvC,EAAET,QACxE,GAAkB,IAAdmH,EAAGtK,OAAP,CAIA,IAAM5F,EAAOkQ,EAAGA,EAAGtK,OAAS,GACtBrG,EAAO2Q,EAAGxG,MAAK,SAAAF,GAAK,OAAAA,EAAET,MAAQA,KACpC/I,EAAKA,MAAO,EACZ,IAAMwP,EAAc,MAARjQ,EAAeS,EAAKsJ,MAAQ/J,EAAK+J,MAC7C4G,EAAG9F,SAAQ,SAACnE,EAAG0D,GAAQ,OAAC1D,EAAEkD,OAASqG,IAAQ7F,KAC3C1H,EAAKuN,IAAMA,EAGXvN,EAAKkP,OAAOC,gBAAkB5B,EAC9BvN,EAAKoH,KAAO6G,EACZjO,EAAKmN,IAAIoB,oBAGXhS,KAAKmG,IAAIC,OAAOoM,KAAKC,EAAAA,eAAezS,OAAO4F,WAAU,SAAAC,SACnD,OAAQA,MAAAA,OAAG,EAAHA,EAAK8E,QACX,IAAK,QAEH,YADAlH,EAAKwO,YAAYpM,GAEnB,IAAK,WACH,IAAa,QAATgN,EAAAhN,MAAAA,OAAG,EAAHA,EAAKgF,YAAI,IAAAgI,OAAA,EAAAA,EAAEzL,UAAW3D,EAAKoH,KAAKzD,OAElC,YADA3D,EAAKsN,WAAWjQ,OAKtB2C,EAAKgO,QAAQ5L,MAGf7F,KAAKD,QAAQqG,OACVoM,KACC3G,EAAAA,QAAO,WAAM,OAAApI,EAAK0C,IAAI2M,UACtBL,EAAAA,eAAezS,MACf0S,EAAAA,aAAa,MAEd9M,WAAU,WAAM,OAAAnC,EAAKgO,QAAQ,CAAE9G,OAAQ,aAE1C3K,KAAKmG,IAAI4H,QAGX4C,EAAAtQ,UAAA0S,YAAA,SAAYC,GACNA,EAAQ7I,MAAKnK,KAAKmG,IAAIgE,IAAMnK,KAAKmK,KACjC6I,EAAQpJ,WAAU5J,KAAKmG,IAAIyD,SAAW5J,KAAK4J,UAC3CoJ,EAAQtJ,OAAM1J,KAAKmG,IAAIuD,KAAO1J,KAAK0J,MACnCsJ,EAAQvJ,sBAAqBzJ,KAAKmG,IAAIsD,oBAAsBzJ,KAAKyJ,qBACjEuJ,EAAQxD,gBACVxP,KAAKmG,IAAIqJ,cAAgBxP,KAAKwP,cAC9BxP,KAAKmG,IAAI8J,uBAAyBjQ,KAAKmR,yBAGzCnR,KAAKmG,IAAIqD,MAAQxJ,KAAKwJ,MAEtBxJ,KAAK4Q,IAAIoB,mBAzPiB,yCAf7BlQ,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,yBACV0E,SAAU,WACVzE,SAAA,kkCACAC,KAAM,CACJ+Q,oBAAqB,OACrBC,0BAA2B,qBAC3BC,0BAA2B,qBAC3BC,8BAA+B,YAEjCC,UAAW,CAACtQ,GACZV,qBAAqB,EACrBC,gBAAiBC,EAAAA,wBAAwBC,OACzCC,cAAeC,EAAAA,kBAAkBC,oEAhB1BiG,SAlCP0K,EAAAA,yBAeuBnH,EAAAA,cAAhBrC,EAAAA,+CAoFJyJ,EAAAA,UAAQ,CAAA1S,KAAI2S,EAAAA,OAAMzR,KAAA,CAAC0R,EAAAA,oDACnBD,EAAAA,OAAMzR,KAAA,CAAC2R,EAAAA,iEAxCTC,EAAAA,UAAS5R,KAAA,CAAC,wBASVc,EAAAA,oBACAA,EAAAA,qBACAA,EAAAA,mBACAA,EAAAA,2BACAA,EAAAA,wBACAA,EAAAA,0BACAA,EAAAA,6BACAA,EAAAA,sCACAA,EAAAA,iCAIAA,EAAAA,kCACAA,EAAAA,4BACAA,EAAAA,2BACAA,EAAAA,uBACAA,EAAAA,mCACAA,EAAAA,wBACAA,EAAAA,2BACAA,EAAAA,sBACAC,EAAAA,sBACAA,EAAAA,UAnBwB8D,EAAA,CAAfgN,EAAAA,sFACchN,EAAA,CAAdiN,EAAAA,mFACcjN,EAAA,CAAdiN,EAAAA,2FAEejN,EAAA,CAAfgN,EAAAA,2FACehN,EAAA,CAAfgN,EAAAA,8FAWehN,EAAA,CAAfgN,EAAAA,yFAnCCjD,EAAAA,kBAAiB/J,EAAA,CAhB7BkN,EAAAA,sCA2DgBlL,EACA0K,EAAAA,kBACGnH,EAAAA,OACDrC,EAAAA,eAAc3J,OAAAA,UA9CpBwQ,EAAAA,oCCnDX,SAAAoD,EAAoB5N,GAAAnG,KAAAmG,IAAAA,SAEpB4N,EAAA1T,UAAAoO,aAAA,SAAanC,GACX,OAAOtM,KAAKmG,IAAIsI,aAAanC,IAE/ByH,EAAA1T,UAAAqO,MAAA,SAAMpC,EAA+B0H,GACnChU,KAAKmG,IAAIuI,MAAMpC,EAAO0H,IAExBD,EAAA1T,UAAA0O,aAAA,SAAazC,GACX,OAAOtM,KAAKmG,IAAI4I,aAAazC,IAE/ByH,EAAA1T,UAAA6O,SAAA,SAAS5C,GACP,OAAOtM,KAAKmG,IAAI+I,SAAS5C,IAE3ByH,EAAA1T,UAAA8O,iBAAA,SAAiBC,EAAgCC,GAC/C,OAAOrP,KAAKmG,IAAIgJ,iBAAiBC,EAAQC,SCNvC4E,EAAa,CAACtD,EAAAA,mBACduD,EAAY,CAACpU,EAA8BoG,EAA0BK,KAO3E,iCALC4N,EAAAA,SAAQpS,KAAA,CAAC,CACRqS,QAAS,CAACC,EAAAA,aAAcC,EAAAA,aAAcC,EAAAA,kBAAmBC,EAAAA,aAAcC,EAAAA,aAAcC,EAAAA,aAAcC,EAAAA,eACnGC,aAAYnM,EAAMwL,EAAeC,GACjCW,QAASZ","sourcesContent":["import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnInit, Output, ViewEncapsulation } from '@angular/core';\nimport { DelonLocaleService } from '@delon/theme';\nimport { CloseType, ReuseContextCloseEvent, ReuseContextI18n, ReuseCustomContextMenu, ReuseItem } from './reuse-tab.interfaces';\n\n@Component({\n  selector: 'reuse-tab-context-menu',\n  templateUrl: './reuse-tab-context-menu.component.html',\n  host: {\n    '(document:click)': 'closeMenu($event)',\n    '(document:contextmenu)': 'closeMenu($event)',\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class ReuseTabContextMenuComponent implements OnInit {\n  private _i18n: ReuseContextI18n;\n  @Input()\n  set i18n(value: ReuseContextI18n) {\n    this._i18n = {\n      ...this.i18nSrv.getData('reuseTab'),\n      ...value,\n    };\n  }\n  get i18n(): ReuseContextI18n {\n    return this._i18n;\n  }\n  @Input() item: ReuseItem;\n  @Input() event: MouseEvent;\n  @Input() customContextMenu: ReuseCustomContextMenu[];\n  @Output() readonly close = new EventEmitter<ReuseContextCloseEvent>();\n\n  get includeNonCloseable(): boolean {\n    return this.event.ctrlKey;\n  }\n\n  constructor(private i18nSrv: DelonLocaleService) {}\n\n  private notify(type: CloseType): void {\n    this.close.next({\n      type,\n      item: this.item,\n      includeNonCloseable: this.includeNonCloseable,\n    });\n  }\n\n  ngOnInit(): void {\n    if (this.includeNonCloseable) this.item.closable = true;\n  }\n\n  click(e: MouseEvent, type: CloseType, custom?: ReuseCustomContextMenu): void {\n    e.preventDefault();\n    e.stopPropagation();\n    if (type === 'close' && !this.item.closable) return;\n    if (type === 'closeRight' && this.item.last) return;\n\n    if (custom) {\n      if (this.isDisabled(custom)) return;\n      custom.fn(this.item, custom);\n    }\n    this.notify(type);\n  }\n\n  isDisabled(custom: ReuseCustomContextMenu): boolean {\n    return custom.disabled ? custom.disabled(this.item) : false;\n  }\n\n  closeMenu(event: MouseEvent): void {\n    if (event.type === 'click' && event.button === 2) return;\n    this.notify(null);\n  }\n}\n","import { ConnectionPositionPair, Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport { ElementRef, Injectable } from '@angular/core';\nimport { Subject, Subscription } from 'rxjs';\nimport { ReuseTabContextMenuComponent } from './reuse-tab-context-menu.component';\nimport { ReuseContextCloseEvent, ReuseContextEvent, ReuseContextI18n, ReuseCustomContextMenu } from './reuse-tab.interfaces';\n\n@Injectable()\nexport class ReuseTabContextService {\n  private ref: OverlayRef | null;\n  i18n: ReuseContextI18n;\n\n  show: Subject<ReuseContextEvent> = new Subject<ReuseContextEvent>();\n  close: Subject<ReuseContextCloseEvent> = new Subject<ReuseContextCloseEvent>();\n\n  constructor(private overlay: Overlay) {}\n\n  remove(): void {\n    if (!this.ref) return;\n    this.ref.detach();\n    this.ref.dispose();\n    this.ref = null;\n  }\n\n  open(context: ReuseContextEvent): void {\n    this.remove();\n    const { event, item, customContextMenu } = context;\n    const fakeElement = new ElementRef({\n      getBoundingClientRect: (): ClientRect => ({\n        bottom: event.clientY,\n        height: 0,\n        left: event.clientX,\n        right: event.clientX,\n        top: event.clientY,\n        width: 0,\n      }),\n    });\n    const positions = [\n      new ConnectionPositionPair({ originX: 'start', originY: 'bottom' }, { overlayX: 'start', overlayY: 'top' }),\n      new ConnectionPositionPair({ originX: 'start', originY: 'top' }, { overlayX: 'start', overlayY: 'bottom' }),\n    ];\n    const positionStrategy = this.overlay.position().flexibleConnectedTo(fakeElement).withPositions(positions);\n    this.ref = this.overlay.create({\n      positionStrategy,\n      panelClass: 'reuse-tab__cm',\n      scrollStrategy: this.overlay.scrollStrategies.close(),\n    });\n    const comp = this.ref.attach(new ComponentPortal(ReuseTabContextMenuComponent));\n    const instance = comp.instance;\n    instance.i18n = this.i18n;\n    instance.item = { ...item };\n    instance.customContextMenu = customContextMenu as ReuseCustomContextMenu[];\n    instance.event = event;\n\n    const sub$ = new Subscription();\n    sub$.add(\n      instance.close.subscribe((res: ReuseContextCloseEvent) => {\n        this.close.next(res);\n        this.remove();\n      }),\n    );\n    comp.onDestroy(() => sub$.unsubscribe());\n  }\n}\n","import { Component, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { ReuseTabContextService } from './reuse-tab-context.service';\nimport { ReuseContextCloseEvent, ReuseContextI18n } from './reuse-tab.interfaces';\n\n@Component({\n  selector: 'reuse-tab-context',\n  template: ``,\n})\nexport class ReuseTabContextComponent implements OnDestroy {\n  private sub$: Subscription = new Subscription();\n\n  @Input()\n  set i18n(value: ReuseContextI18n) {\n    this.srv.i18n = value;\n  }\n\n  @Output() readonly change = new EventEmitter<ReuseContextCloseEvent>();\n\n  constructor(private srv: ReuseTabContextService) {\n    this.sub$.add(srv.show.subscribe(context => this.srv.open(context)));\n    this.sub$.add(srv.close.subscribe(res => this.change.emit(res)));\n  }\n\n  ngOnDestroy(): void {\n    this.sub$.unsubscribe();\n  }\n}\n","import { Directive, Input } from '@angular/core';\nimport { ReuseTabContextService } from './reuse-tab-context.service';\nimport { ReuseCustomContextMenu, ReuseItem } from './reuse-tab.interfaces';\n\n@Directive({\n  selector: '[reuse-tab-context-menu]',\n  exportAs: 'reuseTabContextMenu',\n  host: {\n    '(contextmenu)': '_onContextMenu($event)',\n  },\n})\nexport class ReuseTabContextDirective {\n  @Input('reuse-tab-context-menu') item: ReuseItem;\n  @Input() customContextMenu: ReuseCustomContextMenu[];\n\n  constructor(private srv: ReuseTabContextService) {}\n\n  _onContextMenu(event: MouseEvent): void {\n    this.srv.show.next({\n      event,\n      item: this.item,\n      customContextMenu: this.customContextMenu,\n    });\n    event.preventDefault();\n    event.stopPropagation();\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { ActivatedRouteSnapshot } from '@angular/router';\nimport { ReuseTabContextComponent } from './reuse-tab-context.component';\n\n/**\n * 复用匹配模式\n */\nexport enum ReuseTabMatchMode {\n  /**\n   * （推荐）按菜单 `Menu` 配置\n   *\n   * 可复用：\n   * - `{ text:'Dashboard' }`\n   * - `{ text:'Dashboard', reuse: true }`\n   *\n   * 不可复用：\n   * - `{ text:'Dashboard', reuse: false }`\n   */\n  Menu,\n  /**\n   * 按菜单 `Menu` 强制配置\n   *\n   * 可复用：\n   * - `{ text:'Dashboard', reuse: true }`\n   *\n   * 不可复用：\n   * - `{ text:'Dashboard' }`\n   * - `{ text:'Dashboard', reuse: false }`\n   */\n  MenuForce,\n  /**\n   * 对所有路由有效，可以配合 `excludes` 过滤无须复用路由\n   */\n  URL,\n}\n\nexport type ReuseTabRouteParamMatchMode = 'strict' | 'loose';\n\nexport interface ReuseTitle {\n  text?: string;\n  i18n?: string;\n}\n\nexport interface ReuseTabCached {\n  title: ReuseTitle;\n\n  url: string;\n\n  /** 是否允许关闭，默认：`true` */\n  closable?: boolean;\n\n  /** 当前滚动条位置 */\n  position?: [number, number] | null;\n\n  _snapshot: ActivatedRouteSnapshot;\n\n  _handle: ReuseComponentHandle;\n}\n\nexport interface ReuseTabNotify {\n  /** 事件类型 */\n  active: 'add' | 'override' | 'title' | 'clear' | 'closable' | 'close' | 'closeRight' | 'move' | 'refresh';\n  url?: string;\n  title?: ReuseTitle;\n  item?: ReuseTabCached;\n  list?: ReuseTabCached[];\n  [key: string]: any;\n}\n\nexport interface ReuseItem {\n  url: string;\n  title: string;\n  closable: boolean;\n  index: number;\n  active: boolean;\n  last: boolean;\n}\n\nexport interface ReuseContextEvent {\n  event: MouseEvent;\n  item: ReuseItem;\n  comp?: ReuseTabContextComponent;\n  customContextMenu?: ReuseCustomContextMenu[];\n}\n\nexport type CloseType = 'close' | 'closeOther' | 'closeRight' | 'custom' | 'refresh' | null;\n\nexport interface ReuseContextCloseEvent {\n  type: CloseType;\n  item: ReuseItem;\n  includeNonCloseable: boolean;\n}\n\nexport interface ReuseContextI18n {\n  close?: string;\n  closeOther?: string;\n  closeRight?: string;\n  refresh?: string;\n}\n\nexport interface ReuseCustomContextMenu {\n  id: string;\n  title: string;\n  fn: (item: ReuseItem, menu: ReuseCustomContextMenu) => void;\n  disabled?: (item: ReuseItem) => boolean;\n}\n\nexport interface ReuseComponentHandle {\n  componentRef: ReuseComponentRef;\n}\n\nexport interface ReuseComponentRef {\n  instance: ReuseComponentInstance;\n}\n\nexport type ReuseHookTypes = '_onReuseInit' | '_onReuseDestroy';\n\nexport type ReuseHookOnReuseInitType = 'init' | 'refresh';\n\nexport interface ReuseComponentInstance {\n  _onReuseInit: (type: ReuseHookOnReuseInitType) => void;\n  _onReuseDestroy: () => void;\n  destroy: () => void;\n}\n","import { Injectable, Injector, OnDestroy } from '@angular/core';\nimport {\n  ActivatedRoute,\n  ActivatedRouteSnapshot,\n  ExtraOptions,\n  NavigationEnd,\n  NavigationStart,\n  Router,\n  ROUTER_CONFIGURATION,\n} from '@angular/router';\nimport { Menu, MenuService } from '@delon/theme';\nimport { ScrollService } from '@delon/util/browser';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { BehaviorSubject, Observable, Unsubscribable } from 'rxjs';\nimport {\n  ReuseComponentRef,\n  ReuseHookOnReuseInitType,\n  ReuseHookTypes,\n  ReuseTabCached,\n  ReuseTabMatchMode,\n  ReuseTabNotify,\n  ReuseTabRouteParamMatchMode,\n  ReuseTitle,\n} from './reuse-tab.interfaces';\n\n@Injectable({ providedIn: 'root' })\nexport class ReuseTabService implements OnDestroy {\n  private _inited = false;\n  private _max = 10;\n  private _keepingScroll = false;\n  private _cachedChange = new BehaviorSubject<ReuseTabNotify | null>(null);\n  private _cached: ReuseTabCached[] = [];\n  private _titleCached: { [url: string]: ReuseTitle } = {};\n  private _closableCached: { [url: string]: boolean } = {};\n  private _router$: Unsubscribable;\n  private removeUrlBuffer: string | null;\n  private positionBuffer: { [url: string]: [number, number] } = {};\n  componentRef: ReuseComponentRef;\n  debug = false;\n  routeParamMatchMode: ReuseTabRouteParamMatchMode = 'strict';\n  mode = ReuseTabMatchMode.Menu;\n  /** 排除规则，限 `mode=URL` */\n  excludes: RegExp[] = [];\n\n  private get snapshot(): ActivatedRouteSnapshot {\n    return this.injector.get(ActivatedRoute).snapshot;\n  }\n\n  // #region public\n\n  /**\n   * Get init status\n   *\n   * 是否已经初始化完成\n   */\n  get inited(): boolean {\n    return this._inited;\n  }\n\n  /**\n   * Current routing address\n   *\n   * 当前路由地址\n   */\n  get curUrl(): string {\n    return this.getUrl(this.snapshot);\n  }\n\n  /**\n   * 允许最多复用多少个页面，取值范围 `2-100`，值发生变更时会强制关闭且忽略可关闭条件\n   */\n  set max(value: number) {\n    this._max = Math.min(Math.max(value, 2), 100);\n    for (let i = this._cached.length; i > this._max; i--) {\n      this._cached.pop();\n    }\n  }\n  set keepingScroll(value: boolean) {\n    this._keepingScroll = value;\n    this.initScroll();\n  }\n  get keepingScroll(): boolean {\n    return this._keepingScroll;\n  }\n  keepingScrollContainer: Element;\n  /** 获取已缓存的路由 */\n  get items(): ReuseTabCached[] {\n    return this._cached;\n  }\n  /** 获取当前缓存的路由总数 */\n  get count(): number {\n    return this._cached.length;\n  }\n  /** 订阅缓存变更通知 */\n  get change(): Observable<ReuseTabNotify | null> {\n    return this._cachedChange.asObservable(); // .pipe(filter(w => w !== null));\n  }\n  /** 自定义当前标题 */\n  set title(value: string | ReuseTitle) {\n    const url = this.curUrl;\n    if (typeof value === 'string') value = { text: value };\n    this._titleCached[url] = value;\n    this.di('update current tag title: ', value);\n    this._cachedChange.next({\n      active: 'title',\n      url,\n      title: value,\n      list: this._cached,\n    });\n  }\n  /** 获取指定路径缓存所在位置，`-1` 表示无缓存 */\n  index(url: string): number {\n    return this._cached.findIndex(w => w.url === url);\n  }\n  /** 获取指定路径缓存是否存在 */\n  exists(url: string): boolean {\n    return this.index(url) !== -1;\n  }\n  /** 获取指定路径缓存 */\n  get(url?: string): ReuseTabCached | null {\n    return url ? this._cached.find(w => w.url === url) || null : null;\n  }\n  private remove(url: string | number, includeNonCloseable: boolean): boolean {\n    const idx = typeof url === 'string' ? this.index(url) : url;\n    const item = idx !== -1 ? this._cached[idx] : null;\n    if (!item || (!includeNonCloseable && !item.closable)) return false;\n\n    this.destroy(item._handle);\n\n    this._cached.splice(idx, 1);\n    delete this._titleCached[url];\n    return true;\n  }\n  /**\n   * 根据URL移除标签\n   *\n   * @param [includeNonCloseable=false] 是否强制包含不可关闭\n   */\n  close(url: string, includeNonCloseable: boolean = false): boolean {\n    this.removeUrlBuffer = url;\n\n    this.remove(url, includeNonCloseable);\n\n    this._cachedChange.next({ active: 'close', url, list: this._cached });\n\n    this.di('close tag', url);\n    return true;\n  }\n  /**\n   * 清除右边\n   *\n   * @param [includeNonCloseable=false] 是否强制包含不可关闭\n   */\n  closeRight(url: string, includeNonCloseable: boolean = false): boolean {\n    const start = this.index(url);\n    for (let i = this.count - 1; i > start; i--) {\n      this.remove(i, includeNonCloseable);\n    }\n\n    this.removeUrlBuffer = null;\n\n    this._cachedChange.next({ active: 'closeRight', url, list: this._cached });\n\n    this.di('close right tages', url);\n    return true;\n  }\n  /**\n   * 清除所有缓存\n   *\n   * @param [includeNonCloseable=false] 是否强制包含不可关闭\n   */\n  clear(includeNonCloseable: boolean = false): void {\n    this._cached.forEach(w => {\n      if (!includeNonCloseable && w.closable) this.destroy(w._handle);\n    });\n    this._cached = this._cached.filter(w => !includeNonCloseable && !w.closable);\n\n    this.removeUrlBuffer = null;\n\n    this._cachedChange.next({ active: 'clear', list: this._cached });\n\n    this.di('clear all catch');\n  }\n  /**\n   * 移动缓存数据\n   * @param url 要移动的URL地址\n   * @param position 新位置，下标从 `0` 开始\n   *\n   * @example\n   * ```\n   * // source\n   * [ '/a/1', '/a/2', '/a/3', '/a/4', '/a/5' ]\n   * move('/a/1', 2);\n   * // output\n   * [ '/a/2', '/a/3', '/a/1', '/a/4', '/a/5' ]\n   * move('/a/1', -1);\n   * // output\n   * [ '/a/2', '/a/3', '/a/4', '/a/5', '/a/1' ]\n   * ```\n   */\n  move(url: string, position: number): void {\n    const start = this._cached.findIndex(w => w.url === url);\n    if (start === -1) return;\n    const data = this._cached.slice();\n    data.splice(position < 0 ? data.length + position : position, 0, data.splice(start, 1)[0]);\n    this._cached = data;\n    this._cachedChange.next({\n      active: 'move',\n      url,\n      position,\n      list: this._cached,\n    });\n  }\n  /**\n   * 强制关闭当前路由（包含不可关闭状态），并重新导航至 `newUrl` 路由\n   */\n  replace(newUrl: string): void {\n    const url = this.curUrl;\n    if (this.exists(url)) {\n      this.close(url, true);\n    } else {\n      this.removeUrlBuffer = url;\n    }\n    this.injector.get<Router>(Router).navigateByUrl(newUrl);\n  }\n  /**\n   * 获取标题，顺序如下：\n   *\n   * 1. 组件内使用 `ReuseTabService.title = 'new title'` 重新指定文本\n   * 2. 路由配置中 data 属性中包含 titleI18n > title\n   * 3. 菜单数据中 text 属性\n   *\n   * @param url 指定URL\n   * @param route 指定路由快照\n   */\n  getTitle(url: string, route?: ActivatedRouteSnapshot): ReuseTitle {\n    if (this._titleCached[url]) {\n      return this._titleCached[url];\n    }\n\n    if (route && route.data && (route.data.titleI18n || route.data.title)) {\n      return {\n        text: route.data.title,\n        i18n: route.data.titleI18n,\n      } as ReuseTitle;\n    }\n\n    const menu = this.getMenu(url);\n    return menu ? { text: menu.text, i18n: menu.i18n } : { text: url };\n  }\n\n  /**\n   * 清除标题缓存\n   */\n  clearTitleCached(): void {\n    this._titleCached = {};\n  }\n  /** 自定义当前 `closable` 状态 */\n  set closable(value: boolean) {\n    const url = this.curUrl;\n    this._closableCached[url] = value;\n    this.di('update current tag closable: ', value);\n    this._cachedChange.next({\n      active: 'closable',\n      closable: value,\n      list: this._cached,\n    });\n  }\n  /**\n   * 获取 `closable` 状态，顺序如下：\n   *\n   * 1. 组件内使用 `ReuseTabService.closable = true` 重新指定 `closable` 状态\n   * 2. 路由配置中 data 属性中包含 `reuseClosable`\n   * 3. 菜单数据中 `reuseClosable` 属性\n   *\n   * @param url 指定URL\n   * @param route 指定路由快照\n   */\n  getClosable(url: string, route?: ActivatedRouteSnapshot): boolean {\n    if (typeof this._closableCached[url] !== 'undefined') return this._closableCached[url];\n\n    if (route && route.data && typeof route.data.reuseClosable === 'boolean') return route.data.reuseClosable;\n\n    const menu = this.mode !== ReuseTabMatchMode.URL ? this.getMenu(url) : null;\n    if (menu && typeof menu.reuseClosable === 'boolean') return menu.reuseClosable;\n\n    return true;\n  }\n  /**\n   * 清空 `closable` 缓存\n   */\n  clearClosableCached(): void {\n    this._closableCached = {};\n  }\n  getTruthRoute(route: ActivatedRouteSnapshot): ActivatedRouteSnapshot {\n    let next = route;\n    while (next.firstChild) next = next.firstChild;\n    return next;\n  }\n  /**\n   * 根据快照获取URL地址\n   */\n  getUrl(route: ActivatedRouteSnapshot): string {\n    let next = this.getTruthRoute(route);\n    const segments: string[] = [];\n    while (next) {\n      segments.push(next.url.join('/'));\n      next = next.parent!;\n    }\n    const url =\n      '/' +\n      segments\n        .filter(i => i)\n        .reverse()\n        .join('/');\n    return url;\n  }\n  /**\n   * 检查快照是否允许被复用\n   */\n  can(route: ActivatedRouteSnapshot): boolean {\n    const url = this.getUrl(route);\n    if (url === this.removeUrlBuffer) return false;\n\n    if (route.data && typeof route.data.reuse === 'boolean') return route.data.reuse;\n\n    if (this.mode !== ReuseTabMatchMode.URL) {\n      const menu = this.getMenu(url);\n      if (!menu) return false;\n      if (this.mode === ReuseTabMatchMode.Menu) {\n        if (menu.reuse === false) return false;\n      } else {\n        if (!menu.reuse || menu.reuse !== true) return false;\n      }\n      return true;\n    }\n    return !this.isExclude(url);\n  }\n\n  isExclude(url: string): boolean {\n    return this.excludes.findIndex(r => r.test(url)) !== -1;\n  }\n\n  /**\n   * 刷新，触发一个 refresh 类型事件\n   */\n  refresh(data?: any): void {\n    this._cachedChange.next({ active: 'refresh', data });\n  }\n  // #endregion\n\n  // #region privates\n\n  private destroy(_handle: any): void {\n    if (_handle && _handle.componentRef && _handle.componentRef.destroy) _handle.componentRef.destroy();\n  }\n\n  private di(...args: NzSafeAny[]): void {\n    if (!this.debug) return;\n    // tslint:disable-next-line:no-console\n    console.warn(...args);\n  }\n\n  // #endregion\n\n  constructor(private injector: Injector, private menuService: MenuService) {}\n\n  init(): void {\n    this.initScroll();\n    this._inited = true;\n  }\n\n  private getMenu(url: string): Menu | null | undefined {\n    const menus = this.menuService.getPathByUrl(url);\n    if (!menus || menus.length === 0) return null;\n    return menus.pop();\n  }\n\n  runHook(method: ReuseHookTypes, comp: ReuseComponentRef | number, type: ReuseHookOnReuseInitType = 'init'): void {\n    if (typeof comp === 'number') {\n      const item = this._cached[comp];\n      comp = item._handle.componentRef;\n    }\n    const compThis = comp.instance;\n    if (comp == null || !compThis) {\n      return;\n    }\n    const fn = compThis[method];\n    if (typeof fn !== 'function') {\n      return;\n    }\n    if (method === '_onReuseInit') {\n      fn.call(compThis, type);\n    } else {\n      (fn as () => void).call(compThis);\n    }\n  }\n\n  private hasInValidRoute(route: ActivatedRouteSnapshot): boolean {\n    return !route.routeConfig || !!route.routeConfig.loadChildren || !!route.routeConfig.children;\n  }\n\n  /**\n   * 决定是否允许路由复用，若 `true` 会触发 `store`\n   */\n  shouldDetach(route: ActivatedRouteSnapshot): boolean {\n    if (this.hasInValidRoute(route)) return false;\n    this.di('#shouldDetach', this.can(route), this.getUrl(route));\n    return this.can(route);\n  }\n\n  /**\n   * 存储\n   */\n  store(_snapshot: ActivatedRouteSnapshot, _handle: any): void {\n    const url = this.getUrl(_snapshot);\n    const idx = this.index(url);\n    const isAdd = idx === -1;\n\n    const item: ReuseTabCached = {\n      title: this.getTitle(url, _snapshot),\n      closable: this.getClosable(url, _snapshot),\n      position: this.getKeepingScroll(url, _snapshot) ? this.positionBuffer[url] : null,\n      url,\n      _snapshot,\n      _handle,\n    };\n    if (isAdd) {\n      if (this.count >= this._max) {\n        // Get the oldest closable location\n        const closeIdx = this._cached.findIndex(w => w.closable!);\n        if (closeIdx !== -1) this.remove(closeIdx, false);\n      }\n      this._cached.push(item);\n    } else {\n      this._cached[idx] = item;\n    }\n    this.removeUrlBuffer = null;\n\n    this.di('#store', isAdd ? '[new]' : '[override]', url);\n\n    if (_handle && _handle.componentRef) {\n      this.runHook('_onReuseDestroy', _handle.componentRef);\n    }\n\n    if (!isAdd) {\n      this._cachedChange.next({ active: 'override', item, list: this._cached });\n    }\n  }\n\n  /**\n   * 决定是否允许应用缓存数据\n   */\n  shouldAttach(route: ActivatedRouteSnapshot): boolean {\n    if (this.hasInValidRoute(route)) return false;\n    const url = this.getUrl(route);\n    const data = this.get(url);\n    const ret = !!(data && data._handle);\n    this.di('#shouldAttach', ret, url);\n    if (ret) {\n      const compRef = data!._handle.componentRef;\n      if (compRef) {\n        this.componentRef = compRef;\n        this.runHook('_onReuseInit', compRef);\n      }\n    } else {\n      this._cachedChange.next({ active: 'add', url, list: this._cached });\n    }\n    return ret;\n  }\n\n  /**\n   * 提取复用数据\n   */\n  retrieve(route: ActivatedRouteSnapshot): {} | null {\n    if (this.hasInValidRoute(route)) return null;\n    const url = this.getUrl(route);\n    const data = this.get(url);\n    const ret = (data && data._handle) || null;\n    this.di('#retrieve', url, ret);\n    return ret;\n  }\n\n  /**\n   * 决定是否应该进行复用路由处理\n   */\n  shouldReuseRoute(future: ActivatedRouteSnapshot, curr: ActivatedRouteSnapshot): boolean {\n    let ret = future.routeConfig === curr.routeConfig;\n    if (!ret) return false;\n\n    const path = ((future.routeConfig && future.routeConfig.path) || '') as string;\n    if (path.length > 0 && ~path.indexOf(':')) {\n      if (this.routeParamMatchMode === 'strict') {\n        ret = this.getUrl(future) === this.getUrl(curr);\n      } else {\n        ret = path === ((curr.routeConfig && curr.routeConfig.path) || '');\n      }\n    }\n    this.di('=====================');\n    this.di('#shouldReuseRoute', ret, `${this.getUrl(curr)}=>${this.getUrl(future)}`, future, curr);\n    return ret;\n  }\n\n  // #region scroll\n\n  /**\n   * 获取 `keepingScroll` 状态，顺序如下：\n   *\n   * 1. 路由配置中 data 属性中包含 `keepingScroll`\n   * 2. 菜单数据中 `keepingScroll` 属性\n   * 3. 组件 `keepingScroll` 值\n   */\n  getKeepingScroll(url: string, route?: ActivatedRouteSnapshot): boolean {\n    if (route && route.data && typeof route.data.keepingScroll === 'boolean') return route.data.keepingScroll;\n\n    const menu = this.mode !== ReuseTabMatchMode.URL ? this.getMenu(url) : null;\n    if (menu && typeof menu.keepingScroll === 'boolean') return menu.keepingScroll;\n\n    return this.keepingScroll;\n  }\n\n  private get isDisabledInRouter(): boolean {\n    const routerConfig = this.injector.get<ExtraOptions>(ROUTER_CONFIGURATION, {} as any);\n    return routerConfig.scrollPositionRestoration === 'disabled';\n  }\n\n  private get ss(): ScrollService {\n    return this.injector.get(ScrollService);\n  }\n\n  private initScroll(): void {\n    if (this._router$) {\n      this._router$.unsubscribe();\n    }\n\n    this._router$ = this.injector.get<Router>(Router).events.subscribe(e => {\n      if (e instanceof NavigationStart) {\n        const url = this.curUrl;\n        if (this.getKeepingScroll(url, this.getTruthRoute(this.snapshot))) {\n          this.positionBuffer[url] = this.ss.getScrollPosition(this.keepingScrollContainer);\n        } else {\n          delete this.positionBuffer[url];\n        }\n      } else if (e instanceof NavigationEnd) {\n        const url = this.curUrl;\n        const item = this.get(url);\n        if (item && item.position && this.getKeepingScroll(url, this.getTruthRoute(this.snapshot))) {\n          if (this.isDisabledInRouter) {\n            this.ss.scrollToPosition(this.keepingScrollContainer, item.position);\n          } else {\n            setTimeout(() => this.ss.scrollToPosition(this.keepingScrollContainer, item.position!), 1);\n          }\n        }\n      }\n    });\n  }\n\n  // #endregion\n\n  ngOnDestroy(): void {\n    const { _cachedChange, _router$ } = this;\n    this.clear();\n    this._cached = [];\n    _cachedChange.complete();\n\n    if (_router$) {\n      _router$.unsubscribe();\n    }\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Inject,\n  Input,\n  OnChanges,\n  OnInit,\n  Optional,\n  Output,\n  SimpleChange,\n  SimpleChanges,\n  TemplateRef,\n  ViewChild,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { AlainI18NService, ALAIN_I18N_TOKEN } from '@delon/theme';\nimport { BooleanInput, InputBoolean, InputNumber, NumberInput } from '@delon/util/decorator';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { NzTabSetComponent } from 'ng-zorro-antd/tabs';\nimport { Subject } from 'rxjs';\nimport { debounceTime, filter } from 'rxjs/operators';\nimport { ReuseTabContextService } from './reuse-tab-context.service';\nimport {\n  ReuseContextCloseEvent,\n  ReuseContextI18n,\n  ReuseCustomContextMenu,\n  ReuseItem,\n  ReuseTabCached,\n  ReuseTabMatchMode,\n  ReuseTabNotify,\n  ReuseTabRouteParamMatchMode,\n  ReuseTitle,\n} from './reuse-tab.interfaces';\nimport { ReuseTabService } from './reuse-tab.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'reuse-tab, [reuse-tab]',\n  exportAs: 'reuseTab',\n  templateUrl: './reuse-tab.component.html',\n  host: {\n    '[class.reuse-tab]': 'true',\n    '[class.reuse-tab__line]': `tabType === 'line'`,\n    '[class.reuse-tab__card]': `tabType === 'card'`,\n    '[class.reuse-tab__disabled]': `disabled`,\n  },\n  providers: [ReuseTabContextService],\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class ReuseTabComponent implements OnInit, OnChanges {\n  static ngAcceptInputType_debug: BooleanInput;\n  static ngAcceptInputType_max: NumberInput;\n  static ngAcceptInputType_tabMaxWidth: NumberInput;\n  static ngAcceptInputType_allowClose: BooleanInput;\n  static ngAcceptInputType_keepingScroll: BooleanInput;\n  static ngAcceptInputType_disabled: BooleanInput;\n\n  @ViewChild('tabset') private tabset: NzTabSetComponent;\n  private updatePos$ = new Subject<void>();\n  private _keepingScrollContainer: Element;\n  list: ReuseItem[] = [];\n  item: ReuseItem;\n  pos = 0;\n\n  // #region fields\n\n  @Input() mode: ReuseTabMatchMode = ReuseTabMatchMode.Menu;\n  @Input() i18n: ReuseContextI18n;\n  @Input() @InputBoolean() debug = false;\n  @Input() @InputNumber() max: number;\n  @Input() @InputNumber() tabMaxWidth: number;\n  @Input() excludes: RegExp[];\n  @Input() @InputBoolean() allowClose = true;\n  @Input() @InputBoolean() keepingScroll = false;\n  @Input()\n  set keepingScrollContainer(value: string | Element) {\n    this._keepingScrollContainer = typeof value === 'string' ? this.doc.querySelector(value) : value;\n  }\n  @Input() customContextMenu: ReuseCustomContextMenu[] = [];\n  @Input() tabBarExtraContent: TemplateRef<void>;\n  @Input() tabBarGutter: number;\n  @Input() tabBarStyle: { [key: string]: string };\n  @Input() tabType: 'line' | 'card' = 'line';\n  @Input() routeParamMatchMode: ReuseTabRouteParamMatchMode = 'strict';\n  @Input() @InputBoolean() disabled = false;\n  @Input() titleRender?: TemplateRef<{ $implicit: ReuseItem }>;\n  @Output() readonly change = new EventEmitter<ReuseItem>();\n  @Output() readonly close = new EventEmitter<ReuseItem | null>();\n\n  // #endregion\n\n  constructor(\n    private srv: ReuseTabService,\n    private cdr: ChangeDetectorRef,\n    private router: Router,\n    private route: ActivatedRoute,\n    @Optional() @Inject(ALAIN_I18N_TOKEN) private i18nSrv: AlainI18NService,\n    @Inject(DOCUMENT) private doc: any,\n  ) {}\n\n  private genTit(title: ReuseTitle): string {\n    return title.i18n && this.i18nSrv ? this.i18nSrv.fanyi(title.i18n) : title.text!;\n  }\n\n  private get curUrl(): string {\n    return this.srv.getUrl(this.route.snapshot);\n  }\n\n  private genCurItem(): ReuseItem {\n    const url = this.curUrl;\n    const snapshotTrue = this.srv.getTruthRoute(this.route.snapshot);\n    return {\n      url,\n      title: this.genTit(this.srv.getTitle(url, snapshotTrue)),\n      closable: this.allowClose && this.srv.count > 0 && this.srv.getClosable(url, snapshotTrue),\n      active: false,\n      last: false,\n      index: 0,\n    };\n  }\n\n  private genList(notify: ReuseTabNotify | null): void {\n    const ls = this.srv.items.map(\n      (item: ReuseTabCached, index: number) =>\n        ({\n          url: item.url,\n          title: this.genTit(item.title),\n          closable: this.allowClose && item.closable && this.srv.count > 0,\n          index,\n          active: false,\n          last: false,\n        } as ReuseItem),\n    );\n\n    const url = this.curUrl;\n    let addCurrent = ls.findIndex(w => w.url === url) === -1;\n    if (notify && notify.active === 'close' && notify.url === url) {\n      addCurrent = false;\n      let toPos = 0;\n      const curItem = this.list.find(w => w.url === url)!;\n      if (curItem.index === ls.length) {\n        // When closed is last\n        toPos = ls.length - 1;\n      } else if (curItem.index < ls.length) {\n        // Should be actived next tab when closed is middle\n        toPos = Math.max(0, curItem.index);\n      }\n      this.router.navigateByUrl(ls[toPos].url);\n    }\n\n    if (addCurrent) {\n      ls.push(this.genCurItem());\n    }\n\n    ls.forEach((item, index) => (item.index = index));\n    if (ls.length === 1) {\n      ls[0].closable = false;\n    }\n    this.list = ls;\n    this.cdr.detectChanges();\n    this.updatePos$.next();\n  }\n\n  private updateTitle(res: ReuseTabNotify): void {\n    const item = this.list.find(w => w.url === res!.url);\n    if (!item) return;\n    item.title = this.genTit(res!.title!);\n    this.cdr.detectChanges();\n  }\n\n  private refresh(item: ReuseItem): void {\n    this.srv.runHook('_onReuseInit', this.pos === item.index ? this.srv.componentRef : item.index, 'refresh');\n  }\n\n  // #region UI\n\n  contextMenuChange(res: ReuseContextCloseEvent): void {\n    let fn: (() => void) | null = null;\n    switch (res.type) {\n      case 'refresh':\n        this.refresh(res.item);\n        break;\n      case 'close':\n        this._close(null, res.item.index, res.includeNonCloseable);\n        break;\n      case 'closeRight':\n        fn = () => {\n          this.srv.closeRight(res.item.url, res.includeNonCloseable);\n          this.close.emit(null);\n        };\n        break;\n      case 'closeOther':\n        fn = () => {\n          this.srv.clear(res.includeNonCloseable);\n          this.close.emit(null);\n        };\n        break;\n    }\n    if (!fn) {\n      return;\n    }\n    if (!res.item.active && res.item.index <= this.list.find(w => w.active)!.index) {\n      this._to(res.item.index, fn);\n    } else {\n      fn();\n    }\n  }\n\n  _to(index: number, cb?: () => void): void {\n    index = Math.max(0, Math.min(index, this.list.length - 1));\n    const item = this.list[index];\n    this.router.navigateByUrl(item.url).then(res => {\n      if (!res) return;\n      this.item = item;\n      this.change.emit(item);\n      if (cb) {\n        cb();\n      }\n    });\n  }\n\n  _close(e: Event | null, idx: number, includeNonCloseable: boolean): boolean {\n    if (e != null) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    const item = this.list[idx];\n    this.srv.close(item.url, includeNonCloseable);\n    this.close.emit(item);\n    this.cdr.detectChanges();\n    return false;\n  }\n\n  activate(instance: any): void {\n    this.srv.componentRef = { instance };\n  }\n\n  // #endregion\n\n  ngOnInit(): void {\n    this.updatePos$.pipe(untilDestroyed(this), debounceTime(50)).subscribe(() => {\n      const url = this.srv.getUrl(this.route.snapshot);\n      const ls = this.list.filter(w => w.url === url || !this.srv.isExclude(w.url));\n      if (ls.length === 0) {\n        return;\n      }\n\n      const last = ls[ls.length - 1];\n      const item = ls.find(w => w.url === url);\n      last.last = true;\n      const pos = item == null ? last.index : item.index;\n      ls.forEach((i, idx) => (i.active = pos === idx));\n      this.pos = pos;\n      // TODO: 目前无法知道为什么 `pos` 无法通过 `nzSelectedIndex` 生效，因此强制使用组件实例的方式来修改，这种方式是安全的\n      // https://github.com/ng-alain/ng-alain/issues/1736\n      this.tabset.nzSelectedIndex = pos;\n      this.list = ls;\n      this.cdr.detectChanges();\n    });\n\n    this.srv.change.pipe(untilDestroyed(this)).subscribe(res => {\n      switch (res?.active) {\n        case 'title':\n          this.updateTitle(res);\n          return;\n        case 'override':\n          if (res?.list?.length === this.list.length) {\n            this.updatePos$.next();\n            return;\n          }\n          break;\n      }\n      this.genList(res);\n    });\n\n    this.i18nSrv.change\n      .pipe(\n        filter(() => this.srv.inited),\n        untilDestroyed(this),\n        debounceTime(100),\n      )\n      .subscribe(() => this.genList({ active: 'title' }));\n\n    this.srv.init();\n  }\n\n  ngOnChanges(changes: { [P in keyof this]?: SimpleChange } & SimpleChanges): void {\n    if (changes.max) this.srv.max = this.max;\n    if (changes.excludes) this.srv.excludes = this.excludes;\n    if (changes.mode) this.srv.mode = this.mode;\n    if (changes.routeParamMatchMode) this.srv.routeParamMatchMode = this.routeParamMatchMode;\n    if (changes.keepingScroll) {\n      this.srv.keepingScroll = this.keepingScroll;\n      this.srv.keepingScrollContainer = this._keepingScrollContainer;\n    }\n\n    this.srv.debug = this.debug;\n\n    this.cdr.detectChanges();\n  }\n}\n","import { ActivatedRouteSnapshot, RouteReuseStrategy } from '@angular/router';\nimport { ReuseTabService } from './reuse-tab.service';\n\nexport class ReuseTabStrategy implements RouteReuseStrategy {\n  constructor(private srv: ReuseTabService) {}\n\n  shouldDetach(route: ActivatedRouteSnapshot): boolean {\n    return this.srv.shouldDetach(route);\n  }\n  store(route: ActivatedRouteSnapshot, handle: {}): void {\n    this.srv.store(route, handle);\n  }\n  shouldAttach(route: ActivatedRouteSnapshot): boolean {\n    return this.srv.shouldAttach(route);\n  }\n  retrieve(route: ActivatedRouteSnapshot): {} | null {\n    return this.srv.retrieve(route);\n  }\n  shouldReuseRoute(future: ActivatedRouteSnapshot, curr: ActivatedRouteSnapshot): boolean {\n    return this.srv.shouldReuseRoute(future, curr);\n  }\n}\n","import { OverlayModule } from '@angular/cdk/overlay';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport { DelonLocaleModule } from '@delon/theme';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzMenuModule } from 'ng-zorro-antd/menu';\nimport { NzTabsModule } from 'ng-zorro-antd/tabs';\nimport { ReuseTabContextMenuComponent } from './reuse-tab-context-menu.component';\nimport { ReuseTabContextComponent } from './reuse-tab-context.component';\nimport { ReuseTabContextDirective } from './reuse-tab-context.directive';\nimport { ReuseTabComponent } from './reuse-tab.component';\n\nconst COMPONENTS = [ReuseTabComponent];\nconst NOEXPORTS = [ReuseTabContextMenuComponent, ReuseTabContextComponent, ReuseTabContextDirective];\n\n@NgModule({\n  imports: [CommonModule, RouterModule, DelonLocaleModule, NzMenuModule, NzTabsModule, NzIconModule, OverlayModule],\n  declarations: [...COMPONENTS, ...NOEXPORTS],\n  exports: COMPONENTS,\n})\nexport class ReuseTabModule {}\n"]}