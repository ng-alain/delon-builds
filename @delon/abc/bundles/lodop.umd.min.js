/**
 * @license ng-alain(cipchk@qq.com) v2.0.0-beta.4-4b8e9aa
 * (c) 2018 Cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@delon/util")):"function"==typeof define&&define.amd?define("@delon/abc/lodop",["exports","@angular/core","rxjs","@delon/util"],t):t((e.delon=e.delon||{},e.delon.abc=e.delon.abc||{},e.delon.abc.lodop={}),e.ng.core,e.rxjs,e.delon.util)}(this,function(e,t,o,n){"use strict";function i(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),c=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)c.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i["return"])&&o.call(i)}finally{if(r)throw r.error}}return c}var r=function u(){},c=function(){function e(e,t){this.defCog=e,this.scriptSrv=t,this.pending=!1,this._lodop=null,this._init=new o.Subject,this._events=new o.Subject,this.printBuffer=[],this.cog=e}return Object.defineProperty(e.prototype,"cog",{get:function(){return this._cog},set:function(e){this._cog=Object.assign({url:"https://localhost:8443/CLodopfuncs.js",name:"CLODOP",companyName:"",checkMaxCount:100},this.defCog,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this._events.asObservable()},enumerable:!0,configurable:!0}),e.prototype.check=function(){if(!this._lodop)throw new Error("请务必先调用 lodop 获取对象")},e.prototype.request=function(){var o=this;this.pending=!0;var e=this.cog.url+"?name="+this.cog.name,t=this.cog.checkMaxCount,n=function(e,t){o._init.next({ok:"ok"===e,status:e,error:t,lodop:o._lodop})},r=function(){if(--t,o._lodop.webskt&&1===o._lodop.webskt.readyState)n("ok");else{if(t<0)return void n("check-limit");setTimeout(function(){return r()},100)}};this.scriptSrv.loadScript(e).then(function(e){if("ok"!==e.status)return o.pending=!1,void n("script-load-error",e[0]);o._lodop=window.hasOwnProperty(o.cog.name)&&window[o.cog.name],null!==o._lodop?(o._lodop.SET_LICENSES(o.cog.companyName,o.cog.license,o.cog.licenseA,o.cog.licenseB),r()):n("load-variable-name-error",{name:o.cog.name})})},e.prototype.reset=function(){this._lodop=null,this.pending=!1,this.request()},Object.defineProperty(e.prototype,"lodop",{get:function(){return this._lodop?o.of({ok:!0,lodop:this._lodop}):(this.pending||this.request(),this._init.asObservable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"printer",{get:function(){this.check();for(var e=[],t=this._lodop.GET_PRINTER_COUNT(),o=0;o<t;o++)e.push(this._lodop.GET_PRINTER_NAME(o));return e},enumerable:!0,configurable:!0}),e.prototype.attachCode=function(e,c,s){var u=this;this.check(),s||(s=/LODOP\.([^(]+)\(([^\n]+)\);/i),e.split("\n").forEach(function(e){var t=s.exec(e.trim());if(t){var o=u._lodop[t[1]];if(o){var n=void 0;try{n=new Function("return ["+t[2]+"]")()}catch(i){}if(Array.isArray(n)&&c)for(var r=0;r<n.length;r++)"string"==typeof n[r]&&(n[r]=n[r].replace(/{{(.*?)}}/g,function(e,t){return c[t.trim()]||""}));o.apply(u._lodop,n)}}})},e.prototype.design=function(){var n=this;this.check();var r=this._lodop.PRINT_DESIGN();return new Promise(function(o){n._lodop.On_Return=function(e,t){r===e&&(n._lodop.On_Return=null,o(""+t))}})},e.prototype.printDo=function(){var o=this,n=this.printBuffer.shift();if(n){this.attachCode(n.code,n.item,n.parser);var r=this._lodop.PRINT();this._lodop.On_Return=function(e,t){r===e&&(o._lodop.On_Return=null,o._events.next(Object.assign({ok:!0===t,error:!0===t?null:t},n)),o.printDo())}}},e.prototype.print=function(t,e,o){var n;this.check(),e&&(n=this.printBuffer).push.apply(n,function r(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}((Array.isArray(e)?e:[e]).map(function(e){return{code:t,parser:o,item:e}}))),this.printDo()},e.prototype.ngOnDestroy=function(){this._init.unsubscribe(),this._events.unsubscribe()},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:r},{type:n.LazyService}]},e}(),s=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[c,r]}},e.decorators=[{type:t.NgModule,args:[{imports:[n.DelonUtilModule]}]}],e}();e.LodopService=c,e.LodopConfig=r,e.LodopModule=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=lodop.umd.min.js.map