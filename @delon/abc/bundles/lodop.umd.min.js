/**
 * @license ng-alain(cipchk@qq.com) v8.7.2
 * (c) 2019 cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@delon/util")):"function"==typeof define&&define.amd?define("@delon/abc/lodop",["exports","@angular/core","rxjs","@delon/util"],t):t(((e=e||self).delon=e.delon||{},e.delon.abc=e.delon.abc||{},e.delon.abc.lodop={}),e.ng.core,e.rxjs,e.delon.util)}(this,(function(e,t,o,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var r=function(){return(r=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)c.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return c}var c=function(){function e(){}return e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var u=function(){function e(e,t){this.defCog=e,this.scriptSrv=t,this.pending=!1,this._lodop=null,this._init=new o.Subject,this._events=new o.Subject,this.printBuffer=[],this.cog=e}return Object.defineProperty(e.prototype,"cog",{get:function(){return this._cog},set:function(e){this._cog=r({url:"https://localhost:8443/CLodopfuncs.js",name:"CLODOP",companyName:"",checkMaxCount:100},this.defCog,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this._events.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodop",{get:function(){return this._lodop?o.of({ok:!0,lodop:this._lodop}):this.pending?this._init.asObservable():(this.request(),this._init.asObservable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"printer",{get:function(){this.check();for(var e=[],t=this._lodop.GET_PRINTER_COUNT(),o=0;o<t;o++)e.push(this._lodop.GET_PRINTER_NAME(o));return e},enumerable:!0,configurable:!0}),e.prototype.check=function(){if(!this._lodop)throw new Error("请务必先调用 lodop 获取对象")},e.prototype.request=function(){var e=this;this.pending=!0;var t=this.cog.url+"?name="+this.cog.name,o=this.cog.checkMaxCount,n=function(t,o){e._init.next({ok:"ok"===t,status:t,error:o,lodop:e._lodop})},r=function(){if(--o,e._lodop.webskt&&1===e._lodop.webskt.readyState)n("ok");else{if(o<0)return void n("check-limit");setTimeout((function(){return r()}),100)}};this.scriptSrv.loadScript(t).then((function(t){if("ok"!==t.status)return e.pending=!1,void n("script-load-error",t[0]);window.hasOwnProperty(e.cog.name)&&(e._lodop=window[e.cog.name]),null!==e._lodop?(e._lodop.SET_LICENSES(e.cog.companyName,e.cog.license,e.cog.licenseA,e.cog.licenseB),r()):n("load-variable-name-error",{name:e.cog.name})}))},e.prototype.reset=function(){this._lodop=null,this.pending=!1,this.request()},e.prototype.attachCode=function(e,t,o){var n=this;this.check(),o||(o=/LODOP\.([^(]+)\(([^\n]+)\);/i),e.split("\n").forEach((function(e){var r=o.exec(e.trim());if(r){var i=n._lodop[r[1]];if(i){var c=null;try{c=new Function("return ["+r[2]+"]")()}catch(e){}if(null!=c&&Array.isArray(c)&&t)for(var u=0;u<c.length;u++)"string"==typeof c[u]&&(c[u]=c[u].replace(/{{(.*?)}}/g,(function(e,o){return t[o.trim()]||""})));i.apply(n._lodop,c)}}}))},e.prototype.design=function(){var e=this;this.check();var t=this._lodop.PRINT_DESIGN();return new Promise((function(o){e._lodop.On_Return=function(n,r){t===n&&(e._lodop.On_Return=null,o(""+r))}}))},e.prototype.printDo=function(){var e=this,t=this.printBuffer.shift();if(t){this.attachCode(t.code,t.item,t.parser);var o=this._lodop.PRINT();this._lodop.On_Return=function(n,i){o===n&&(e._lodop.On_Return=null,e._events.next(r({ok:!0===i,error:!0===i?null:i},t)),e.printDo())}}},e.prototype.print=function(e,t,o){var n;this.check(),t&&(n=this.printBuffer).push.apply(n,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}((Array.isArray(t)?t:[t]).map((function(t){return{code:e,parser:o,item:t}})))),this.printDo()},e.prototype.ngOnDestroy=function(){this._init.unsubscribe(),this._events.unsubscribe()},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:c},{type:n.LazyService}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(c),t.ɵɵinject(n.LazyService))},token:e,providedIn:"root"}),e}();var s=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[n.DelonUtilModule]}]}],e}();e.LodopConfig=c,e.LodopModule=s,e.LodopService=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=lodop.umd.min.js.map