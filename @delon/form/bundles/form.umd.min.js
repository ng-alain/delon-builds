/**
 * @license ng-alain(cipchk@qq.com) v2.0.0-beta.5
 * (c) 2018 Cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/operators"),require("@delon/util"),require("@angular/core"),require("@delon/theme"),require("date-fns/format"),require("ng-zorro-antd"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@delon/form",["exports","rxjs","rxjs/operators","@delon/util","@angular/core","@delon/theme","date-fns/format","ng-zorro-antd","@angular/common","@angular/forms"],t):t((e.delon=e.delon||{},e.delon.form={}),e.rxjs,e.rxjs.operators,e.delon.util,e.ng.core,e.delon.theme,e.format,e.ngZorro.antd,e.ng.common,e.ng.forms)}(this,function(e,l,u,r,a,t,i,n,o,s){"use strict";i=i&&i.hasOwnProperty("default")?i["default"]:i;var p={"false schema":"布尔模式出错",$ref:"无法找到引用{ref}",additionalItems:"不允许超过{ref}",additionalProperties:"不允许有额外的属性",anyOf:"数据应为 anyOf 所指定的其中一个",dependencies:"应当拥有属性{property}的依赖属性{deps}","enum":"应当是预设定的枚举值之一",format:"格式不正确",type:"类型应当是 {type}",required:"必填项",maxLength:"至多 {limit} 个字符",minLength:"至少 {limit} 个字符以上",minimum:"必须 {comparison}{limit}",formatMinimum:"必须 {comparison}{limit}",maximum:"必须 {comparison}{limit}",formatMaximum:"必须 {comparison}{limit}",maxItems:"不应多于 {limit} 个项",minItems:"不应少于 {limit} 个项",maxProperties:"不应多于 {limit} 个属性",minProperties:"不应少于 {limit} 个属性",multipleOf:"应当是 {multipleOf} 的整数倍",not:'不应当匹配 "not" schema',oneOf:'只能匹配一个 "oneOf" 中的 schema',pattern:"数据格式不正确",uniqueItems:"不应当含有重复项 (第 {j} 项与第 {i} 项是重复的)",custom:"格式不正确",propertyNames:'属性名 "{propertyName}" 无效',patternRequired:"应当有属性匹配模式 {missingPattern}","switch":'由于 {caseIndex} 失败，未通过 "switch" 校验',"const":"应当等于常量",contains:"应当包含一个有效项",formatExclusiveMaximum:"formatExclusiveMaximum 应当是布尔值",formatExclusiveMinimum:"formatExclusiveMinimum 应当是布尔值","if":'应当匹配模式 "{failingKeyword}"'},c=function Ve(){this.ingoreKeywords=["type","enum"],this.liveValidate=!0,this.autocomplete=null,this.firstVisual=!1,this.onlyVisual=!1,this.errors=p,this.button={submit_type:"primary",reset_type:"default"},this.uiDateStringFormat="YYYY-MM-DD HH:mm:ss",this.uiDateNumberFormat="x",this.uiTimeStringFormat="HH:mm:ss",this.uiTimeNumberFormat="x"},h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function d(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var f=function(){return(f=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function m(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(a=(o<3?r(a):3<o?r(t,n,a):r(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a}function y(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function b(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(i=o.next()).done;)a.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o["return"])&&n.call(o)}finally{if(r)throw r.error}}return a}function z(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}var v={"date-time":{widget:"date",showTime:!0,format:"YYYY-MM-DDTHH:mm:ssZ"},date:{widget:"date",format:"YYYY-MM-DD"},"full-date":{widget:"date",format:"YYYY-MM-DD"},time:{widget:"time"},"full-time":{widget:"time"},week:{widget:"date",mode:"week",format:"YYYY-WW"},month:{widget:"date",mode:"month",format:"YYYY-MM"},uri:{widget:"upload"},email:{widget:"autocomplete",type:"email"},color:{widget:"string",type:"color"},"":{widget:"string"}};function w(e){return null==e}function C(e,t){return null==e?t:""+e!="false"}function x(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,z(e))}function _(e,t){if(void 0===t&&(t={}),e.hasOwnProperty("$ref")){var n=function c(e,t){var n,i,r=/^#\/definitions\/(.*)$/.exec(e);if(r&&r[1]){var o=r[1].split("/"),a=t;try{for(var s=g(o),l=s.next();!l.done;l=s.next()){var u=l.value;if(u=u.replace(/~1/g,"/").replace(/~0/g,"~"),!a.hasOwnProperty(u))throw new Error("Could not find a definition for "+e+".");a=a[u]}}catch(p){n={error:p}}finally{try{l&&!l.done&&(i=s["return"])&&i.call(s)}finally{if(n)throw n.error}}return a}throw new Error("Could not find a definition for "+e+".")}(e.$ref,t),i=(e.$ref,function o(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n}(e,["$ref"]));return _(f({},n,i),t)}return e}function O(n,t){if(n.hasOwnProperty("if")&&n.hasOwnProperty("then")){if(!n["if"].properties)throw new Error("if: does not contain 'properties'");var e=Object.keys(n.properties),i=Object.keys(n["if"].properties);P(e,i),P(e,n.then.required),n.required=n.required.concat(n.then.required);var r=n.hasOwnProperty("else");r&&(P(e,n["else"].required),n.required=n.required.concat(n["else"].required));var o={},a={};return i.forEach(function(e){var t=n["if"].properties[e]["enum"];o[e]=t,r&&(a[e]=function(e){return!t.includes(e)})}),n.then.required.forEach(function(e){return t["$"+e].visibleIf=o}),r&&n["else"].required.forEach(function(e){return t["$"+e].visibleIf=a}),n}}function P(t,e){e.forEach(function(e){if(!t.includes(e))throw new Error("if: properties does not contain '"+e+"'")})}function S(e,t,n){return w(e)||!Array.isArray(e)||0===e.length?[]:("object"!=typeof e[0]&&(e=e.map(function(e){return{label:e,value:e}})),t&&(Array.isArray(t)||(t=[t]),e.forEach(function(e){~t.indexOf(e.value)&&(e.checked=!0)})),n&&e.forEach(function(e){return e.disabled=!0}),e)}function V(e,t,n){return S(r.deepCopy(e||[]),t,n)}function D(t,e,n,i){return"function"==typeof e.asyncData?e.asyncData(i).pipe(u.takeWhile(function(){return!0!==e.__destroy}),u.map(function(e){return S(e,n,t.readOnly)})):l.of(V(t["enum"],n,t.readOnly))}var E=function(){function e(){this.onDestroy=new l.Subject}return e.prototype.destroy=function(){this.onDestroy.next(!0)},e}(),I=function(){function e(e,t,n,i,r,o,a){this.options=a,this._value=null,this._errors=null,this._objErrors={},this._valueChanges=new l.BehaviorSubject(null),this._errorsChanges=new l.BehaviorSubject(null),this._visible=!0,this._visibilityChanges=new l.BehaviorSubject(!0),this.schema=t,this.ui=n,this.schemaValidator=e.createValidatorFn(t,{ingoreKeywords:this.ui.ingoreKeywords}),this.formData=i||t["default"],(this._parent=r)?this._root=r.root:this instanceof M&&(this._root=this),this._path=o}return Object.defineProperty(e.prototype,"valueChanges",{get:function(){return this._valueChanges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorsChanges",{get:function(){return this._errorsChanges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.schema.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root||this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errors",{get:function(){return this._errors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valid",{get:function(){return null===this._errors},enumerable:!0,configurable:!0}),e.prototype.updateValueAndValidity=function(e,t,n){void 0===e&&(e=!1),void 0===t&&(t=!0),void 0===n&&(n=!0),this._updateValue(),t&&this.valueChanges.next(this.value),n&&!0===this.ui.liveValidate&&this._runValidation(),this.parent&&!e&&this.parent.updateValueAndValidity(e,t,!1)},e.prototype.searchProperty=function(e){var t=this,n=null,i=null;if("/"===e[0])i=(n=this.findRoot()).getProperty(e.substr(1));else for(;null===i&&null!==t.parent;)t=n=t.parent,i=n.getProperty(e);return i},e.prototype.findRoot=function(){for(var e=this;null!==e.parent;)e=e.parent;return e},e.prototype.isEmptyData=function(e){if(w(e))return!0;switch(this.type){case"string":return 0===(""+e).length}return!1},e.prototype._runValidation=function(){var t,n=this,e=this.isEmptyData(this._value);t=e&&this.ui._required?[{keyword:"required"}]:e?[]:this.schemaValidator(this._value)||[];var i=this.ui.validator;if("function"==typeof i){var r=i(this.value,this,this.findRoot());return r instanceof l.Observable?void r.subscribe(function(e){n.setCustomErrors(t,e),n.widget.detectChanges()}):void this.setCustomErrors(t,r)}this._errors=t,this.setErrors(this._errors)},e.prototype.setCustomErrors=function(e,t){null!=t&&0<t.length&&t.forEach(function(e,t){if(!e.message)throw new Error("自定义校验器必须至少返回一个 'message' 属性，用于表示错误文本");e._custom=!0}),this._errors=this.mergeErrors(e,t),this.setErrors(this._errors)},e.prototype.mergeErrors=function(e,t){return t&&(Array.isArray(t)?e=e.concat.apply(e,z(t)):e.push(t)),e},e.prototype.setErrors=function(e,t){var i=this;void 0===t&&(t=!0),t&&e&&!this.ui.onlyVisual&&(e=e.map(function(n){var e=!0===n._custom&&n.message?n.message:(i.ui.errors||{})[n.keyword]||i.options.errors[n.keyword]||"";return e&&"function"==typeof e&&(e=e(n)),e&&(~e.indexOf("{")&&(e=e.replace(/{([\.a-z0-9]+)}/g,function(e,t){return n.params[t]||""})),n.message=e),n})),this._errors=e,this._errorsChanges.next(e),this._parent&&this._parent.setParentAndPlatErrors(e,this.path)},e.prototype.setParentAndPlatErrors=function(e,t){var n=this;this._objErrors[t]=e;var i=[];Object.keys(this._objErrors).forEach(function(e){var t=n.searchProperty(e);t&&!t.visible||i.push.apply(i,z(n._objErrors[e]))}),this.setErrors(i,!1)},e.prototype.setVisible=function(e){this._visible=e,this._visibilityChanges.next(e),this.resetValue(this.value,!0)},e.prototype._bindVisibility=function(){var t=this,o=this.ui.visibleIf;if("object"==typeof o&&0===Object.keys(o).length)this.setVisible(!1);else if(o!==undefined){var a=[],e=function(n){if(o.hasOwnProperty(n)){var e=s.searchProperty(n);if(e){var t=e.valueChanges.pipe(u.map(function(e){var t=o[n];return"function"==typeof t?t(e):-1!==t.indexOf("$ANY$")?0<e.length:-1!==t.indexOf(e)})),i=e._visibilityChanges,r=l.combineLatest(t,i).pipe(u.map(function(e){return e[0]&&e[1]}));a.push(r)}else console.warn("Can't find property "+n+" for visibility check of "+s.path)}},s=this;for(var n in o)e(n);l.combineLatest(a).pipe(u.map(function(e){return-1!==e.indexOf(!0)}),u.distinctUntilChanged()).subscribe(function(e){return t.setVisible(e)})}},e}(),M=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.properties=null,e}return d(o,t),o.prototype.getProperty=function(e){var t=e.indexOf("/"),n=-1!==t?e.substr(0,t):e,i=this.properties[n];if(null!==i&&-1!==t&&i instanceof o){var r=e.substr(t+1);i=i.getProperty(r)}return i},o.prototype.forEachChild=function(e){for(var t in this.properties){if(this.properties.hasOwnProperty(t))e(this.properties[t],t)}},o.prototype.forEachChildRecursive=function(t){this.forEachChild(function(e){t(e),e instanceof o&&e.forEachChildRecursive(t)})},o.prototype._bindVisibility=function(){t.prototype._bindVisibility.call(this),this._bindVisibilityRecursive()},o.prototype._bindVisibilityRecursive=function(){this.forEachChildRecursive(function(e){e._bindVisibility()})},o.prototype.isRoot=function(){return this===this.root},o}(I),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.setValue=function(e,t){this._value=e,this.updateValueAndValidity(t,!0)},t.prototype.resetValue=function(e,t){null==e&&(e=this.schema["default"]!==undefined?this.schema["default"]:this.fallbackValue()),this._value=e,this.updateValueAndValidity(t,!0),this.widget&&this.widget.reset(e)},t.prototype._hasValue=function(){return this.fallbackValue()!==this.value},t.prototype._updateValue=function(){},t}(I),T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.fallbackValue=function(){return null},t.prototype.setValue=function(e,t){"string"==typeof e&&(e=e.length?-1<e.indexOf(".")?parseFloat(e):parseInt(e,10):undefined),this._value=e,this.updateValueAndValidity(t,!0)},t}(F),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.fallbackValue=function(){return null},t.prototype.setValue=function(e,t){this._value=null==e?"":e,this.updateValueAndValidity(t,!0)},t}(F),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.fallbackValue=function(){return null},t}(F),j=function(u){function e(e,t,n,i,r,o,a,s){var l=u.call(this,t,n,i,r,o,a,s)||this;return l.formPropertyFactory=e,l.tick=1,l.properties=[],l}return d(e,u),e.prototype.getProperty=function(e){var t=e.indexOf("/"),n=+(-1!==t?e.substr(0,t):e),i=this.properties;if(isNaN(n)||n>=i.length)return undefined;var r=e.substr(t+1);return i[n].getProperty(r)},e.prototype.setValue=function(e,t){this.properties=[],this.clearErrors(),this.resetProperties(e),this.updateValueAndValidity(t,!0)},e.prototype.resetValue=function(e,t){this._value=e||this.schema["default"]||[],this.properties=[],this.clearErrors(),this.resetProperties(this._value),this.updateValueAndValidity(t,!0)},e.prototype._hasValue=function(){return!0},e.prototype._updateValue=function(){var n=[];this.forEachChild(function(e,t){e.visible&&e._hasValue()&&n.push(Object.assign({},e.formData,e.value))}),this._value=n},e.prototype.addProperty=function(e){var t=this.formPropertyFactory.createProperty(this.schema.items,this.ui.$items,e,this);return this.properties.push(t),t},e.prototype.resetProperties=function(e){var t,n;try{for(var i=g(e),r=i.next();!r.done;r=i.next()){var o=r.value;this.addProperty(o).resetValue(o,!0)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.clearErrors=function(e){e?delete this._objErrors[e]:this._objErrors={}},e.prototype.add=function(e){var t=this.addProperty(e);return t.resetValue(e,!1),t},e.prototype.remove=function(e){var t=this.properties;this.clearErrors(t[e].path),t.splice(e,1),this.updateValueAndValidity(!1,!0)},e}(M),L=function(u){function e(e,t,n,i,r,o,a,s){var l=u.call(this,t,n,i,r,o,a,s)||this;return l.formPropertyFactory=e,l._propertiesId=[],l.createProperties(),l}return d(e,u),Object.defineProperty(e.prototype,"propertiesId",{get:function(){return this._propertiesId},enumerable:!0,configurable:!0}),e.prototype.createProperties=function(){var e,t=this;this.properties={},this._propertiesId=[];try{e=function p(e,t){if(!Array.isArray(t))return e;var n=function(e){return e.reduce(function(e,t){return e[t]=!0,e},{})},i=function(e){return"property ["+e.join("', '")+"]"},r=n(e),o=n(t),a=t.filter(function(e){return"*"!==e&&!r[e]});if(a.length)throw new Error("ui schema order list contains extraneous "+i(a));var s=e.filter(function(e){return!o[e]}),l=t.indexOf("*");if(-1===l){if(s.length)throw new Error("ui schema order list does not contain "+i(s));return t}if(l!==t.lastIndexOf("*"))throw new Error("ui schema order list contains more than one wildcard item");var u=z(t);return u.splice.apply(u,z([l,1],s)),u}(Object.keys(this.schema.properties),this.ui.order)}catch(n){console.error("Invalid "+(this.schema.title||"root")+" object field configuration:",n)}e.forEach(function(e){t.properties[e]=t.formPropertyFactory.createProperty(t.schema.properties[e],t.ui["$"+e],(t.formData||{})[e],t,e),t._propertiesId.push(e)})},e.prototype.setValue=function(e,t){for(var n in e)e.hasOwnProperty(n)&&this.properties[n].setValue(e[n],!0);this.updateValueAndValidity(t,!0)},e.prototype.resetValue=function(e,t){for(var n in e=e||this.schema["default"]||{},this.schema.properties)this.properties[n].resetValue(e[n],!0);this.updateValueAndValidity(t,!0)},e.prototype._hasValue=function(){return null!=this.value&&!!Object.keys(this.value).length},e.prototype._updateValue=function(){var n={};this.forEachChild(function(e,t){e.visible&&e._hasValue()&&(n[t]=e.value)}),this._value=n},e}(M),W=function(){function e(e,t){this.schemaValidatorFactory=e,this.options=t}return e.prototype.createProperty=function(e,t,n,i,r){void 0===i&&(i=null);var o=null,a="";if(i)if(a+=i.path,null!==i.parent&&(a+="/"),"object"===i.type)a+=r;else{if("array"!==i.type)throw new Error("Instanciation of a FormProperty with an unknown parent type: "+i.type);a+=i.tick++}else a="/";if(e.$ref){var s=_(e,i.root.schema.definitions);o=this.createProperty(s,t,n,i,a)}else switch(r&&-1!==(i.schema.required||[]).indexOf(r)&&(t._required=!0),null==e.title&&(e.title=r),"string"!==e.type&&"number"!==e.type||e.format||t.format||("date"===t.widget?t.format="string"===e.type?this.options.uiDateStringFormat:this.options.uiDateNumberFormat:"time"===t.widget&&(t.format="string"===e.type?this.options.uiTimeStringFormat:this.options.uiTimeNumberFormat)),e.type){case"integer":case"number":o=new T(this.schemaValidatorFactory,e,t,n,i,a,this.options);break;case"string":o=new k(this.schemaValidatorFactory,e,t,n,i,a,this.options);break;case"boolean":o=new A(this.schemaValidatorFactory,e,t,n,i,a,this.options);break;case"object":o=new L(this,this.schemaValidatorFactory,e,t,n,i,a,this.options);break;case"array":o=new j(this,this.schemaValidatorFactory,e,t,n,i,a,this.options);break;default:throw new TypeError("Undefined type "+e.type)}return o instanceof M&&this.initializeRoot(o),o},e.prototype.initializeRoot=function(e){e._bindVisibility()},e}(),$=function De(){},N=function(n){function e(e){var t=n.call(this)||this;return t.options=e,t.ajv=new Ajv(Object.assign({},e.ajv,{errorDataPath:"property",allErrors:!0,jsonPointers:!0})),t.ajv.addFormat("data-url",/^data:([a-z]+\/[a-z0-9-+.]+)?;name=(.*);base64,(.*)$/),t.ajv.addFormat("color",/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/),t.ajv.addFormat("mobile",/^(0|\+?86|17951)?1[0-9]{10}$/),t.ajv.addFormat("id-card",/(^\d{15}$)|(^\d{17}([0-9]|X)$)/),t}return d(e,n),e.prototype.createValidatorFn=function(i,e){var r=this,o=[].concat(this.options.ingoreKeywords).concat(e.ingoreKeywords);return function(e){try{r.ajv.validate(i,e)}catch(n){}var t=r.ajv.errors;return r.options&&o&&t&&(t=t.filter(function(e){return-1===o.indexOf(e.keyword)})),t}},e.ctorParameters=function(){return[{type:c,decorators:[{type:a.Optional},{type:a.Inject,args:[c]}]}]},e}($),R=function(){function e(){this.widgets={}}return e.prototype.setDefault=function(e){this.defaultWidget=e},e.prototype.register=function(e,t){this.widgets[e]=t},e.prototype.has=function(e){return this.widgets.hasOwnProperty(e)},e.prototype.getType=function(e){return this.has(e)?this.widgets[e]:this.defaultWidget},e}(),H=function(){function e(e,t){this.registry=e,this.resolver=t}return e.prototype.createWidget=function(e,t){this.registry.has(t)||console.warn('No widget for type "'+t+'"');var n=this.registry.getType(t),i=this.resolver.resolveComponentFactory(n);return e.createComponent(i)},e.decorators=[{type:a.Injectable}],e.ctorParameters=function(){return[{type:R},{type:a.ComponentFactoryResolver}]},e}();function q(e,t){return new W(e,t)}var Y=function(){function e(e,t,n,i,r){var o=this;this.formPropertyFactory=e,this.terminator=t,this.options=n,this.cd=i,this.i18n=r,this.locale={},this._renders=new Map,this._valid=!0,this._inited=!1,this.rootProperty=null,this.layout="horizontal",this.button={},this.liveValidate=!0,this.firstVisual=!0,this.formChange=new a.EventEmitter,this.formSubmit=new a.EventEmitter,this.formReset=new a.EventEmitter,this.formError=new a.EventEmitter,this.liveValidate=n.liveValidate,this.firstVisual=n.firstVisual,this.autocomplete=n.autocomplete,this.i18n$=this.i18n.change.subscribe(function(){o.locale=o.i18n.getData("sf"),o._inited&&(o.coverButtonProperty(),o.cd.detectChanges())})}return Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(e){switch(e){case"search":this.layout="inline",this.firstVisual=!1,this.liveValidate=!1,this._btn&&(this._btn.submit=this._btn.search);break;case"edit":this.layout="horizontal",this.firstVisual=!1,this.liveValidate=!0,this._btn&&(this._btn.submit=this._btn.edit)}this._mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valid",{get:function(){return this._valid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._item},enumerable:!0,configurable:!0}),e.prototype.onSubmit=function(e){e.preventDefault(),e.stopPropagation(),this.liveValidate||this.validator(),this.valid&&this.formSubmit.emit(this.value)},e.prototype.coverProperty=function(){var p=this,c="horizontal"===this.layout,e=r.deepCopy(this.schema),h=e.definitions,d=function(o,a,s,l,u){Object.keys(o.properties).forEach(function(e){var t="$"+e,n=_(o.properties[e],h),i=Object.assign({widget:n.type},n.format&&v[n.format],"string"==typeof n.ui?{widget:n.ui}:null,!n.ui&&Array.isArray(n["enum"])&&0<n["enum"].length?{widget:"select"}:null,p._defUi,n.ui,s[t]);if(c?l.spanLabelFixed?i.spanLabelFixed||(i.spanLabelFixed=l.spanLabelFixed):(i.spanLabel||(i.spanLabel="undefined"==typeof l.spanLabel?5:l.spanLabel),i.spanControl||(i.spanControl="undefined"==typeof l.spanControl?19:l.spanControl),i.offsetControl||(i.offsetControl="undefined"==typeof l.offsetControl?null:l.offsetControl)):(i.spanLabel=null,i.spanControl=null,i.offsetControl=null),"date"===i.widget&&null!=i.end&&a){var r=a.properties[i.end];r?r.ui=Object.assign({},r.ui,{hidden:!0}):i.end=""}i.hidden="boolean"==typeof i.hidden&&i.hidden,u[t]=i,delete n.ui,n.items&&(u[t].$items=u[t].$items||{},d(n.items,n.items,(s[t]||{}).$items||{},i,u[t].$items)),n.properties&&Object.keys(n.properties).length&&d(n,o,s[t]||{},i,u[t])})},o=function(i,r){Object.keys(i.properties).forEach(function(e){var t=i.properties[e],n="$"+e;O(t,r[n]),t.items&&o(t.items,r[n].$items),t.properties&&o(t,r[n])})};null==this.ui&&(this.ui={}),this._defUi=Object.assign({onlyVisual:this.options.onlyVisual,size:this.options.size,liveValidate:this.liveValidate,firstVisual:this.firstVisual},this.options.ui,e.ui,this.ui["*"]),this._ui=Object.assign({},this._defUi),d(e,e,this.ui,this.ui,this._ui),O(e,this._ui),o(e,this._ui),this._schema=e,this._ui.debug&&x("cover schema & ui",this._ui,e)},e.prototype.coverButtonProperty=function(){this._btn=Object.assign({render:{}},this.locale,this.options.button,this.button);var e=Object.keys(this._ui).find(function(e){return e.startsWith("$")});if("horizontal"===this.layout){var t=e?this._ui[e]:this._defUi;this._btn.render.grid||(this._btn.render.grid={offset:t.spanLabel,span:t.spanControl}),this._btn.render.spanLabelFixed||(this._btn.render.spanLabelFixed=t.spanLabelFixed),!this._btn.render["class"]&&"number"==typeof t.spanLabelFixed&&0<t.spanLabelFixed&&(this._btn.render["class"]="text-center")}else this._btn.render.grid={};this._mode&&(this.mode=this._mode),this._ui.debug&&x("button property",this._btn)},e.prototype.ngOnInit=function(){this._inited=!0,this.validator()},e.prototype.ngOnChanges=function(){this.refreshSchema()},e.prototype._addTpl=function(e,t){this.rootProperty.searchProperty(e)?this._renders.has(e)?console.warn("已经存在相同自定义路径："+e):(this._renders.set(e,t),this.rootProperty.searchProperty(e).ui._render=t):console.warn("未找到路径："+e)},e.prototype.attachCustomRender=function(){var i=this;this._renders.forEach(function(e,t){var n=i.rootProperty.searchProperty(t).ui;n._render||(n._render=e)})},e.prototype.validator=function(){this.rootProperty._runValidation();var e=this.rootProperty.errors;this._valid=!(e&&e.length),this._valid||this.formError.emit(e),this.cd.detectChanges()},e.prototype.refreshSchema=function(e,t){var n=this;if(e&&(this.schema=e),t&&(this.ui=t),!this.schema||"undefined"==typeof this.schema.properties)throw new Error("Invalid Schema");if(this.schema.ui&&"string"==typeof this.schema.ui)throw new Error("Don't support string with root ui property");this.schema.type="object",this._formData=f({},this.formData),this._inited&&this.terminator.destroy(),this.coverProperty(),this.coverButtonProperty(),this.rootProperty=this.formPropertyFactory.createProperty(this._schema,this._ui,this.formData),this.attachCustomRender(),this.rootProperty.valueChanges.subscribe(function(e){n._item=Object.assign({},n.formData,e),n.formChange.emit(n._item)}),this.rootProperty.errorsChanges.subscribe(function(e){n._valid=!(e&&e.length),n.formError.emit(e),n.cd.detectChanges()}),this.reset()},e.prototype.reset=function(e){var t=this;void 0===e&&(e=!1),this.rootProperty.resetValue(this.formData,!1),Promise.resolve().then(function(){return t.cd.detectChanges()}),e&&this.formReset.emit(this.value)},e.prototype.ngOnDestroy=function(){this.terminator.destroy(),this.i18n$.unsubscribe()},e.decorators=[{type:a.Component,args:[{selector:"sf, [sf]",template:'<ng-template #con>\n  <ng-content></ng-content>\n</ng-template>\n<form nz-form [nzLayout]="layout" (submit)="onSubmit($event)" [attr.autocomplete]="autocomplete">\n  <sf-item [formProperty]="rootProperty"></sf-item>\n  <ng-container *ngIf="button !== \'none\'; else con">\n    <nz-form-item [ngClass]="_btn.render.class" class="sf-btns" [fixed-label]="_btn.render.spanLabelFixed">\n      <nz-col class="ant-form-item-control-wrapper" [nzSpan]="_btn.render.grid.span" [nzOffset]="_btn.render.grid.offset"\n              [nzXs]="_btn.render.grid.xs" [nzSm]="_btn.render.grid.sm" [nzMd]="_btn.render.grid.md"\n              [nzLg]="_btn.render.grid.lg" [nzXl]="_btn.render.grid.xl">\n        <div class="ant-form-item-control">\n          <ng-container *ngIf="button; else con">\n            <button type="submit" nz-button [nzType]="_btn.submit_type" [disabled]="liveValidate && !valid">{{_btn.submit}}</button>\n            <button *ngIf="_btn.reset" (click)="reset(true)" type="button" nz-button [nzType]="_btn.reset_type">{{_btn.reset}}</button>\n          </ng-container>\n        </div>\n      </nz-col>\n    </nz-form-item>\n  </ng-container>\n</form>\n',preserveWhitespaces:!1,providers:[H,{provide:W,useFactory:q,deps:[$,c]},E],host:{"[class.sf]":"true","[class.sf-search]":"mode === 'search'","[class.sf-edit]":"mode === 'edit'"},changeDetection:a.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:W},{type:E},{type:c},{type:a.ChangeDetectorRef},{type:t.DelonLocaleService}]},e.propDecorators={layout:[{type:a.Input}],schema:[{type:a.Input}],ui:[{type:a.Input}],formData:[{type:a.Input}],button:[{type:a.Input}],liveValidate:[{type:a.Input}],autocomplete:[{type:a.Input}],firstVisual:[{type:a.Input}],mode:[{type:a.Input}],formChange:[{type:a.Output}],formSubmit:[{type:a.Output}],formReset:[{type:a.Output}],formError:[{type:a.Output}]},m([r.InputBoolean(),y("design:type",Object)],e.prototype,"liveValidate",void 0),m([r.InputBoolean(),y("design:type",Object)],e.prototype,"firstVisual",void 0),e}(),U=0,B=function(){function e(e,t){this.widgetFactory=e,this.terminator=t,this.widget=null}return e.prototype.onWidgetInstanciated=function(e){this.widget=e;var t="_sf-"+U++,n=this.formProperty.ui;this.widget.formProperty=this.formProperty,this.widget.schema=this.formProperty.schema,this.widget.ui=n,this.widget.id=t,this.widget.firstVisual=n.firstVisual,this.formProperty.widget=e},e.prototype.ngOnInit=function(){var e=this;this.terminator.onDestroy.subscribe(function(){e.ngOnDestroy()})},e.prototype.ngOnChanges=function(){this.ref=this.widgetFactory.createWidget(this.container,this.formProperty.ui.widget||this.formProperty.schema.type),this.onWidgetInstanciated(this.ref.instance)},e.prototype.ngOnDestroy=function(){this.formProperty.ui.__destroy=!0,this.ref.destroy()},e.decorators=[{type:a.Component,args:[{selector:"sf-item",template:"<ng-template #target></ng-template>"}]}],e.ctorParameters=function(){return[{type:H},{type:E}]},e.propDecorators={formProperty:[{type:a.Input}],container:[{type:a.ViewChild,args:["target",{read:a.ViewContainerRef}]}]},e}(),G=function(){function e(e,t){this.render=t,this._inited=!1,this.el=e.nativeElement}return e.prototype.init=function(){if(this._inited&&null!=this.num&&!(this.num<=0)){var e=this.el.querySelector(".ant-row")||this.el;this.render.addClass(e,"sf-fixed");var t=e.querySelector(".ant-form-item-label"),n=this.num+"px";if(t)this.render.setStyle(t,"width",n),this.render.setStyle(t,"flex","0 0 "+n);else{var i=e.querySelector(".ant-form-item-control-wrapper");this.render.setStyle(i,"margin-left",n)}}},e.prototype.ngAfterViewInit=function(){this._inited=!0,this.init()},e.prototype.ngOnChanges=function(){this._inited&&this.init()},e.decorators=[{type:a.Directive,args:[{selector:"[fixed-label]"}]}],e.ctorParameters=function(){return[{type:a.ElementRef},{type:a.Renderer2}]},e.propDecorators={num:[{type:a.Input,args:["fixed-label"]}]},m([r.InputNumber(),y("design:type",Number)],e.prototype,"num",void 0),e}(),K=function(){function e(){}return e.decorators=[{type:a.Component,args:[{selector:"sf-item-wrap",template:'\n  <nz-form-item [style.width.px]="ui.width">\n    <nz-col *ngIf="showTitle" [nzSpan]="ui.spanLabel" class="ant-form-item-label">\n      <label [attr.for]="id" [class.ant-form-item-required]="ui._required">\n        {{ schema.title }}\n        <span class="optional">\n          {{ ui.optional }}\n          <nz-tooltip *ngIf="ui.optionalHelp" [nzTitle]="ui.optionalHelp">\n            <i nz-tooltip class="anticon anticon-question-circle-o"></i>\n          </nz-tooltip>\n        </span>\n      </label>\n    </nz-col>\n    <nz-col class="ant-form-item-control-wrapper" [nzSpan]="ui.spanControl" [nzOffset]="ui.offsetControl">\n      <div class="ant-form-item-control" [class.has-error]="showError">\n        <ng-content></ng-content>\n        <nz-form-extra *ngIf="schema.description" [innerHTML]="schema.description"></nz-form-extra>\n        <nz-form-explain *ngIf="!ui.onlyVisual && showError">{{error}}</nz-form-explain>\n      </div>\n    </nz-col>\n  </nz-form-item>'}]}],e.propDecorators={id:[{type:a.Input}],schema:[{type:a.Input}],ui:[{type:a.Input}],showError:[{type:a.Input}],error:[{type:a.Input}],showTitle:[{type:a.Input}]},e}(),X=function(){function e(e,t){this.templateRef=e,this.table=t}return e.prototype.ngOnInit=function(){this.table._addTpl(this.path.startsWith("/")?this.path:"/"+this.path,this.templateRef)},e.decorators=[{type:a.Directive,args:[{selector:"[sf-template]"}]}],e.ctorParameters=function(){return[{type:a.TemplateRef},{type:Y}]},e.propDecorators={path:[{type:a.Input,args:["sf-template"]}]},e}(),Z=function(){function e(e,t){this.cd=e,this.sfComp=t,this.showError=!1,this.id="",this.firstVisual=!1}return Object.defineProperty(e.prototype,"cls",{get:function(){return this.ui["class"]||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return!0===this.schema.readOnly||null},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var t=this;this.formProperty.errorsChanges.pipe(u.filter(function(e){return null!=e})).subscribe(function(e){t.ui.debug&&x("errorsChanges",t.formProperty.path,e),t.firstVisual&&(t.showError=0<e.length,t.error=t.showError?e[0].message:"",!0!==t.ui.__destroy&&t.cd.detectChanges()),t.firstVisual=!0})},e.prototype.setValue=function(e){this.formProperty.setValue(e,!1),this.ui.debug&&x("valueChanges",this.formProperty.path,this.formProperty)},Object.defineProperty(e.prototype,"value",{get:function(){return this.formProperty.value},enumerable:!0,configurable:!0}),e.prototype.detectChanges=function(){this.cd.detectChanges(),this.formProperty.root.widget.cd.markForCheck()},e.ctorParameters=function(){return[{type:a.ChangeDetectorRef,decorators:[{type:a.Inject,args:[a.ChangeDetectorRef]}]},{type:Y,decorators:[{type:a.Inject,args:[Y]}]}]},e.propDecorators={cls:[{type:a.HostBinding,args:["class"]}]},e}(),J=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.reset=function(e){},t}(Z),Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.reset=function(e){},t.prototype.ngAfterViewInit=function(){var e=this;this.formProperty.errorsChanges.subscribe(function(){return e.cd.detectChanges()})},t}(Z),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.reset=function(e){},t.prototype.ngAfterViewInit=function(){var e=this;this.formProperty.errorsChanges.subscribe(function(){return e.cd.detectChanges()})},t}(Z),te=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.list=[],e}return d(e,t),e.prototype.ngOnInit=function(){var e,t;this.grid=this.ui.grid;var n=[];try{for(var i=g(this.formProperty.propertiesId),r=i.next();!r.done;r=i.next()){var o=r.value,a=this.formProperty.properties[o],s={property:a,grid:a.ui.grid||this.grid||{},spanLabelFixed:a.ui.spanLabelFixed,show:!1===a.ui.hidden};n.push(s)}}catch(l){e={error:l}}finally{try{r&&!r.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}this.list=n},e.decorators=[{type:a.Component,args:[{selector:"sf-object",template:'\n  <ng-container *ngIf="grid; else noGrid">\n    <nz-row [nzGutter]="grid.gutter">\n      <ng-container *ngFor="let i of list">\n        <ng-container *ngIf="i.property.visible && i.show">\n          <nz-col\n            [nzSpan]="i.grid.span" [nzOffset]="i.grid.offset"\n            [nzXs]="i.grid.xs" [nzSm]="i.grid.sm" [nzMd]="i.grid.md"\n            [nzLg]="i.grid.lg" [nzXl]="i.grid.xl" [nzXXl]="i.grid.xxl">\n            <sf-item [formProperty]="i.property" [fixed-label]="i.spanLabelFixed"></sf-item>\n          </nz-col>\n        </ng-container>\n      </ng-container>\n    </nz-row>\n  </ng-container>\n  <ng-template #noGrid>\n    <ng-container *ngFor="let i of list">\n      <ng-container *ngIf="i.property.visible && i.show">\n        <sf-item [formProperty]="i.property" [fixed-label]="i.spanLabelFixed"></sf-item>\n      </ng-container>\n    </ng-container>\n  </ng-template>',preserveWhitespaces:!1}]}],e}(ee),ne=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arraySpan=8,e}return d(e,t),Object.defineProperty(e.prototype,"addDisabled",{get:function(){return this.schema.maxItems&&this.formProperty.properties.length>=this.schema.maxItems},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.ui.grid&&this.ui.grid.arraySpan&&(this.arraySpan=this.ui.grid.arraySpan),this.addTitle=this.ui.addTitle||"添加",this.addType=this.ui.addType||"dashed",this.removeTitle=!1===this.ui.removable?null:this.ui.removeTitle||"移除"},e.prototype.addItem=function(){this.formProperty.add(null)},e.prototype.removeItem=function(e){this.formProperty.remove(e)},e.decorators=[{type:a.Component,args:[{selector:"sf-array",template:'\n  <nz-form-item>\n    <nz-col *ngIf="schema.title" [nzSpan]="ui.spanLabel" class="ant-form-item-label">\n      <label>\n        {{ schema.title }}\n        <span class="optional">\n          {{ ui.optional }}\n          <nz-tooltip *ngIf="ui.optionalHelp" [nzTitle]="ui.optionalHelp">\n            <i nz-tooltip class="anticon anticon-question-circle-o"></i>\n          </nz-tooltip>\n        </span>\n      </label>\n      <div class="add">\n        <button nz-button [nzType]="addType" [disabled]="addDisabled" (click)="addItem()" [innerHTML]="addTitle"></button>\n      </div>\n    </nz-col>\n    <nz-col class="ant-form-item-control-wrapper" [nzSpan]="ui.spanControl" [nzOffset]="ui.offsetControl">\n      <div class="ant-form-item-control" [class.has-error]="showError">\n\n        <nz-row class="sf-array-container">\n          <ng-container *ngFor="let i of formProperty.properties; let idx=index">\n            <nz-col *ngIf="i.visible && !i.ui.hidden" [nzSpan]="arraySpan" [attr.data-index]="idx" class="sf-array-item">\n              <nz-card>\n                <sf-item [formProperty]="i"></sf-item>\n                <span *ngIf="removeTitle" class="remove" (click)="removeItem(idx)" [attr.title]="removeTitle">\n                  <i class="anticon anticon-delete"></i>\n                </span>\n              </nz-card>\n            </nz-col>\n          </ng-container>\n        </nz-row>\n\n        <nz-form-extra *ngIf="schema.description" [innerHTML]="schema.description"></nz-form-extra>\n        <nz-form-explain *ngIf="!ui.onlyVisual && showError">{{error}}</nz-form-explain>\n\n      </div>\n    </nz-col>\n  </nz-form-item>\n  '}]}],e}(Q),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.ngOnInit=function(){this.type=this.ui.addOnAfter||this.ui.addOnBefore||this.ui.addOnAfterIcon||this.ui.addOnBeforeIcon||this.ui.prefix||this.ui.prefixIcon||this.ui.suffix||this.ui.suffixIcon?"addon":""},t.decorators=[{type:a.Component,args:[{selector:"sf-string",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <ng-template #ipt>\n      <input nz-input\n        [attr.id]="id"\n        [disabled]="disabled"\n        [attr.disabled]="disabled"\n        [nzSize]="ui.size"\n        [ngModel]="value"\n        (ngModelChange)="setValue($event)"\n        [attr.maxLength]="schema.maxLength || null"\n        [attr.type]="ui.type || \'text\'"\n        [attr.placeholder]="ui.placeholder"\n        [attr.autocomplete]="ui.autocomplete"\n        [attr.autoFocus]="ui.autofocus">\n    </ng-template>\n\n    <ng-container *ngIf="type === \'addon\'; else ipt">\n      <nz-input-group\n        [nzAddOnBefore]="ui.addOnBefore" [nzAddOnAfter]="ui.addOnAfter"\n        [nzAddOnBeforeIcon]="ui.addOnBeforeIcon" [nzAddOnAfterIcon]="ui.addOnAfterIcon"\n        [nzPrefix]="ui.prefix" [nzPrefixIcon]="ui.prefixIcon"\n        [nzSuffix]="ui.suffix" [nzSuffixIcon]="ui.suffixIcon">\n        <ng-template [ngTemplateOutlet]="ipt"></ng-template>\n      </nz-input-group>\n    </ng-container>\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],t}(J),re=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.formatter=function(e){return e},e.parser=function(e){return e},e}return d(e,t),e.prototype.ngOnInit=function(){var e=this.schema,t=this.ui;"undefined"!=typeof e.minimum&&(this.min=e.exclusiveMinimum?e.minimum+1:e.minimum),"undefined"!=typeof e.maximum&&(this.max=e.exclusiveMaximum?e.maximum-1:e.maximum),this.step=e.multipleOf||1,"integer"===e.type&&(this.min=Math.trunc(this.min),this.max=Math.trunc(this.max),this.step=Math.trunc(this.step)),null!=t.prefix&&(t.formatter=function(e){return t.prefix+" "+e},t.parser=function(e){return e.replace(t.prefix+" ","")}),null!=t.unit&&(t.formatter=function(e){return e+" "+t.unit},t.parser=function(e){return e.replace(" "+t.unit,"")}),t.formatter&&(this.formatter=t.formatter),t.parser&&(this.parser=t.parser)},e.decorators=[{type:a.Component,args:[{selector:"sf-number",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n    <nz-input-number\n      [ngModel]="value"\n      (ngModelChange)="setValue($event)"\n      [nzDisabled]="disabled"\n      [nzSize]="ui.size"\n      [nzMin]="min"\n      [nzMax]="max"\n      [nzStep]="step"\n      [nzFormatter]="formatter"\n      [nzParser]="parser"\n      [nzPrecision]="ui.precision"\n      [nzPlaceHolder]="ui.placeholder || \'\'">\n    </nz-input-number>\n  </sf-item-wrap>',preserveWhitespaces:!1}]}],e}(J),oe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displayValue=null,e.flatRange=!1,e}return d(e,t),e.prototype.ngOnInit=function(){var e=this.ui;if(this.mode=e.mode||"date",this.flatRange=null!=e.end,this.flatRange&&(this.mode="range"),e.displayFormat)this.displayFormat=e.displayFormat;else switch(this.mode){case"month":this.displayFormat="yyyy-MM";break;case"week":this.displayFormat="yyyy-ww"}this.format=e.format?e.format:"number"===this.schema.type?"x":"YYYY-MM-DD HH:mm:ss",this.i={allowClear:C(e.allowClear,!0),showToday:C(e.showToday,!0)}},e.prototype.reset=function(e){e=this.toDate(e),this.flatRange?this.displayValue=null==e?[]:[e,this.toDate(this.endProperty.formData)]:this.displayValue=e},e.prototype._change=function(e){var t=this;if(null==e)return this.setValue(null),void this.setEnd(null);var n=Array.isArray(e)?e.map(function(e){return i(e,t.format)}):i(e,this.format);this.flatRange?(this.setEnd(n[1]),this.setValue(n[0])):this.setValue(n)},e.prototype._openChange=function(e){this.ui.onOpenChange&&this.ui.onOpenChange(e)},e.prototype._ok=function(e){this.ui.onOk&&this.ui.onOk(e)},Object.defineProperty(e.prototype,"endProperty",{get:function(){return this.formProperty.parent.properties[this.ui.end]},enumerable:!0,configurable:!0}),e.prototype.setEnd=function(e){this.endProperty.setValue(e,!0)},e.prototype.toDate=function(e){return("number"==typeof e||"string"==typeof e&&!isNaN(+e))&&(e=new Date(+e)),e},e.decorators=[{type:a.Component,args:[{selector:"sf-date",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n    <ng-container [ngSwitch]="mode">\n\n      <nz-month-picker *ngSwitchCase="\'month\'"\n        [nzDisabled]="disabled"\n        [nzSize]="ui.size"\n        [nzFormat]="displayFormat"\n        [(ngModel)]="displayValue"\n        (ngModelChange)="_change($event)"\n        [nzAllowClear]="i.allowClear"\n        [nzClassName]="ui.className"\n        [nzDisabledDate]="ui.disabledDate"\n        [nzLocale]="ui.locale"\n        [nzPlaceHolder]="ui.placeholder"\n        [nzPopupStyle]="ui.popupStyle"\n        [nzDropdownClassName]="ui.dropdownClassName"\n        (nzOnOpenChange)="_openChange($event)"\n        [nzRenderExtraFooter]="ui.renderExtraFooter"\n      ></nz-month-picker>\n\n      <nz-week-picker *ngSwitchCase="\'week\'"\n        [nzDisabled]="disabled"\n        [nzSize]="ui.size"\n        [nzFormat]="displayFormat"\n        [(ngModel)]="displayValue"\n        (ngModelChange)="_change($event)"\n        [nzAllowClear]="i.allowClear"\n        [nzClassName]="ui.className"\n        [nzDisabledDate]="ui.disabledDate"\n        [nzLocale]="ui.locale"\n        [nzPlaceHolder]="ui.placeholder"\n        [nzPopupStyle]="ui.popupStyle"\n        [nzDropdownClassName]="ui.dropdownClassName"\n        (nzOnOpenChange)="_openChange($event)"\n      ></nz-week-picker>\n\n      <nz-range-picker *ngSwitchCase="\'range\'"\n        [nzDisabled]="disabled"\n        [nzSize]="ui.size"\n        [nzFormat]="displayFormat"\n        [(ngModel)]="displayValue"\n        (ngModelChange)="_change($event)"\n        [nzAllowClear]="i.allowClear"\n        [nzClassName]="ui.className"\n        [nzDisabledDate]="ui.disabledDate"\n        [nzLocale]="ui.locale"\n        [nzPlaceHolder]="ui.placeholder"\n        [nzPopupStyle]="ui.popupStyle"\n        [nzDropdownClassName]="ui.dropdownClassName"\n        (nzOnOpenChange)="_openChange($event)"\n        [nzDisabledTime]="ui.disabledTime"\n        [nzRenderExtraFooter]="ui.renderExtraFooter"\n        [nzRanges]="ui.ranges"\n        (nzOnOk)="_ok($event)"\n      ></nz-range-picker>\n\n      <nz-date-picker *ngSwitchDefault\n        [nzDisabled]="disabled"\n        [nzSize]="ui.size"\n        [nzFormat]="displayFormat"\n        [(ngModel)]="displayValue"\n        (ngModelChange)="_change($event)"\n        [nzAllowClear]="i.allowClear"\n        [nzClassName]="ui.className"\n        [nzDisabledDate]="ui.disabledDate"\n        [nzLocale]="ui.locale"\n        [nzPlaceHolder]="ui.placeholder"\n        [nzPopupStyle]="ui.popupStyle"\n        [nzDropdownClassName]="ui.dropdownClassName"\n        (nzOnOpenChange)="_openChange($event)"\n        [nzDisabledTime]="ui.disabledTime"\n        [nzRenderExtraFooter]="ui.renderExtraFooter"\n        [nzShowTime]="ui.showTime"\n        [nzShowToday]="i.showToday"\n        (nzOnOk)="_ok($event)"\n      ></nz-date-picker>\n    </ng-container>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e}(J),ae=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displayValue=null,e}return d(e,t),e.prototype.ngOnInit=function(){var e=this.ui;this.format=e.format?e.format:"number"===this.schema.type?"x":"HH:mm:ss",this.i={displayFormat:e.displayFormat||"HH:mm:ss",allowEmpty:C(e.allowEmpty,!0),clearText:e.clearText||"清除",defaultOpenValue:e.defaultOpenValue||new Date,hideDisabledOptions:C(e.hideDisabledOptions,!1),hourStep:e.hourStep||1,minuteStep:e.nzMinuteStep||1,secondStep:e.secondStep||1}},e.prototype.reset=function(e){if(e instanceof Date)this.displayValue=e;else{var t=null!=e&&e.toString().length?new Date(e):null;null!=t&&"Invalid Date"===t.toString()&&(e.toString().split(":").length<=1&&(e+=":00"),t=new Date("1970-1-1 "+e)),this.displayValue=t}},e.prototype._change=function(e){null!=e?!0!==this.ui.utcEpoch?this.setValue(i(e,this.format)):this.setValue(Date.UTC(1970,0,1,e.getHours(),e.getMinutes(),e.getSeconds())):this.setValue(null)},e.decorators=[{type:a.Component,args:[{selector:"sf-time",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-time-picker\n      [(ngModel)]="displayValue"\n      (ngModelChange)="_change($event)"\n      [nzDisabled]="disabled"\n      [nzSize]="ui.size"\n      [nzFormat]="i.displayFormat"\n      [nzAllowEmpty]="i.allowEmpty"\n      [nzClearText]="i.clearText"\n      [nzDefaultOpenValue]="i.defaultOpenValue"\n      [nzDisabledHours]="ui.disabledHours"\n      [nzDisabledMinutes]="ui.disabledMinutes"\n      [nzDisabledSeconds]="ui.disabledSeconds"\n      [nzHideDisabledOptions]="i.hideDisabledOptions"\n      [nzHourStep]="i.hourStep"\n      [nzMinuteStep]="i.minuteStep"\n      [nzSecondStep]="i.secondStep"\n      [nzPopupClassName]="ui.popupClassName"\n      >\n    </nz-time-picker>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e}(J),se=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=[],e}return d(e,t),e.prototype.reset=function(e){var t=this;this.styleType="default"===(this.ui.styleType||"default"),D(this.schema,this.ui,this.formProperty.formData).subscribe(function(e){return t.data=e})},e.decorators=[{type:a.Component,args:[{selector:"sf-radio",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-radio-group\n      [nzDisabled]="disabled"\n      [nzSize]="ui.size"\n      [nzName]="id"\n      [ngModel]="value"\n      (ngModelChange)="setValue($event)">\n      <ng-container *ngIf="styleType">\n        <label *ngFor="let option of data"\n          nz-radio\n          [nzValue]="option.value"\n          [nzDisabled]="option.disabled">\n          <span [innerHTML]="option.label"></span>\n        </label>\n      </ng-container>\n      <ng-container *ngIf="!styleType">\n        <label *ngFor="let option of data"\n          nz-radio-button\n          [nzValue]="option.value"\n          [nzDisabled]="option.disabled">\n          <span [innerHTML]="option.label"></span>\n        </label>\n      </ng-container>\n    </nz-radio-group>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e}(J),le=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=[],e.allChecked=!1,e.indeterminate=!1,e}return d(e,t),e.prototype.reset=function(e){var t=this;D(this.schema,this.ui,this.formProperty.formData).subscribe(function(e){t.data=e,t.label=t.ui.spanLabel,t.control=t.ui.spanControl,0===e.length&&(t.label=null,t.offset=t.ui.spanLabel),t.grid_span=t.ui.span&&0<t.ui.span?t.ui.span:0,t.updateAllChecked()})},e.prototype._setValue=function(e){this.setValue(e),this.detectChanges(),this.notifyChange(e)},e.prototype.notifySet=function(){var e=this.data.filter(function(e){return e.checked});this.updateAllChecked().setValue(e.map(function(e){return e.value})),this.notifyChange(e)},e.prototype.groupInGridChange=function(t){this.data.forEach(function(e){return e.checked=-1!==t.indexOf(e.value)}),this.notifySet()},e.prototype.onAllChecked=function(e){var t=this;e.stopPropagation(),this.data.forEach(function(e){return e.checked=t.allChecked}),this.notifySet()},e.prototype.updateAllChecked=function(){return this.data.every(function(e){return!1===e.checked})?(this.allChecked=!1,this.indeterminate=!1):this.data.every(function(e){return!0===e.checked})?(this.allChecked=!0,this.indeterminate=!1):this.indeterminate=!0,this.detectChanges(),this},e.prototype.notifyChange=function(e){this.ui.change&&this.ui.change(e)},e.decorators=[{type:a.Component,args:[{selector:"sf-checkbox",template:'\n  <ng-template #all>\n    <label *ngIf="ui.checkAll" nz-checkbox class="mr-sm"\n      [(ngModel)]="allChecked"\n      [nzIndeterminate]="indeterminate"\n      (click)="onAllChecked($event)">\n      {{ ui.checkAllText || \'全选\' }}\n    </label>\n  </ng-template>\n  <nz-form-item [style.width.px]="ui.width">\n    <nz-col *ngIf="data.length > 0" [nzSpan]="label" class="ant-form-item-label">\n      <label [attr.for]="id" [class.ant-form-item-required]="ui._required">\n        {{ schema.title }}\n        <span class="optional">\n          {{ ui.optional }}\n          <nz-tooltip *ngIf="ui.optionalHelp" [nzTitle]="ui.optionalHelp">\n            <i nz-tooltip class="anticon anticon-question-circle-o"></i>\n          </nz-tooltip>\n        </span>\n      </label>\n    </nz-col>\n    <nz-col class="ant-form-item-control-wrapper" [nzSpan]="control" [nzOffset]="offset">\n      <div class="ant-form-item-control" [class.has-error]="showError">\n\n          <ng-container *ngIf="data.length === 0">\n            <label nz-checkbox\n              [nzDisabled]="disabled"\n              [ngModel]="value"\n              (ngModelChange)="_setValue($event)">\n              <span [innerHTML]="schema.title"></span>\n              <span class="optional">\n                {{ ui.optional }}\n                <nz-tooltip *ngIf="ui.optionalHelp" [nzTitle]="ui.optionalHelp">\n                  <i nz-tooltip class="anticon anticon-question-circle-o"></i>\n                </nz-tooltip>\n              </span>\n            </label>\n          </ng-container>\n          <ng-container *ngIf="data.length > 0">\n            <ng-container *ngIf="grid_span === 0">\n              <ng-template [ngTemplateOutlet]="all"></ng-template>\n              <nz-checkbox-group [ngModel]="data" (ngModelChange)="notifySet()"></nz-checkbox-group>\n            </ng-container>\n            <ng-container *ngIf="grid_span !== 0">\n              <nz-checkbox-wrapper class="checkbox-grid-list" (nzOnChange)="groupInGridChange($event)">\n                <nz-row>\n                  <nz-col [nzSpan]="grid_span" *ngIf="ui.checkAll">\n                    <ng-template [ngTemplateOutlet]="all"></ng-template>\n                  </nz-col>\n                  <nz-col [nzSpan]="grid_span" *ngFor="let i of data">\n                    <label nz-checkbox [nzValue]="i.value" [ngModel]="i.checked" [nzDisabled]="i.disabled">{{i.label}}</label>\n                  </nz-col>\n                </nz-row>\n              </nz-checkbox-wrapper>\n            </ng-container>\n          </ng-container>\n\n          <nz-form-extra *ngIf="schema.description" [innerHTML]="schema.description"></nz-form-extra>\n          <nz-form-explain *ngIf="!ui.onlyVisual && showError">{{error}}</nz-form-explain>\n      </div>\n    </nz-col>\n  </nz-form-item>\n  ',preserveWhitespaces:!1}]}],e}(J),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.decorators=[{type:a.Component,args:[{selector:"sf-boolean",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n    <nz-switch\n      [ngModel]="value"\n      (ngModelChange)="setValue($event)"\n      [nzDisabled]="disabled"\n      [nzSize]="ui.size"\n      [nzCheckedChildren]="ui.checkedChildren"\n      [nzUnCheckedChildren]="ui.unCheckedChildren">\n    </nz-switch>\n  </sf-item-wrap>',preserveWhitespaces:!1}]}],t}(J),pe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.autosize=!0,e}return d(e,t),e.prototype.ngOnInit=function(){null!=this.ui.autosize&&(this.autosize=this.ui.autosize)},e.decorators=[{type:a.Component,args:[{selector:"sf-textarea",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <textarea nz-input\n      [attr.id]="id"\n      [disabled]="disabled"\n      [attr.disabled]="disabled"\n      [nzSize]="ui.size"\n      [ngModel]="value"\n      (ngModelChange)="setValue($event)"\n      [attr.maxLength]="schema.maxLength || null"\n      [attr.placeholder]="ui.placeholder"\n      [nzAutosize]="autosize">\n    </textarea>\n\n  </sf-item-wrap>',preserveWhitespaces:!1}]}],e}(J),ce=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasGroup=!1,e}return d(e,t),e.prototype.ngOnInit=function(){this.i={allowClear:this.ui.allowClear,autoFocus:C(this.ui.autoFocus,!1),dropdownClassName:this.ui.dropdownClassName||null,dropdownMatchSelectWidth:C(this.ui.dropdownMatchSelectWidth,!0),serverSearch:C(this.ui.serverSearch,!1),maxMultipleCount:this.ui.maxMultipleCount||Infinity,mode:this.ui.mode||"default",notFoundContent:this.ui.notFoundContent||"无法找到",showSearch:C(this.ui.showSearch,!0)}},e.prototype.reset=function(e){var t=this;D(this.schema,this.ui,this.formProperty.formData).subscribe(function(e){t.data=e,t.hasGroup=0<e.filter(function(e){return!0===e.group}).length,t.detectChanges()})},e.prototype.change=function(e){this.ui.change&&this.ui.change(e),this.setValue(e)},e.prototype.openChange=function(e){this.ui.openChange&&this.ui.openChange(e)},e.prototype.searchChange=function(e){var t=this;this.ui.onSearch?this.ui.onSearch(e).then(function(e){t.data=e,t.detectChanges()}):this.detectChanges()},e.prototype.scrollToBottom=function(e){this.ui.scrollToBottom&&this.ui.scrollToBottom(e)},e.decorators=[{type:a.Component,args:[{selector:"sf-select",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-select\n      [nzDisabled]="disabled"\n      [nzSize]="ui.size"\n      [ngModel]="value"\n      (ngModelChange)="change($event)"\n      [nzPlaceHolder]="ui.placeholder"\n      [nzAllowClear]="i.allowClear"\n      [nzAutoFocus]="i.autoFocus"\n      [nzDropdownClassName]="i.dropdownClassName"\n      [nzDropdownMatchSelectWidth]="i.dropdownMatchSelectWidth"\n      [nzServerSearch]="i.serverSearch"\n      [nzMaxMultipleCount]="i.maxMultipleCount"\n      [nzMode]="i.mode"\n      [nzNotFoundContent]="i.notFoundContent"\n      [nzShowSearch]="i.showSearch"\n      (nzOpenChange)="openChange($event)"\n      (nzOnSearch)="searchChange($event)"\n      (nzScrollToBottom)="scrollToBottom($event)">\n      <ng-container *ngIf="!hasGroup">\n        <nz-option\n          *ngFor="let o of data"\n          [nzLabel]="o.label"\n          [nzValue]="o.value"\n          [nzDisabled]="o.disabled">\n        </nz-option>\n      </ng-container>\n      <ng-container *ngIf="hasGroup">\n        <nz-option-group *ngFor="let i of data" [nzLabel]="i.label">\n          <nz-option\n            *ngFor="let o of i.children"\n            [nzLabel]="o.label"\n            [nzValue]="o.value"\n            [nzDisabled]="o.disabled">\n          </nz-option>\n        </nz-option-group>\n      </ng-container>\n    </nz-select>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e}(J),he=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=[],e}return d(e,t),e.prototype.dc=function(){var t=this;return new Promise(function(e){setTimeout(function(){t.detectChanges(),e()},101)})},e.prototype.tranData=function(e){return e.map(function(e){return new n.NzTreeNode(r.deepCopy(e))})},e.prototype.ngOnInit=function(){var e=this.ui;this.i={allowClear:e.allowClear,showSearch:C(e.showSearch,!1),dropdownMatchSelectWidth:C(e.dropdownMatchSelectWidth,!0),multiple:C(e.multiple,!1),checkable:C(e.checkable,!1),showExpand:C(e.showExpand,!0),showLine:C(e.showLine,!1),asyncData:"function"==typeof e.expandChange,defaultExpandAll:C(e.defaultExpandAll,!1),displayWith:e.displayWith||function(e){return e.title}}},e.prototype.reset=function(e){var t=this;D(this.schema,this.ui,this.formProperty.formData).pipe(u.map(function(e){return t.tranData(e)})).subscribe(function(e){t.data=e,t.dc()})},e.prototype.change=function(e){this.ui.change&&this.ui.change(e),this.setValue(e)},e.prototype.expandChange=function(t){var n=this,e=this.ui;"function"==typeof e.expandChange&&e.expandChange(t).pipe(u.map(function(e){return n.tranData(e)})).subscribe(function(e){t.node.addChildren(e),n.dc()})},e.decorators=[{type:a.Component,args:[{selector:"sf-tree-select",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n    <nz-tree-select\n      [nzAllowClear]="i.allowClear"\n      [nzPlaceHolder]="ui.placeholder"\n      [nzDisabled]="disabled"\n      [nzShowSearch]="i.showSearch"\n      [nzDropdownMatchSelectWidth]="i.dropdownMatchSelectWidth"\n      [nzDropdownStyle]="ui.dropdownStyle"\n      [nzMultiple]="i.multiple"\n      [nzSize]="ui.size"\n      [nzCheckable]="i.checkable"\n      [nzShowExpand]="i.showExpand"\n      [nzShowLine]="i.showLine"\n      [nzAsyncData]="i.asyncData"\n      [nzNodes]="data"\n      [nzDefaultExpandAll]="i.defaultExpandAll"\n      [nzDefaultExpandedKeys]="ui.defaultExpandedKeys"\n      [nzDisplayWith]="i.displayWith"\n      [ngModel]="value"\n      (ngModelChange)="change($event)"\n      (nzExpandChange)="expandChange($event)">\n    </nz-tree-select>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e}(J),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.reset=function(e){var t=this;D(this.schema,this.ui,this.formProperty.formData).subscribe(function(e){t.data=e,t.detectChanges()})},t.prototype.onChange=function(e){e.checked=!e.checked,this.updateValue(),this.ui.checkedChange&&this.ui.checkedChange(e.checked)},t.prototype._afterClose=function(){this.ui.afterClose&&this.ui.afterClose()},t.prototype._close=function(e){this.ui.onClose&&this.ui.onClose(e)},t.prototype.updateValue=function(){this.formProperty.setValue(this.data.filter(function(e){return e.checked}).map(function(e){return e.value}),!1)},t.decorators=[{type:a.Component,args:[{selector:"sf-tag",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-tag\n      *ngFor="let i of data"\n      nzMode="checkable"\n      [nzChecked]="i.checked"\n      (nzAfterClose)="_afterClose()"\n      (nzOnClose)="_close($event)"\n      (nzCheckedChange)="onChange(i)">\n      {{i.label}}\n    </nz-tag>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],t}(J),fe=function(i){function e(e,t){var n=i.call(this,e)||this;return n.modalSrv=t,n.fileList=[],n.btnType="",n.handlePreview=function(e){n.modalSrv.create({nzContent:'<img src="'+(e.url||e.thumbUrl)+'" class="img-fluid" />',nzFooter:null}).afterClose.subscribe(function(){return n.detectChanges()})},n}return d(e,i),e.prototype.ngOnInit=function(){this.i={type:this.ui.type||"select",text:this.ui.text||"点击上传",action:this.ui.action||"",accept:this.ui.accept||"",limit:null==this.ui.limit?0:+this.ui.limit,size:null==this.ui.size?0:+this.ui.size,fileType:this.ui.fileType||"",listType:this.ui.listType||"text",multiple:C(this.ui.multiple,!1),name:this.ui.name||"file",showUploadList:C(this.ui.showUploadList,!0),withCredentials:C(this.ui.withCredentials,!1),resReName:(this.ui.resReName||"").split(".")},"picture-card"===this.i.listType&&(this.btnType="plus"),"drag"===this.i.type&&(this.i.listType=null,this.btnType="drag",this.i.text=this.ui.text||"单击或拖动文件到该区域上传",this.i.hint=this.ui.hint||"支持单个或批量，严禁上传公司数据或其他安全文件")},e.prototype.change=function(e){this.ui.change&&this.ui.change(e),"success"===e.type&&this.notify(e.fileList)},e.prototype.reset=function(e){var t=this;D(this.schema,this.ui,this.formProperty.formData).subscribe(function(e){t.fileList=e,t.notify(t.fileList),t.detectChanges()})},e.prototype.notify=function(e){var t=this,n=e.map(function(e){return r.deepGet(e.response,t.i.resReName,e.response)});this.formProperty.setValue(!0===this.i.multiple?n:n.pop(),!1)},e.decorators=[{type:a.Component,args:[{selector:"sf-upload",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-upload\n      [nzType]="i.type"\n      [nzFileList]="fileList"\n      [nzDisabled]="disabled"\n      [nzAction]="i.action"\n      [nzAccept]="i.accept"\n      [nzLimit]="i.limit"\n      [nzSize]="i.size"\n      [nzFileType]="i.fileType"\n      [nzHeaders]="ui.headers"\n      [nzData]="ui.data"\n      [nzListType]="i.listType"\n      [nzMultiple]="i.multiple"\n      [nzName]="i.name"\n      [nzShowUploadList]="i.showUploadList"\n      [nzWithCredentials]="i.withCredentials"\n      [nzRemove]="ui.remove"\n      [nzPreview]="handlePreview"\n      (nzChange)="change($event)">\n      <ng-container [ngSwitch]="btnType">\n        <ng-container *ngSwitchCase="\'plus\'">\n          <i class="anticon anticon-plus"></i>\n          <div class="ant-upload-text" [innerHTML]="i.text"></div>\n        </ng-container>\n        <ng-container *ngSwitchCase="\'drag\'">\n          <p class="ant-upload-drag-icon"><i class="anticon anticon-inbox"></i></p>\n          <p class="ant-upload-text" [innerHTML]="i.text"></p>\n          <p class="ant-upload-hint" [innerHTML]="i.hint"></p>\n        </ng-container>\n        <ng-container *ngSwitchDefault>\n          <button type="button" nz-button>\n            <i class="anticon anticon-upload"></i><span [innerHTML]="i.text"></span>\n          </button>\n        </ng-container>\n      </ng-container>\n    </nz-upload>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e.ctorParameters=function(){return[{type:a.ChangeDetectorRef},{type:n.NzModalService}]},e}(J),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.list=[],t._data=[],t._canMove=function(e){return t.ui.canMove?t.ui.canMove(e):l.of(e.list)},t}return d(t,e),t.prototype.ngOnInit=function(){this.i={titles:this.ui.titles||["",""],operations:this.ui.operations||["",""],itemUnit:this.ui.itemUnit||"项",itemsUnit:this.ui.itemsUnit||"项"}},t.prototype.reset=function(e){var n=this;D(this.schema,this.ui,null).subscribe(function(e){var t=n.formProperty.formData;Array.isArray(t)||(t=[t]),e.forEach(function(e){~t.indexOf(e.value)&&(e.direction="right")}),n.list=e,n._data=e.filter(function(e){return"right"===e.direction}),n.notify(),n.detectChanges()})},t.prototype.notify=function(){this.formProperty.setValue(this._data.map(function(e){return e.value}),!1)},t.prototype._change=function(t){var e;"right"===t.to?this._data=(e=this._data).concat.apply(e,z(t.list)):this._data=this._data.filter(function(e){return-1===t.list.indexOf(e)}),this.ui.change&&this.ui.change(t),this.notify()},t.prototype._searchChange=function(e){this.ui.searchChange&&this.ui.searchChange(e)},t.prototype._selectChange=function(e){this.ui.selectChange&&this.ui.selectChange(e),this.cd.detectChanges()},t.decorators=[{type:a.Component,args:[{selector:"sf-transfer",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-transfer\n      [nzDataSource]="list"\n      [nzTitles]="i.titles"\n      [nzOperations]="i.operations"\n      [nzListStyle]="ui.listStyle"\n      [nzItemUnit]="i.itemUnit"\n      [nzItemsUnit]="i.itemsUnit"\n      [nzShowSearch]="ui.showSearch"\n      [nzFilterOption]="ui.filterOption"\n      [nzSearchPlaceholder]="ui.searchPlaceholder"\n      [nzNotFoundContent]="ui.notFoundContent"\n      [nzCanMove]="_canMove"\n      (nzChange)="_change($event)"\n      (nzSearchChange)="_searchChange($event)"\n      (nzSelectChange)="_selectChange($event)">\n    </nz-transfer>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],t}(J),ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._formatter=function(e){return t.ui.formatter?t.ui.formatter(e):e},t}return d(t,e),t.prototype.ngOnInit=function(){this.min=this.schema.minimum||0,this.max=this.schema.maximum||100,this.step=this.schema.multipleOf||1,this.marks=this.ui.marks||null;var e=this.ui.included;this.included=void 0===e||e},t.prototype._afterChange=function(e){this.ui.afterChange&&this.ui.afterChange(e)},t.decorators=[{type:a.Component,args:[{selector:"sf-slider",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-slider\n      [ngModel]="value"\n      (ngModelChange)="setValue($event)"\n      [nzDisabled]="disabled"\n      [nzRange]="ui.range"\n      [nzMin]="min"\n      [nzMax]="max"\n      [nzStep]="step"\n      [nzMarks]="marks"\n      [nzDots]="ui.dots"\n      [nzIncluded]="included"\n      [nzVertical]="ui.vertical"\n      [nzTipFormatter]="_formatter"\n      (nzOnAfterChange)="_afterChange($event)">\n    </nz-slider>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],t}(J),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.decorators=[{type:a.Component,args:[{selector:"sf-custom",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <ng-template\n      [ngTemplateOutlet]="$any(ui)._render"\n      [ngTemplateOutletContext]="{$implicit: this, schema: schema, ui: ui }"></ng-template>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],t}(J),be=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasText=!1,e}return d(e,t),e.prototype.ngOnInit=function(){this.count=this.schema.maximum||5,this.allowHalf=.5===(this.schema.multipleOf||.5),this.allowClear=C(this.ui.allowClear,!0),this.autoFocus=C(this.ui.autoFocus,!1),this.hasText=!!this.ui.text},e.prototype.genText=function(){return this.hasText?this.ui.text.replace("{{value}}",this.formProperty.value):""},e.decorators=[{type:a.Component,args:[{selector:"sf-rate",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-rate\n      [nzDisabled]="disabled"\n      [ngModel]="value"\n      (ngModelChange)="setValue($event)"\n      [nzAllowClear]="allowClear"\n      [nzAllowHalf]="allowHalf"\n      [nzAutoFocus]="autoFocus"\n      [nzCount]="count"></nz-rate>\n    <span *ngIf="hasText && formProperty.value" class="ant-rate-text">{{ genText() }}</span>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e}(J),ze=["qq.com","163.com","gmail.com","126.com","aliyun.com"],ve=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fixData=[],e.isAsync=!1,e}return d(e,t),e.prototype.ngOnInit=function(){var t=this;this.i={backfill:C(this.ui.backfill,!1),defaultActiveFirstOption:C(this.ui.defaultActiveFirstOption,!0),width:this.ui.width||undefined},this.filterOption=null==this.ui.filterOption||this.ui.filterOption,"boolean"==typeof this.filterOption&&(this.filterOption=function(e,t){return-1<t.label.toLowerCase().indexOf((e||"").toLowerCase())}),this.isAsync=!!this.ui.asyncData;var e=+(this.ui.debounceTime||0),n=Math.max(0,this.isAsync?Math.max(50,e):e);this.list=this.formProperty.valueChanges.pipe(u.debounceTime(n),u.startWith(""),u.flatMap(function(e){return t.isAsync?t.ui.asyncData(e):t.filterData(e)}),u.map(function(e){return S(e,null,t.schema.readOnly)}))},e.prototype.reset=function(e){if(!this.isAsync)switch(this.ui.type){case"email":this.fixData=V(ze,null,this.schema.readOnly);break;default:this.fixData=V(this.schema["enum"],this.formProperty.formData,this.schema.readOnly)}},e.prototype.filterData=function(t){var n=this;switch(this.ui.type){case"email":return this.addEmailSuffix(t);default:return l.of(this.fixData.filter(function(e){return n.filterOption(t,e)}))}},e.prototype.addEmailSuffix=function(t){return l.of(!t||~t.indexOf("@")?[]:this.fixData.map(function(e){return t+"@"+e.label}))},e.decorators=[{type:a.Component,args:[{selector:"sf-autocomplete",template:'\n    <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n      <input nz-input [nzAutocomplete]="auto"\n        [attr.id]="id"\n        [disabled]="disabled"\n        [attr.disabled]="disabled"\n        [nzSize]="ui.size"\n        [ngModel]="value"\n        (ngModelChange)="setValue($event)"\n        [attr.maxLength]="schema.maxLength || null"\n        [attr.placeholder]="ui.placeholder"\n        autocomplete="off">\n      <nz-autocomplete #auto\n        [nzBackfill]="i.backfill"\n        [nzDefaultActiveFirstOption]="i.defaultActiveFirstOption"\n        [nzWidth]="i.width"\n        (selectionChange)="setValue($event?.nzValue)">\n        <nz-auto-option *ngFor="let i of list | async" [nzValue]="i.label">{{i.label}}</nz-auto-option>\n      </nz-autocomplete>\n    </sf-item-wrap>\n    ',preserveWhitespaces:!1}]}],e}(J),we=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=[],e}return d(e,t),e.prototype.ngOnInit=function(){var n=this;this.clearText=this.ui.clearText||"清除",this.showArrow=C(this.ui.showArrow,!0),this.showInput=C(this.ui.showInput,!0),this.triggerAction=this.ui.triggerAction||["click"],this.ui.asyncData&&(this.loadData=function(e,t){return n.ui.asyncData(e,t,n)})},e.prototype.reset=function(e){var t=this;D(this.schema,this.ui,this.formProperty.formData).subscribe(function(e){t.data=e,t.detectChanges()})},e.prototype._visibleChange=function(e){this.ui.visibleChange&&this.ui.visibleChange(e)},e.prototype._change=function(e){this.setValue(e),this.ui.change&&this.ui.change(e)},e.prototype._selectionChange=function(e){this.ui.selectionChange&&this.ui.selectionChange(e)},e.prototype._select=function(e){this.ui.select&&this.ui.select(e)},e.prototype._clear=function(e){this.ui.clear&&this.ui.clear(e)},e.decorators=[{type:a.Component,args:[{selector:"sf-cascader",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n    <nz-cascader\n      [nzDisabled]="disabled"\n      [nzSize]="ui.size"\n      [ngModel]="value"\n      (ngModelChange)="_change($event)"\n      [nzOptions]="data"\n      [nzAllowClear]="ui.allowClear"\n      [nzAutoFocus]="ui.autoFocus"\n      [nzChangeOn]="ui.changeOn"\n      [nzChangeOnSelect]="ui.changeOnSelect"\n      [nzColumnClassName]="ui.columnClassName"\n      [nzExpandTrigger]="ui.expandTrigger"\n      [nzMenuClassName]="ui.menuClassName"\n      [nzMenuStyle]="ui.menuStyle"\n      [nzLabelProperty]="ui.labelProperty"\n      [nzValueProperty]="ui.valueProperty"\n      [nzLoadData]="loadData"\n      [nzPlaceHolder]="ui.placeholder"\n      [nzShowArrow]="showArrow"\n      [nzShowInput]="showInput"\n      [nzShowSearch]="ui.showSearch"\n      (nzClear)="_clear($event)"\n      (nzVisibleChange)="_visibleChange($event)"\n      (nzSelect)="_select($event)"\n      (nzSelectionChange)="_selectionChange($event)">\n    </nz-cascader>\n\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],e}(J),Ce=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=[],e.loading=!1,e}return d(e,t),e.prototype.ngOnInit=function(){var r=this;this.i={valueWith:this.ui.valueWith||function(e){return e.label},notFoundContent:this.ui.notFoundContent||"无匹配结果，轻敲空格完成输入",placement:this.ui.placement||"bottom",prefix:this.ui.prefix||"@"};var o="undefined"!=typeof this.schema.minimum?this.schema.minimum:-1,a="undefined"!=typeof this.schema.maximum?this.schema.maximum:-1;this.ui.validator||-1===o&&-1===a||(this.ui.validator=function(e,t,n){var i=r.mentionChild.getMentions().length;return-1!==o&&i<o?[{keyword:"mention",message:"最少提及 "+o+" 次"}]:-1!==a&&a<i?[{keyword:"mention",message:"最多提及 "+a+" 次"}]:null})},e.prototype.reset=function(e){var t=this;D(this.schema,this.ui,null).subscribe(function(e){t.data=e,t.detectChanges()})},e.prototype._select=function(e){this.ui.select&&this.ui.select(e)},e.prototype._search=function(e){var t=this;"function"==typeof this.ui.loadData&&(this.loading=!0,this.ui.loadData(e).pipe(u.tap(function(){return t.loading=!1}),u.map(function(e){return S(e,null,t.schema.readOnly)})).subscribe(function(e){t.data=e,t.cd.detectChanges()}))},e.decorators=[{type:a.Component,args:[{selector:"sf-mention",template:'\n    <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n\n      <nz-mention #mentions\n        [nzSuggestions]="data"\n        [nzValueWith]="i.valueWith"\n        [nzLoading]="loading"\n        [nzNotFoundContent]="i.notFoundContent"\n        [nzPlacement]="i.placement"\n        [nzPrefix]="i.prefix"\n        (nzOnSelect)="_select($event)"\n        (nzOnSearchChange)="_search($event)">\n\n        <ng-container *ngIf="ui.inputStyle !== \'textarea\'">\n          <input nzMentionTrigger nz-input\n            [attr.id]="id"\n            [disabled]="disabled"\n            [attr.disabled]="disabled"\n            [nzSize]="ui.size"\n            [ngModel]="value"\n            (ngModelChange)="setValue($event)"\n            [attr.maxLength]="schema.maxLength || null"\n            [attr.placeholder]="ui.placeholder"\n            autocomplete="off">\n        </ng-container>\n\n        <ng-container *ngIf="ui.inputStyle === \'textarea\'">\n          <textarea nzMentionTrigger nz-input\n            [attr.id]="id"\n            [disabled]="disabled"\n            [attr.disabled]="disabled"\n            [nzSize]="ui.size"\n            [ngModel]="value"\n            (ngModelChange)="setValue($event)"\n            [attr.maxLength]="schema.maxLength || null"\n            [attr.placeholder]="ui.placeholder"\n            [nzAutosize]="ui.autosize">\n          </textarea>\n        </ng-container>\n\n      </nz-mention>\n\n    </sf-item-wrap>\n    ',preserveWhitespaces:!1}]}],e.propDecorators={mentionChild:[{type:a.ViewChild,args:["mentions"]}]},e}(J),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.ngOnInit=function(){this.ui._required=!1},t.decorators=[{type:a.Component,args:[{selector:"sf-text",template:'\n  <sf-item-wrap [id]="id" [schema]="schema" [ui]="ui" [showError]="showError" [error]="error" [showTitle]="schema.title">\n    {{ value || ui.defaultText || \'-\' }}\n  </sf-item-wrap>\n  ',preserveWhitespaces:!1}]}],t}(J),_e=function(t){function e(){var e=t.call(this)||this;return e.register("object",te),e.register("array",ne),e.register("text",xe),e.register("string",ie),e.register("number",re),e.register("integer",re),e.register("date",oe),e.register("time",ae),e.register("radio",se),e.register("checkbox",le),e.register("boolean",ue),e.register("textarea",pe),e.register("select",ce),e.register("tree-select",he),e.register("tag",de),e.register("upload",fe),e.register("transfer",me),e.register("slider",ye),e.register("rate",be),e.register("autocomplete",ve),e.register("cascader",we),e.register("mention",Ce),e.register("custom",ge),e.setDefault(ie),e}return d(e,t),e}(R),Oe=[Y,B,K,X,G],Pe=[te,ne,ie,re,oe,ae,se,le,ue,pe,ce,he,de,fe,me,ye,be,ve,we,Ce,ge,xe],Se=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[c,{provide:$,useClass:N},{provide:R,useClass:_e}]}},e.decorators=[{type:a.NgModule,args:[{imports:[o.CommonModule,s.FormsModule,r.DelonUtilModule,t.DelonLocaleModule,n.NgZorroAntdModule],declarations:z(Oe,Pe),entryComponents:z(Pe),exports:z(Oe)}]}],e}();e.DelonFormConfig=c,e.useFactory=q,e.SFComponent=Y,e.SFItemComponent=B,e.SFFixedDirective=G,e.DelonFormModule=Se,e.ERRORSDEFAULT=p,e.FormProperty=I,e.PropertyGroup=M,e.FormPropertyFactory=W,e.AtomicProperty=F,e.ObjectProperty=L,e.ArrayProperty=j,e.StringProperty=k,e.NumberProperty=T,e.BooleanProperty=A,e.Widget=Z,e.ControlWidget=J,e.ArrayLayoutWidget=Q,e.ObjectLayoutWidget=ee,e.ObjectWidget=te,e.ArrayWidget=ne,e.StringWidget=ie,e.NumberWidget=re,e.DateWidget=oe,e.TimeWidget=ae,e.RadioWidget=se,e.CheckboxWidget=le,e.BooleanWidget=ue,e.TextareaWidget=pe,e.SelectWidget=ce,e.TreeSelectWidget=he,e.TagWidget=de,e.UploadWidget=fe,e.TransferWidget=me,e.SliderWidget=ye,e.RateWidget=be,e.EMAILSUFFIX=ze,e.AutoCompleteWidget=ve,e.CascaderWidget=we,e.MentionWidget=Ce,e.CustomWidget=ge,e.NzWidgetRegistry=_e,e.WidgetRegistry=R,e.WidgetFactory=H,e.SchemaValidatorFactory=$,e.AjvSchemaValidatorFactory=N,e.ɵb=K,e.ɵa=E,e.ɵc=X,e.ɵd=xe,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=form.umd.min.js.map