/**
 * @license ng-alain(cipchk@qq.com) v2.0.0-beta.5
 * (c) 2018 Cipchk https://ng-alain.com/
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@angular/router"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("@delon/acl",["exports","@angular/core","rxjs","@angular/router","rxjs/operators","@angular/common"],e):e((t.delon=t.delon||{},t.delon.acl={}),t.ng.core,t.rxjs,t.ng.router,t.rxjs.operators,t.ng.common)}(this,function(t,e,r,n,i,o){"use strict";function s(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function a(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)a.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(i)throw i.error}}return a}function l(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}var u=function(){function t(){this.roles=[],this.abilities=[],this.full=!1,this.aclChange=new r.BehaviorSubject(null)}return Object.defineProperty(t.prototype,"change",{get:function(){return this.aclChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return{full:this.full,roles:this.roles,abilities:this.abilities}},enumerable:!0,configurable:!0}),t.prototype.parseACLType=function(t){return"string"==typeof t||Array.isArray(t)?Array.isArray(t)?{role:t}:{role:[t]}:t},t.prototype.set=function(t){this.abilities=[],this.roles=[],this.add(t),this.aclChange.next(t)},t.prototype.setFull=function(t){this.full=t,this.aclChange.next(t)},t.prototype.setAbility=function(t){this.set({ability:t})},t.prototype.setRole=function(t){this.set({role:t})},t.prototype.add=function(t){var e,r;t.role&&0<t.role.length&&(e=this.roles).push.apply(e,l(t.role)),t.ability&&0<t.ability.length&&(r=this.abilities).push.apply(r,l(t.ability))},t.prototype.attachRole=function(t){var e,r;try{for(var n=s(t),i=n.next();!i.done;i=n.next()){var o=i.value;this.roles.includes(o)||this.roles.push(o)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(e)throw e.error}}this.aclChange.next(this.data)},t.prototype.attachAbility=function(t){var e,r;try{for(var n=s(t),i=n.next();!i.done;i=n.next()){var o=i.value;this.abilities.includes(o)||this.abilities.push(o)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(e)throw e.error}}this.aclChange.next(this.data)},t.prototype.removeRole=function(t){var e,r;try{for(var n=s(t),i=n.next();!i.done;i=n.next()){var o=i.value,a=this.roles.indexOf(o);-1!==a&&this.roles.splice(a,1)}}catch(l){e={error:l}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(e)throw e.error}}this.aclChange.next(this.data)},t.prototype.removeAbility=function(t){var e,r;try{for(var n=s(t),i=n.next();!i.done;i=n.next()){var o=i.value,a=this.abilities.indexOf(o);-1!==a&&this.abilities.splice(a,1)}}catch(l){e={error:l}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(e)throw e.error}}this.aclChange.next(this.data)},t.prototype.can=function(t){var e=this;if(!0===this.full||!t)return!0;var r={};return(r="number"==typeof t?{ability:[t]}:Array.isArray(t)&&0<t.length&&"number"==typeof t[0]?{ability:t}:this.parseACLType(t)).role?"allOf"===r.mode?r.role.every(function(t){return e.roles.includes(t)}):r.role.some(function(t){return e.roles.includes(t)}):!!r.ability&&("allOf"===r.mode?r.ability.every(function(t){return e.abilities.includes(t)}):r.ability.some(function(t){return e.abilities.includes(t)}))},t.prototype.parseAbility=function(t){return("number"==typeof t||"string"==typeof t||Array.isArray(t))&&(t={ability:Array.isArray(t)?t:[t]}),delete t.role,t},t.prototype.canAbility=function(t){return this.can(this.parseAbility(t))},t.decorators=[{type:e.Injectable}],t}(),c=function(){function t(t,e,r){var n=this;this.el=t,this.renderer=e,this.srv=r,this.change$=this.srv.change.subscribe(function(){return n.set(n._value)})}return Object.defineProperty(t.prototype,"acl",{set:function(t){this.set(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ability",{set:function(t){this.set(this.srv.parseAbility(t))},enumerable:!0,configurable:!0}),t.prototype.set=function(t){var e="acl__hide",r=this.el.nativeElement;this.srv.can(t)?this.renderer.removeClass(r,e):this.renderer.addClass(r,e),this._value=t},t.prototype.ngOnDestroy=function(){this.change$.unsubscribe()},t.decorators=[{type:e.Directive,args:[{selector:"[acl]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:u}]},t.propDecorators={acl:[{type:e.Input,args:["acl"]}],ability:[{type:e.Input,args:["acl-ability"]}]},t}(),p=function b(){this.guard_url="/403"},y=function(){function t(t,e,r){this.srv=t,this.router=e,this.options=r}return t.prototype.process=function(t){var e=this;return(t&&t instanceof r.Observable?t:r.of(null!=t?t:null)).pipe(i.map(function(t){return e.srv.can(t)}),i.tap(function(t){t||e.router.navigateByUrl(e.options.guard_url)}))},t.prototype.canLoad=function(t){return this.process(t.data&&t.data.guard||null)},t.prototype.canActivateChild=function(t,e){return this.canActivate(t,e)},t.prototype.canActivate=function(t,e){return this.process(t.data&&t.data.guard||null)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:u},{type:n.Router},{type:p}]},t}(),f=[u,y],h=[c],d=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:l([p],f)}},t.decorators=[{type:e.NgModule,args:[{imports:[o.CommonModule],declarations:l(h),exports:l(h)}]}],t}();t.ACLService=u,t.ACLDirective=c,t.DelonACLConfig=p,t.ACLGuard=y,t.DelonACLModule=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=acl.umd.min.js.map