/**
 * @license ng-alain(cipchk@qq.com) v7.3.0
 * (c) 2019 cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@delon/util"),require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("ng-zorro-antd")):"function"==typeof define&&define.amd?define("@delon/chart/pie",["exports","@angular/core","@delon/util","rxjs","rxjs/operators","@angular/common","ng-zorro-antd"],t):t(((e=e||self).delon=e.delon||{},e.delon.chart=e.delon.chart||{},e.delon.chart.pie={}),e.ng.core,e.delon.util,e.rxjs,e.rxjs.operators,e.ng.common,e["ng-zorro-antd"])}(this,function(e,t,n,i,o,r,a){"use strict";function s(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(n=r["return"])&&n.call(r)}finally{if(o)throw o.error}}return a}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var d=function(){function e(e,t,n,i){this.el=e,this.rend=t,this.ngZone=n,this.cdr=i,this.legendData=[],this.delay=0,this.animate=!0,this.color="rgba(24, 144, 255, 0.85)",this.height=0,this.hasLegend=!1,this.inner=.75,this.padding=[12,0,12,0],this.tooltip=!0,this.lineWidth=0,this.select=!0,this.data=[]}return e.prototype.setCls=function(){var e=this.el,t=this.rend,i=this.hasLegend,o=this.isPercent,r=e.nativeElement;n.updateHostClass(r,t,{"g2-pie":!0,"g2-pie__legend-has":i,"g2-pie__legend-block":i&&r.clientWidth<=380,"g2-pie__mini":o},!0)},e.prototype.fixData=function(){var e=this.percent,t=this.color;this.isPercent=null!=e,this.isPercent&&(this.select=!1,this.tooltip=!1,this.percentColor=function(e){return"占比"===e?t||"rgba(24, 144, 255, 0.85)":"#F0F2F5"},this.data=[{x:"占比",y:e},{x:"反比",y:100-e}])},e.prototype.install=function(){this.setCls();var e=this,t=e.node,n=e.height,i=e.padding,o=e.animate,r=e.tooltip,a=e.inner,s=e.hasLegend,l=this.chart=new G2.Chart({container:t.nativeElement,forceFit:!0,height:n,padding:i,animate:o});r?l.tooltip({showTitle:!1,itemTpl:'<li><span style="background-color:{color};" class="g2-tooltip-marker"></span>{name}: {value} %</li>'}):l.tooltip(!1),l.axis(!1),l.legend(!1),l.coord("theta",{innerRadius:a}),l.filter("x",function(e,t){return!1!==t.checked}),l.intervalStack().position("y").tooltip("x*percent",function(e,t){return{name:e,value:s?t:(100*t).toFixed(2)}}).select(this.select),l.render(),this.attachChart()},e.prototype.attachChart=function(){var e=this,t=this,n=t.chart,i=t.height,o=t.padding,r=t.animate,a=t.data,s=t.lineWidth,l=t.isPercent,p=t.percentColor,c=t.colors;if(n){n.set("height",i),n.set("padding",o),n.set("animate",r),n.get("geoms")[0].style({lineWidth:s,stroke:"#fff"}).color("x",l?p:c);var d=new DataSet.DataView;d.source(a).transform({type:"percent",field:"y",dimension:"x",as:"percent"}),n.source(d,{x:{type:"cat",range:[0,1]}}),n.repaint(),this.ngZone.run(function(){return e.genLegend()})}},e.prototype.genLegend=function(){var e=this.hasLegend,t=this.isPercent,n=this.cdr,i=this.chart;e&&!t&&(this.legendData=i.get("geoms")[0].get("dataArray").map(function(e){var t=e[0]._origin;return t.color=e[0].color,t.checked=!0,t.percent=(100*t.percent).toFixed(2),t}),n.detectChanges())},e.prototype._click=function(e){var t=this.legendData,n=this.chart;t[e].checked=!t[e].checked,n.repaint()},e.prototype.installResizeEvent=function(){var e=this;!this.resize$&&this.hasLegend&&(this.resize$=i.fromEvent(window,"resize").pipe(o.debounceTime(200)).subscribe(function(){return e.setCls()}))},e.prototype.ngOnInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){return setTimeout(function(){return e.install()},e.delay)})},e.prototype.ngOnChanges=function(){var e=this;this.fixData(),this.setCls(),this.ngZone.runOutsideAngular(function(){return e.attachChart()}),this.installResizeEvent()},e.prototype.ngOnDestroy=function(){var e=this;this.resize$&&this.resize$.unsubscribe(),this.chart&&this.ngZone.runOutsideAngular(function(){return e.chart.destroy()})},e.decorators=[{type:t.Component,args:[{selector:"g2-pie",exportAs:"g2Pie",template:'<div class="g2-pie__chart">\n  <div #container></div>\n  <div *ngIf="subTitle || total"\n       class="g2-pie__total">\n    <h4 *ngIf="subTitle"\n        class="g2-pie__total-title">\n      <ng-container *stringTemplateOutlet="subTitle">\n        <div [innerHTML]="subTitle"></div>\n      </ng-container>\n    </h4>\n    <div *ngIf="total"\n         class="g2-pie__total-stat">\n      <ng-container *stringTemplateOutlet="total">\n        <div [innerHTML]="total"></div>\n      </ng-container>\n    </div>\n  </div>\n</div>\n<ul *ngIf="hasLegend && legendData?.length"\n    class="g2-pie__legend">\n  <li *ngFor="let item of legendData; let index = index"\n      (click)="_click(index)"\n      class="g2-pie__legend-item">\n    <span class="g2-pie__legend-dot"\n          [ngStyle]="{\'background-color\': !item.checked ? \'#aaa\' : item.color}"></span>\n    <span class="g2-pie__legend-title">{{item.x}}</span>\n    <nz-divider nzType="vertical"></nz-divider>\n    <span class="g2-pie__legend-percent">{{item.percent}}%</span>\n    <span class="g2-pie__legend-value"\n          [innerHTML]="valueFormat ? valueFormat(item.y) : item.y"></span>\n  </li>\n</ul>\n',changeDetection:t.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:t.NgZone},{type:t.ChangeDetectorRef}]},e.propDecorators={node:[{type:t.ViewChild,args:["container"]}],delay:[{type:t.Input}],animate:[{type:t.Input}],color:[{type:t.Input}],subTitle:[{type:t.Input}],total:[{type:t.Input}],height:[{type:t.Input}],hasLegend:[{type:t.Input}],inner:[{type:t.Input}],padding:[{type:t.Input}],percent:[{type:t.Input}],tooltip:[{type:t.Input}],lineWidth:[{type:t.Input}],select:[{type:t.Input}],valueFormat:[{type:t.Input}],data:[{type:t.Input}],colors:[{type:t.Input}]},s([n.InputNumber(),l("design:type",Object)],e.prototype,"delay",void 0),s([n.InputBoolean(),l("design:type",Object)],e.prototype,"animate",void 0),s([n.InputNumber(),l("design:type",Object)],e.prototype,"height",void 0),s([n.InputBoolean(),l("design:type",Object)],e.prototype,"hasLegend",void 0),s([n.InputNumber(),l("design:type",Number)],e.prototype,"percent",void 0),s([n.InputBoolean(),l("design:type",Object)],e.prototype,"tooltip",void 0),s([n.InputNumber(),l("design:type",Object)],e.prototype,"lineWidth",void 0),s([n.InputBoolean(),l("design:type",Object)],e.prototype,"select",void 0),e}(),u=[d],h=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,n.DelonUtilModule,a.NgZorroAntdModule],declarations:c(u),exports:c(u)}]}],e}();e.G2PieComponent=d,e.G2PieModule=h,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=pie.umd.min.js.map