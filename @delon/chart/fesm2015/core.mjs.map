{"version":3,"file":"core.mjs","sources":["../../../../packages/chart/core/g2.servicce.ts","../../../../packages/chart/core/g2.base.component.ts","../../../../packages/chart/core/utils.ts","../../../../packages/chart/core/core.ts"],"sourcesContent":["import { Injectable, OnDestroy } from '@angular/core';\nimport { Observable, Subject } from 'rxjs';\n\nimport { AlainChartConfig, AlainConfigService } from '@delon/util/config';\nimport { LazyService } from '@delon/util/other';\n\n@Injectable({ providedIn: 'root' })\nexport class G2Service implements OnDestroy {\n  private _cog!: AlainChartConfig;\n  private loading = false;\n  private loaded = false;\n  private notify$ = new Subject<void>();\n\n  get cog(): AlainChartConfig {\n    return this._cog;\n  }\n  set cog(val: AlainChartConfig) {\n    this._cog = this.cogSrv.merge(\n      'chart',\n      {\n        theme: '',\n        libs: [\n          'https://gw.alipayobjects.com/os/lib/antv/g2/4.1.46/dist/g2.min.js',\n          'https://gw.alipayobjects.com/os/lib/antv/data-set/0.11.8/dist/data-set.js'\n        ]\n      } as AlainChartConfig,\n      val\n    )!;\n  }\n\n  constructor(private cogSrv: AlainConfigService, private lazySrv: LazyService) {\n    this.cog = { theme: '' };\n  }\n\n  libLoad(): this {\n    if (this.loading) {\n      if (this.loaded) {\n        this.notify$.next();\n      }\n      return this;\n    }\n    this.loading = true;\n    this.lazySrv.load(this.cog.libs!).then(() => {\n      this.loaded = true;\n      this.notify$.next();\n    });\n    return this;\n  }\n\n  get notify(): Observable<void> {\n    return this.notify$.asObservable();\n  }\n\n  ngOnDestroy(): void {\n    this.notify$.unsubscribe();\n  }\n}\n","import { Platform } from '@angular/cdk/platform';\nimport {\n  ChangeDetectorRef,\n  Directive,\n  ElementRef,\n  EventEmitter,\n  Input,\n  NgZone,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  SimpleChanges,\n  ViewChild\n} from '@angular/core';\nimport { Subject, Subscription, filter, takeUntil } from 'rxjs';\n\nimport type { Chart, Types } from '@antv/g2';\n\nimport { BooleanInput, InputBoolean, InputNumber, NumberInput, ZoneOutside } from '@delon/util/decorator';\nimport type { NzSafeAny } from 'ng-zorro-antd/core/types';\n\nimport { G2Service } from './g2.servicce';\n\n@Directive()\nexport abstract class G2BaseComponent implements OnInit, OnChanges, OnDestroy {\n  get chart(): Chart {\n    return this._chart;\n  }\n\n  get winG2(): NzSafeAny {\n    return (window as NzSafeAny).G2;\n  }\n\n  constructor(\n    protected srv: G2Service,\n    protected el: ElementRef<HTMLElement>,\n    protected ngZone: NgZone,\n    protected platform: Platform,\n    protected cdr: ChangeDetectorRef\n  ) {\n    this.theme = srv.cog.theme!;\n    this.srv.notify\n      .pipe(\n        takeUntil(this.destroy$),\n        filter(() => !this.loaded)\n      )\n      .subscribe(() => this.load());\n  }\n  static ngAcceptInputType_repaint: BooleanInput;\n  static ngAcceptInputType_delay: NumberInput;\n  @Input() @InputBoolean() repaint = true;\n\n  @ViewChild('container', { static: true }) protected node!: ElementRef;\n  protected resize$?: Subscription;\n  protected destroy$ = new Subject<void>();\n  protected _chart!: Chart;\n  loaded = false;\n\n  @Input() @InputNumber() delay = 0;\n  @Input() theme: string | Types.LooseObject;\n  @Output() readonly ready = new EventEmitter<Chart>();\n\n  /** 检查是否只变更数据 */\n  onlyChangeData?: (changes: SimpleChanges) => boolean;\n\n  abstract install(): void;\n\n  /** G2数据变更 */\n  changeData(): void {}\n\n  /** 等同 `ngOnInit` */\n  onInit(): void {}\n\n  /** 等同 `ngOnChanges` */\n  onChanges(_: SimpleChanges): void {}\n\n  @ZoneOutside()\n  private load(): void {\n    this.ngZone.run(() => {\n      this.loaded = true;\n      this.cdr.detectChanges();\n    });\n    setTimeout(() => this.install(), this.delay);\n  }\n\n  ngOnInit(): void {\n    if (!this.platform.isBrowser) {\n      return;\n    }\n    this.onInit();\n    if (this.winG2) {\n      this.load();\n    } else {\n      this.srv.libLoad();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    this.onChanges(changes);\n\n    const isOnlyChangeData = this.onlyChangeData\n      ? this.onlyChangeData(changes)\n      : Object.keys(changes).length === 1 && !!changes.data;\n    if (isOnlyChangeData) {\n      this.changeData();\n      return;\n    }\n    if (!this.chart || !this.repaint) return;\n    this.ngZone.runOutsideAngular(() => {\n      this.destroyChart().install();\n    });\n  }\n\n  @ZoneOutside()\n  protected destroyChart(): this {\n    if (this._chart) {\n      this._chart.destroy();\n    }\n    return this;\n  }\n\n  ngOnDestroy(): void {\n    if (this.resize$) {\n      this.resize$.unsubscribe();\n    }\n    this.destroy$.next();\n    this.destroy$.complete();\n    this.destroyChart();\n  }\n}\n","import type { Types } from '@antv/g2';\n\nexport function genMiniTooltipOptions(type: 'mini' | 'default', options?: Types.TooltipCfg): Types.TooltipCfg {\n  const res: Types.TooltipCfg = {\n    showTitle: false,\n    showMarkers: true,\n    enterable: true,\n    domStyles: {\n      'g2-tooltip': { padding: '0px' },\n      'g2-tooltip-title': { display: 'none' },\n      'g2-tooltip-list-item': { margin: '4px' }\n    },\n    ...options\n  };\n  if (type === 'mini') {\n    res.position = 'top';\n    res.domStyles!['g2-tooltip'] = { padding: '0px', backgroundColor: 'transparent', boxShadow: 'none' };\n    res.itemTpl = `<li>{value}</li>`;\n    res.offset = 8;\n  }\n\n  return res;\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["i1.G2Service","i2"],"mappings":"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"}